
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.8">
    
    
      
        <title>API Reference - Sync Smart Home API Docs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Sync Smart Home API Docs" class="md-header__button md-logo" aria-label="Sync Smart Home API Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Sync Smart Home API Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Sync Smart Home API Docs" class="md-nav__button md-logo" aria-label="Sync Smart Home API Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Sync Smart Home API Docs
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
    <nav class="md-nav" aria-label="main">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.main.root" class="md-nav__link">
    <span class="md-ellipsis">
      root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.main.startup_event" class="md-nav__link">
    <span class="md-ellipsis">
      startup_event
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_report">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.generate_report.get_user_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.parse_args" class="md-nav__link">
    <span class="md-ellipsis">
      parse_args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.data_util" class="md-nav__link">
    <span class="md-ellipsis">
      data_util
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.data_util.check_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      check_usage_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.data_util.generate_test_data" class="md-nav__link">
    <span class="md-ellipsis">
      generate_test_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.inspect_data" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inspect_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.inspect_data.inspect_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_usage_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.patched_report_generator" class="md-nav__link">
    <span class="md-ellipsis">
      patched_report_generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patched_report_generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.fetch_energy_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_energy_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.fetch_user_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_user_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.generate_energy_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.get_user_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.core.auth" class="md-nav__link">
    <span class="md-ellipsis">
      auth
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.core.auth.get_current_user" class="md-nav__link">
    <span class="md-ellipsis">
      get_current_user
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.core.password" class="md-nav__link">
    <span class="md-ellipsis">
      password
    </span>
  </a>
  
    <nav class="md-nav" aria-label="password">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.core.password.hash_password" class="md-nav__link">
    <span class="md-ellipsis">
      hash_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.core.password.verify_password" class="md-nav__link">
    <span class="md-ellipsis">
      verify_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.core.password.verify_role" class="md-nav__link">
    <span class="md-ellipsis">
      verify_role
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.db.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.db.data.init_db" class="md-nav__link">
    <span class="md-ellipsis">
      init_db
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.access_management" class="md-nav__link">
    <span class="md-ellipsis">
      access_management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessLevel" class="md-nav__link">
    <span class="md-ellipsis">
      AccessLevel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementDB" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AccessManagementUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementUpdate.validate_note" class="md-nav__link">
    <span class="md-ellipsis">
      validate_note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAccessManagement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAccessManagement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement.validate_note" class="md-nav__link">
    <span class="md-ellipsis">
      validate_note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement.validate_user_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_ids
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.ResourceType" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.analytics" class="md-nav__link">
    <span class="md-ellipsis">
      analytics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analytics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsDB" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsQuery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyticsQuery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery.validate_time_range" class="md-nav__link">
    <span class="md-ellipsis">
      validate_time_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery.validate_time_range_post_init" class="md-nav__link">
    <span class="md-ellipsis">
      validate_time_range_post_init
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyticsUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsUpdate.validate_tags" class="md-nav__link">
    <span class="md-ellipsis">
      validate_tags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAnalytics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAnalytics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics.validate_data_type" class="md-nav__link">
    <span class="md-ellipsis">
      validate_data_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics.validate_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.automation" class="md-nav__link">
    <span class="md-ellipsis">
      automation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.ActionType" class="md-nav__link">
    <span class="md-ellipsis">
      ActionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationDB" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationDetailResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationDetailResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AutomationUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAutomation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAutomation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.TriggerType" class="md-nav__link">
    <span class="md-ellipsis">
      TriggerType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.device" class="md-nav__link">
    <span class="md-ellipsis">
      device
    </span>
  </a>
  
    <nav class="md-nav" aria-label="device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.CreateDevice" class="md-nav__link">
    <span class="md-ellipsis">
      CreateDevice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateDevice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.CreateDevice.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceDB" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceResponse" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceStatus" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceType" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeviceUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.goal" class="md-nav__link">
    <span class="md-ellipsis">
      goal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="goal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal" class="md-nav__link">
    <span class="md-ellipsis">
      CreateEnergyGoal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateEnergyGoal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_end_date" class="md-nav__link">
    <span class="md-ellipsis">
      validate_end_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_target_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_target_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalDB" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalProgressUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalProgressUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyGoalProgressUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalProgressUpdate.validate_current_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_current_value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalResponse" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyGoalUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_current_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_current_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_target_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_target_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalStatus" class="md-nav__link">
    <span class="md-ellipsis">
      GoalStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalTimeframe" class="md-nav__link">
    <span class="md-ellipsis">
      GoalTimeframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalType" class="md-nav__link">
    <span class="md-ellipsis">
      GoalType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.notification" class="md-nav__link">
    <span class="md-ellipsis">
      notification
    </span>
  </a>
  
    <nav class="md-nav" aria-label="notification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification" class="md-nav__link">
    <span class="md-ellipsis">
      CreateNotification
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateNotification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_message" class="md-nav__link">
    <span class="md-ellipsis">
      validate_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationBulkUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationBulkUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NotificationBulkUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationBulkUpdate.validate_notification_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_notification_ids
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationDB" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationResponse" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationUpdate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.profile" class="md-nav__link">
    <span class="md-ellipsis">
      profile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="profile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateProfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile.validate_temp_unit" class="md-nav__link">
    <span class="md-ellipsis">
      validate_temp_unit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile.validate_timezone" class="md-nav__link">
    <span class="md-ellipsis">
      validate_timezone
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileDB" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileResponse" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProfileUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate.validate_temp_unit" class="md-nav__link">
    <span class="md-ellipsis">
      validate_temp_unit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate.validate_timezone" class="md-nav__link">
    <span class="md-ellipsis">
      validate_timezone
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.report" class="md-nav__link">
    <span class="md-ellipsis">
      report
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest" class="md-nav__link">
    <span class="md-ellipsis">
      CreateReportRequest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateReportRequest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest.validate_date_format" class="md-nav__link">
    <span class="md-ellipsis">
      validate_date_format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportDB" class="md-nav__link">
    <span class="md-ellipsis">
      ReportDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportFormat" class="md-nav__link">
    <span class="md-ellipsis">
      ReportFormat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportResponse" class="md-nav__link">
    <span class="md-ellipsis">
      ReportResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportStatus" class="md-nav__link">
    <span class="md-ellipsis">
      ReportStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.room" class="md-nav__link">
    <span class="md-ellipsis">
      room
    </span>
  </a>
  
    <nav class="md-nav" aria-label="room">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom" class="md-nav__link">
    <span class="md-ellipsis">
      CreateRoom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateRoom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom.validate_floor" class="md-nav__link">
    <span class="md-ellipsis">
      validate_floor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomDB" class="md-nav__link">
    <span class="md-ellipsis">
      RoomDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomResponse" class="md-nav__link">
    <span class="md-ellipsis">
      RoomResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      RoomUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RoomUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate.validate_floor" class="md-nav__link">
    <span class="md-ellipsis">
      validate_floor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      suggestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="suggestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion" class="md-nav__link">
    <span class="md-ellipsis">
      CreateSuggestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateSuggestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_device_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_priority" class="md-nav__link">
    <span class="md-ellipsis">
      validate_priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionDB" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionResponse" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionStatus" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionType" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SuggestionUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_device_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_feedback" class="md-nav__link">
    <span class="md-ellipsis">
      validate_feedback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_priority" class="md-nav__link">
    <span class="md-ellipsis">
      validate_priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.usage" class="md-nav__link">
    <span class="md-ellipsis">
      usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage" class="md-nav__link">
    <span class="md-ellipsis">
      CreateUsage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateUsage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_device_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_duration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_energy_consumed" class="md-nav__link">
    <span class="md-ellipsis">
      validate_energy_consumed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageAggregateResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UsageAggregateResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageBulkCreate" class="md-nav__link">
    <span class="md-ellipsis">
      UsageBulkCreate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageBulkCreate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageBulkCreate.validate_records" class="md-nav__link">
    <span class="md-ellipsis">
      validate_records
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageDB" class="md-nav__link">
    <span class="md-ellipsis">
      UsageDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UsageResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageTimeRange" class="md-nav__link">
    <span class="md-ellipsis">
      UsageTimeRange
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageTimeRange">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageTimeRange.validate_end_time" class="md-nav__link">
    <span class="md-ellipsis">
      validate_end_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      UsageUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate.validate_duration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate.validate_energy_consumed" class="md-nav__link">
    <span class="md-ellipsis">
      validate_energy_consumed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.user" class="md-nav__link">
    <span class="md-ellipsis">
      user
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser" class="md-nav__link">
    <span class="md-ellipsis">
      CreateUser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateUser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser.validate_password" class="md-nav__link">
    <span class="md-ellipsis">
      validate_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser.validate_username" class="md-nav__link">
    <span class="md-ellipsis">
      validate_username
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserDB" class="md-nav__link">
    <span class="md-ellipsis">
      UserDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UserResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      UserUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserUpdate.validate_username" class="md-nav__link">
    <span class="md-ellipsis">
      validate_username
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.access_management_routes" class="md-nav__link">
    <span class="md-ellipsis">
      access_management_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_management_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.create_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      create_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.delete_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      delete_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.get_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      get_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.get_all_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.update_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      update_access_management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.analytics_routes" class="md-nav__link">
    <span class="md-ellipsis">
      analytics_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analytics_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.create_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      create_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.delete_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      delete_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.get_all_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.get_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      get_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.update_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      update_analytics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.automation_routes" class="md-nav__link">
    <span class="md-ellipsis">
      automation_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automation_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.create_automation" class="md-nav__link">
    <span class="md-ellipsis">
      create_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.delete_automation" class="md-nav__link">
    <span class="md-ellipsis">
      delete_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.get_all_automations" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_automations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.get_automation" class="md-nav__link">
    <span class="md-ellipsis">
      get_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.update_automation" class="md-nav__link">
    <span class="md-ellipsis">
      update_automation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.device_routes" class="md-nav__link">
    <span class="md-ellipsis">
      device_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="device_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.create_device" class="md-nav__link">
    <span class="md-ellipsis">
      create_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.delete_device" class="md-nav__link">
    <span class="md-ellipsis">
      delete_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.get_all_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.get_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.update_device" class="md-nav__link">
    <span class="md-ellipsis">
      update_device
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.goal_routes" class="md-nav__link">
    <span class="md-ellipsis">
      goal_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="goal_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.create_goal" class="md-nav__link">
    <span class="md-ellipsis">
      create_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.delete_goal" class="md-nav__link">
    <span class="md-ellipsis">
      delete_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.get_all_goals" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_goals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.get_goal" class="md-nav__link">
    <span class="md-ellipsis">
      get_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.update_goal" class="md-nav__link">
    <span class="md-ellipsis">
      update_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.update_goal_progress" class="md-nav__link">
    <span class="md-ellipsis">
      update_goal_progress
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.notification_routes" class="md-nav__link">
    <span class="md-ellipsis">
      notification_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="notification_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.bulk_update_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      bulk_update_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.create_notification" class="md-nav__link">
    <span class="md-ellipsis">
      create_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.delete_notification" class="md-nav__link">
    <span class="md-ellipsis">
      delete_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.delete_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      delete_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.get_all_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.get_notification" class="md-nav__link">
    <span class="md-ellipsis">
      get_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.update_notification" class="md-nav__link">
    <span class="md-ellipsis">
      update_notification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.profile_routes" class="md-nav__link">
    <span class="md-ellipsis">
      profile_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="profile_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.create_profile" class="md-nav__link">
    <span class="md-ellipsis">
      create_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.delete_profile" class="md-nav__link">
    <span class="md-ellipsis">
      delete_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.get_all_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_profiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.get_profile" class="md-nav__link">
    <span class="md-ellipsis">
      get_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.update_profile" class="md-nav__link">
    <span class="md-ellipsis">
      update_profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.report_routes" class="md-nav__link">
    <span class="md-ellipsis">
      report_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.create_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.delete_report" class="md-nav__link">
    <span class="md-ellipsis">
      delete_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.download_report" class="md-nav__link">
    <span class="md-ellipsis">
      download_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.get_report" class="md-nav__link">
    <span class="md-ellipsis">
      get_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.get_user_reports" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.run_in_executor" class="md-nav__link">
    <span class="md-ellipsis">
      run_in_executor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.room_routes" class="md-nav__link">
    <span class="md-ellipsis">
      room_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="room_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.create_room" class="md-nav__link">
    <span class="md-ellipsis">
      create_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.delete_room" class="md-nav__link">
    <span class="md-ellipsis">
      delete_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.get_all_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.get_room" class="md-nav__link">
    <span class="md-ellipsis">
      get_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.update_room" class="md-nav__link">
    <span class="md-ellipsis">
      update_room
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes" class="md-nav__link">
    <span class="md-ellipsis">
      suggestion_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="suggestion_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.create_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      create_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.delete_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      delete_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.get_all_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_suggestions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.get_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.update_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      update_suggestion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.usage_routes" class="md-nav__link">
    <span class="md-ellipsis">
      usage_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usage_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.check_device_ownership" class="md-nav__link">
    <span class="md-ellipsis">
      check_device_ownership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.create_bulk_usage" class="md-nav__link">
    <span class="md-ellipsis">
      create_bulk_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.create_usage" class="md-nav__link">
    <span class="md-ellipsis">
      create_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.delete_usage" class="md-nav__link">
    <span class="md-ellipsis">
      delete_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_all_usage" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_usage" class="md-nav__link">
    <span class="md-ellipsis">
      get_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_usage_aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      get_usage_aggregate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.update_usage" class="md-nav__link">
    <span class="md-ellipsis">
      update_usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.user_routes" class="md-nav__link">
    <span class="md-ellipsis">
      user_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.create_user" class="md-nav__link">
    <span class="md-ellipsis">
      create_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.delete_user" class="md-nav__link">
    <span class="md-ellipsis">
      delete_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.get_all_users" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.get_user" class="md-nav__link">
    <span class="md-ellipsis">
      get_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.update_user" class="md-nav__link">
    <span class="md-ellipsis">
      update_user
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.seeds.seed_database" class="md-nav__link">
    <span class="md-ellipsis">
      seed_database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="seed_database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.clear_collections" class="md-nav__link">
    <span class="md-ellipsis">
      clear_collections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      create_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      create_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_automations" class="md-nav__link">
    <span class="md-ellipsis">
      create_automations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_devices" class="md-nav__link">
    <span class="md-ellipsis">
      create_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_energy_goals" class="md-nav__link">
    <span class="md-ellipsis">
      create_energy_goals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_homes" class="md-nav__link">
    <span class="md-ellipsis">
      create_homes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      create_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      create_profiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      create_rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      create_suggestions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      create_usage_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_users" class="md-nav__link">
    <span class="md-ellipsis">
      create_users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.generate_uuid" class="md-nav__link">
    <span class="md-ellipsis">
      generate_uuid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.hash_password" class="md-nav__link">
    <span class="md-ellipsis">
      hash_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.random_date" class="md-nav__link">
    <span class="md-ellipsis">
      random_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.random_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      random_datetime
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.services.report_service" class="md-nav__link">
    <span class="md-ellipsis">
      report_service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService" class="md-nav__link">
    <span class="md-ellipsis">
      ReportService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReportService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.create_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.delete_report" class="md-nav__link">
    <span class="md-ellipsis">
      delete_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.fetch_energy_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_energy_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.fetch_user_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_user_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.get_report" class="md-nav__link">
    <span class="md-ellipsis">
      get_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.get_user_reports" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.update_report_status" class="md-nav__link">
    <span class="md-ellipsis">
      update_report_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector" class="md-nav__link">
    <span class="md-ellipsis">
      anomaly_detector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anomaly_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyAnomalyDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyAnomalyDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      detect_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.get_anomaly_description" class="md-nav__link">
    <span class="md-ellipsis">
      get_anomaly_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.report_generator" class="md-nav__link">
    <span class="md-ellipsis">
      report_generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyReportGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyReportGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator._get_device_names" class="md-nav__link">
    <span class="md-ellipsis">
      _get_device_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_by_device" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_by_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_by_location" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_by_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_trends" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_trends
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.calculate_total_cost" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_total_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.calculate_total_energy_usage" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_total_energy_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.create_csv_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_csv_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.create_pdf_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_pdf_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      detect_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.forecast_future_usage" class="md-nav__link">
    <span class="md-ellipsis">
      forecast_future_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.generate_energy_saving_tips" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_saving_tips
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.identify_peak_usage_times" class="md-nav__link">
    <span class="md-ellipsis">
      identify_peak_usage_times
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.generate_energy_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.report_utils" class="md-nav__link">
    <span class="md-ellipsis">
      report_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.calculate_tiered_cost" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_tiered_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_csv_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_csv_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_pdf_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_pdf_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.get_device_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_names
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#app.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
    <nav class="md-nav" aria-label="main">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.main.root" class="md-nav__link">
    <span class="md-ellipsis">
      root
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.main.startup_event" class="md-nav__link">
    <span class="md-ellipsis">
      startup_event
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
    <nav class="md-nav" aria-label="generate_report">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.generate_report.get_user_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.parse_args" class="md-nav__link">
    <span class="md-ellipsis">
      parse_args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.generate_report.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.data_util" class="md-nav__link">
    <span class="md-ellipsis">
      data_util
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data_util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.data_util.check_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      check_usage_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.data_util.generate_test_data" class="md-nav__link">
    <span class="md-ellipsis">
      generate_test_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.inspect_data" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="inspect_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.inspect_data.inspect_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      inspect_usage_data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.patched_report_generator" class="md-nav__link">
    <span class="md-ellipsis">
      patched_report_generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="patched_report_generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.fetch_energy_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_energy_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.fetch_user_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_user_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.generate_energy_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.get_user_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.main" class="md-nav__link">
    <span class="md-ellipsis">
      main
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.patched_report_generator.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.core.auth" class="md-nav__link">
    <span class="md-ellipsis">
      auth
    </span>
  </a>
  
    <nav class="md-nav" aria-label="auth">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.core.auth.get_current_user" class="md-nav__link">
    <span class="md-ellipsis">
      get_current_user
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.core.password" class="md-nav__link">
    <span class="md-ellipsis">
      password
    </span>
  </a>
  
    <nav class="md-nav" aria-label="password">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.core.password.hash_password" class="md-nav__link">
    <span class="md-ellipsis">
      hash_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.core.password.verify_password" class="md-nav__link">
    <span class="md-ellipsis">
      verify_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.core.password.verify_role" class="md-nav__link">
    <span class="md-ellipsis">
      verify_role
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.db.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.db.data.init_db" class="md-nav__link">
    <span class="md-ellipsis">
      init_db
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.access_management" class="md-nav__link">
    <span class="md-ellipsis">
      access_management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessLevel" class="md-nav__link">
    <span class="md-ellipsis">
      AccessLevel
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementDB" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AccessManagementUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AccessManagementUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.AccessManagementUpdate.validate_note" class="md-nav__link">
    <span class="md-ellipsis">
      validate_note
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAccessManagement
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAccessManagement">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement.validate_note" class="md-nav__link">
    <span class="md-ellipsis">
      validate_note
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.CreateAccessManagement.validate_user_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_ids
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.access_management.ResourceType" class="md-nav__link">
    <span class="md-ellipsis">
      ResourceType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.analytics" class="md-nav__link">
    <span class="md-ellipsis">
      analytics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analytics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsDB" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsQuery
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyticsQuery">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery.validate_time_range" class="md-nav__link">
    <span class="md-ellipsis">
      validate_time_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsQuery.validate_time_range_post_init" class="md-nav__link">
    <span class="md-ellipsis">
      validate_time_range_post_init
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AnalyticsUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AnalyticsUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.AnalyticsUpdate.validate_tags" class="md-nav__link">
    <span class="md-ellipsis">
      validate_tags
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAnalytics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAnalytics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics.validate_data_type" class="md-nav__link">
    <span class="md-ellipsis">
      validate_data_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.analytics.CreateAnalytics.validate_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.automation" class="md-nav__link">
    <span class="md-ellipsis">
      automation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.ActionType" class="md-nav__link">
    <span class="md-ellipsis">
      ActionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationDB" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationDetailResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationDetailResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationResponse" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      AutomationUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AutomationUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.AutomationUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation" class="md-nav__link">
    <span class="md-ellipsis">
      CreateAutomation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateAutomation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.CreateAutomation.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.automation.TriggerType" class="md-nav__link">
    <span class="md-ellipsis">
      TriggerType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.device" class="md-nav__link">
    <span class="md-ellipsis">
      device
    </span>
  </a>
  
    <nav class="md-nav" aria-label="device">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.CreateDevice" class="md-nav__link">
    <span class="md-ellipsis">
      CreateDevice
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateDevice">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.CreateDevice.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceDB" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceResponse" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceStatus" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceType" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      DeviceUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeviceUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.device.DeviceUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.goal" class="md-nav__link">
    <span class="md-ellipsis">
      goal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="goal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal" class="md-nav__link">
    <span class="md-ellipsis">
      CreateEnergyGoal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateEnergyGoal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_end_date" class="md-nav__link">
    <span class="md-ellipsis">
      validate_end_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_target_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_target_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.CreateEnergyGoal.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalDB" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalProgressUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalProgressUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyGoalProgressUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalProgressUpdate.validate_current_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_current_value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalResponse" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyGoalUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyGoalUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_current_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_current_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_target_value" class="md-nav__link">
    <span class="md-ellipsis">
      validate_target_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.EnergyGoalUpdate.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalStatus" class="md-nav__link">
    <span class="md-ellipsis">
      GoalStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalTimeframe" class="md-nav__link">
    <span class="md-ellipsis">
      GoalTimeframe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.goal.GoalType" class="md-nav__link">
    <span class="md-ellipsis">
      GoalType
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.notification" class="md-nav__link">
    <span class="md-ellipsis">
      notification
    </span>
  </a>
  
    <nav class="md-nav" aria-label="notification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification" class="md-nav__link">
    <span class="md-ellipsis">
      CreateNotification
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateNotification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_message" class="md-nav__link">
    <span class="md-ellipsis">
      validate_message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.CreateNotification.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationBulkUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationBulkUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="NotificationBulkUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationBulkUpdate.validate_notification_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_notification_ids
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationDB" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationResponse" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.notification.NotificationUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      NotificationUpdate
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.profile" class="md-nav__link">
    <span class="md-ellipsis">
      profile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="profile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile" class="md-nav__link">
    <span class="md-ellipsis">
      CreateProfile
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateProfile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile.validate_temp_unit" class="md-nav__link">
    <span class="md-ellipsis">
      validate_temp_unit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.CreateProfile.validate_timezone" class="md-nav__link">
    <span class="md-ellipsis">
      validate_timezone
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileDB" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileResponse" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      ProfileUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProfileUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate.validate_temp_unit" class="md-nav__link">
    <span class="md-ellipsis">
      validate_temp_unit
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.profile.ProfileUpdate.validate_timezone" class="md-nav__link">
    <span class="md-ellipsis">
      validate_timezone
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.report" class="md-nav__link">
    <span class="md-ellipsis">
      report
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest" class="md-nav__link">
    <span class="md-ellipsis">
      CreateReportRequest
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateReportRequest">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest.validate_date_format" class="md-nav__link">
    <span class="md-ellipsis">
      validate_date_format
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.CreateReportRequest.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportDB" class="md-nav__link">
    <span class="md-ellipsis">
      ReportDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportFormat" class="md-nav__link">
    <span class="md-ellipsis">
      ReportFormat
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportResponse" class="md-nav__link">
    <span class="md-ellipsis">
      ReportResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.report.ReportStatus" class="md-nav__link">
    <span class="md-ellipsis">
      ReportStatus
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.room" class="md-nav__link">
    <span class="md-ellipsis">
      room
    </span>
  </a>
  
    <nav class="md-nav" aria-label="room">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom" class="md-nav__link">
    <span class="md-ellipsis">
      CreateRoom
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateRoom">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom.validate_floor" class="md-nav__link">
    <span class="md-ellipsis">
      validate_floor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.CreateRoom.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomDB" class="md-nav__link">
    <span class="md-ellipsis">
      RoomDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomResponse" class="md-nav__link">
    <span class="md-ellipsis">
      RoomResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      RoomUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RoomUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate.validate_floor" class="md-nav__link">
    <span class="md-ellipsis">
      validate_floor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.room.RoomUpdate.validate_name" class="md-nav__link">
    <span class="md-ellipsis">
      validate_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      suggestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="suggestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion" class="md-nav__link">
    <span class="md-ellipsis">
      CreateSuggestion
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateSuggestion">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_device_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_priority" class="md-nav__link">
    <span class="md-ellipsis">
      validate_priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.CreateSuggestion.validate_user_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_user_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionDB" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionResponse" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionStatus" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionStatus
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionType" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionType
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      SuggestionUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SuggestionUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_description" class="md-nav__link">
    <span class="md-ellipsis">
      validate_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_device_ids" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_ids
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_feedback" class="md-nav__link">
    <span class="md-ellipsis">
      validate_feedback
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_priority" class="md-nav__link">
    <span class="md-ellipsis">
      validate_priority
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.suggestion.SuggestionUpdate.validate_title" class="md-nav__link">
    <span class="md-ellipsis">
      validate_title
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.usage" class="md-nav__link">
    <span class="md-ellipsis">
      usage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage" class="md-nav__link">
    <span class="md-ellipsis">
      CreateUsage
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateUsage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_device_id" class="md-nav__link">
    <span class="md-ellipsis">
      validate_device_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_duration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.CreateUsage.validate_energy_consumed" class="md-nav__link">
    <span class="md-ellipsis">
      validate_energy_consumed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageAggregateResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UsageAggregateResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageBulkCreate" class="md-nav__link">
    <span class="md-ellipsis">
      UsageBulkCreate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageBulkCreate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageBulkCreate.validate_records" class="md-nav__link">
    <span class="md-ellipsis">
      validate_records
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageDB" class="md-nav__link">
    <span class="md-ellipsis">
      UsageDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UsageResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageTimeRange" class="md-nav__link">
    <span class="md-ellipsis">
      UsageTimeRange
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageTimeRange">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageTimeRange.validate_end_time" class="md-nav__link">
    <span class="md-ellipsis">
      validate_end_time
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      UsageUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UsageUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate.validate_duration" class="md-nav__link">
    <span class="md-ellipsis">
      validate_duration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.usage.UsageUpdate.validate_energy_consumed" class="md-nav__link">
    <span class="md-ellipsis">
      validate_energy_consumed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.models.user" class="md-nav__link">
    <span class="md-ellipsis">
      user
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser" class="md-nav__link">
    <span class="md-ellipsis">
      CreateUser
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CreateUser">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser.validate_password" class="md-nav__link">
    <span class="md-ellipsis">
      validate_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.CreateUser.validate_username" class="md-nav__link">
    <span class="md-ellipsis">
      validate_username
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserDB" class="md-nav__link">
    <span class="md-ellipsis">
      UserDB
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserResponse" class="md-nav__link">
    <span class="md-ellipsis">
      UserResponse
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserUpdate" class="md-nav__link">
    <span class="md-ellipsis">
      UserUpdate
    </span>
  </a>
  
    <nav class="md-nav" aria-label="UserUpdate">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.models.user.UserUpdate.validate_username" class="md-nav__link">
    <span class="md-ellipsis">
      validate_username
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.access_management_routes" class="md-nav__link">
    <span class="md-ellipsis">
      access_management_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_management_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.create_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      create_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.delete_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      delete_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.get_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      get_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.get_all_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.access_management_routes.update_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      update_access_management
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.analytics_routes" class="md-nav__link">
    <span class="md-ellipsis">
      analytics_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="analytics_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.create_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      create_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.delete_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      delete_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.get_all_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.get_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      get_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.analytics_routes.update_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      update_analytics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.automation_routes" class="md-nav__link">
    <span class="md-ellipsis">
      automation_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automation_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.create_automation" class="md-nav__link">
    <span class="md-ellipsis">
      create_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.delete_automation" class="md-nav__link">
    <span class="md-ellipsis">
      delete_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.get_all_automations" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_automations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.get_automation" class="md-nav__link">
    <span class="md-ellipsis">
      get_automation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.automation_routes.update_automation" class="md-nav__link">
    <span class="md-ellipsis">
      update_automation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.device_routes" class="md-nav__link">
    <span class="md-ellipsis">
      device_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="device_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.create_device" class="md-nav__link">
    <span class="md-ellipsis">
      create_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.delete_device" class="md-nav__link">
    <span class="md-ellipsis">
      delete_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.get_all_devices" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.get_device" class="md-nav__link">
    <span class="md-ellipsis">
      get_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.device_routes.update_device" class="md-nav__link">
    <span class="md-ellipsis">
      update_device
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.goal_routes" class="md-nav__link">
    <span class="md-ellipsis">
      goal_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="goal_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.create_goal" class="md-nav__link">
    <span class="md-ellipsis">
      create_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.delete_goal" class="md-nav__link">
    <span class="md-ellipsis">
      delete_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.get_all_goals" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_goals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.get_goal" class="md-nav__link">
    <span class="md-ellipsis">
      get_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.update_goal" class="md-nav__link">
    <span class="md-ellipsis">
      update_goal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.goal_routes.update_goal_progress" class="md-nav__link">
    <span class="md-ellipsis">
      update_goal_progress
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.notification_routes" class="md-nav__link">
    <span class="md-ellipsis">
      notification_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="notification_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.bulk_update_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      bulk_update_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.create_notification" class="md-nav__link">
    <span class="md-ellipsis">
      create_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.delete_notification" class="md-nav__link">
    <span class="md-ellipsis">
      delete_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.delete_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      delete_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.get_all_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.get_notification" class="md-nav__link">
    <span class="md-ellipsis">
      get_notification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.notification_routes.update_notification" class="md-nav__link">
    <span class="md-ellipsis">
      update_notification
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.profile_routes" class="md-nav__link">
    <span class="md-ellipsis">
      profile_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="profile_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.create_profile" class="md-nav__link">
    <span class="md-ellipsis">
      create_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.delete_profile" class="md-nav__link">
    <span class="md-ellipsis">
      delete_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.get_all_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_profiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.get_profile" class="md-nav__link">
    <span class="md-ellipsis">
      get_profile
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.profile_routes.update_profile" class="md-nav__link">
    <span class="md-ellipsis">
      update_profile
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.report_routes" class="md-nav__link">
    <span class="md-ellipsis">
      report_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.create_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.delete_report" class="md-nav__link">
    <span class="md-ellipsis">
      delete_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.download_report" class="md-nav__link">
    <span class="md-ellipsis">
      download_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.get_report" class="md-nav__link">
    <span class="md-ellipsis">
      get_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.get_user_reports" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.report_routes.run_in_executor" class="md-nav__link">
    <span class="md-ellipsis">
      run_in_executor
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.room_routes" class="md-nav__link">
    <span class="md-ellipsis">
      room_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="room_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.create_room" class="md-nav__link">
    <span class="md-ellipsis">
      create_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.delete_room" class="md-nav__link">
    <span class="md-ellipsis">
      delete_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.get_all_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.get_room" class="md-nav__link">
    <span class="md-ellipsis">
      get_room
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.room_routes.update_room" class="md-nav__link">
    <span class="md-ellipsis">
      update_room
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes" class="md-nav__link">
    <span class="md-ellipsis">
      suggestion_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="suggestion_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.create_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      create_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.delete_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      delete_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.get_all_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_suggestions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.get_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      get_suggestion
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.suggestion_routes.update_suggestion" class="md-nav__link">
    <span class="md-ellipsis">
      update_suggestion
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.usage_routes" class="md-nav__link">
    <span class="md-ellipsis">
      usage_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="usage_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.check_device_ownership" class="md-nav__link">
    <span class="md-ellipsis">
      check_device_ownership
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.create_bulk_usage" class="md-nav__link">
    <span class="md-ellipsis">
      create_bulk_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.create_usage" class="md-nav__link">
    <span class="md-ellipsis">
      create_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.delete_usage" class="md-nav__link">
    <span class="md-ellipsis">
      delete_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_all_usage" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_usage" class="md-nav__link">
    <span class="md-ellipsis">
      get_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.get_usage_aggregate" class="md-nav__link">
    <span class="md-ellipsis">
      get_usage_aggregate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.usage_routes.update_usage" class="md-nav__link">
    <span class="md-ellipsis">
      update_usage
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.routes.user_routes" class="md-nav__link">
    <span class="md-ellipsis">
      user_routes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user_routes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.create_user" class="md-nav__link">
    <span class="md-ellipsis">
      create_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.delete_user" class="md-nav__link">
    <span class="md-ellipsis">
      delete_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.get_all_users" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.get_user" class="md-nav__link">
    <span class="md-ellipsis">
      get_user
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.routes.user_routes.update_user" class="md-nav__link">
    <span class="md-ellipsis">
      update_user
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.seeds.seed_database" class="md-nav__link">
    <span class="md-ellipsis">
      seed_database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="seed_database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.clear_collections" class="md-nav__link">
    <span class="md-ellipsis">
      clear_collections
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_access_management" class="md-nav__link">
    <span class="md-ellipsis">
      create_access_management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_analytics" class="md-nav__link">
    <span class="md-ellipsis">
      create_analytics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_automations" class="md-nav__link">
    <span class="md-ellipsis">
      create_automations
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_devices" class="md-nav__link">
    <span class="md-ellipsis">
      create_devices
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_energy_goals" class="md-nav__link">
    <span class="md-ellipsis">
      create_energy_goals
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_homes" class="md-nav__link">
    <span class="md-ellipsis">
      create_homes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_notifications" class="md-nav__link">
    <span class="md-ellipsis">
      create_notifications
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_profiles" class="md-nav__link">
    <span class="md-ellipsis">
      create_profiles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_rooms" class="md-nav__link">
    <span class="md-ellipsis">
      create_rooms
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_suggestions" class="md-nav__link">
    <span class="md-ellipsis">
      create_suggestions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_usage_data" class="md-nav__link">
    <span class="md-ellipsis">
      create_usage_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.create_users" class="md-nav__link">
    <span class="md-ellipsis">
      create_users
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.generate_uuid" class="md-nav__link">
    <span class="md-ellipsis">
      generate_uuid
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.hash_password" class="md-nav__link">
    <span class="md-ellipsis">
      hash_password
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.random_date" class="md-nav__link">
    <span class="md-ellipsis">
      random_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.seeds.seed_database.random_datetime" class="md-nav__link">
    <span class="md-ellipsis">
      random_datetime
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.services.report_service" class="md-nav__link">
    <span class="md-ellipsis">
      report_service
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_service">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService" class="md-nav__link">
    <span class="md-ellipsis">
      ReportService
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReportService">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.create_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.delete_report" class="md-nav__link">
    <span class="md-ellipsis">
      delete_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.fetch_energy_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_energy_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.fetch_user_data" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_user_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.generate_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.get_report" class="md-nav__link">
    <span class="md-ellipsis">
      get_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.get_user_reports" class="md-nav__link">
    <span class="md-ellipsis">
      get_user_reports
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.services.report_service.ReportService.update_report_status" class="md-nav__link">
    <span class="md-ellipsis">
      update_report_status
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector" class="md-nav__link">
    <span class="md-ellipsis">
      anomaly_detector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="anomaly_detector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyAnomalyDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyAnomalyDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      detect_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.get_anomaly_description" class="md-nav__link">
    <span class="md-ellipsis">
      get_anomaly_description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.anomaly_detector.EnergyAnomalyDetector.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.report_generator" class="md-nav__link">
    <span class="md-ellipsis">
      report_generator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_generator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      EnergyReportGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EnergyReportGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator._get_device_names" class="md-nav__link">
    <span class="md-ellipsis">
      _get_device_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_by_device" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_by_device
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_by_location" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_by_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.analyze_trends" class="md-nav__link">
    <span class="md-ellipsis">
      analyze_trends
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.calculate_total_cost" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_total_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.calculate_total_energy_usage" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_total_energy_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.create_csv_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_csv_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.create_pdf_report" class="md-nav__link">
    <span class="md-ellipsis">
      create_pdf_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.detect_anomalies" class="md-nav__link">
    <span class="md-ellipsis">
      detect_anomalies
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.forecast_future_usage" class="md-nav__link">
    <span class="md-ellipsis">
      forecast_future_usage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.generate_energy_saving_tips" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_saving_tips
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.EnergyReportGenerator.identify_peak_usage_times" class="md-nav__link">
    <span class="md-ellipsis">
      identify_peak_usage_times
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_generator.generate_energy_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_energy_report
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#app.utils.report.report_utils" class="md-nav__link">
    <span class="md-ellipsis">
      report_utils
    </span>
  </a>
  
    <nav class="md-nav" aria-label="report_utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.calculate_tiered_cost" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_tiered_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_csv_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_csv_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_pdf_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_pdf_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.generate_enhanced_report" class="md-nav__link">
    <span class="md-ellipsis">
      generate_enhanced_report
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#app.utils.report.report_utils.get_device_names" class="md-nav__link">
    <span class="md-ellipsis">
      get_device_names
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-reference">API Reference</h1>


<div class="doc doc-object doc-module">



<h2 id="app.main" class="doc doc-heading">
            <code>app.main</code>


</h2>

    <div class="doc doc-contents first">

        <p>Main application entry point for the smart home API.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.main.root" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">root</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>API health check endpoint.</p>

            <details class="quote">
              <summary>Source code in <code>app/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">root</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    API health check endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;online&quot;</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Sync Smart Home API is running&quot;</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.main.startup_event" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">startup_event</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize database on startup.</p>

            <details class="quote">
              <summary>Source code in <code>app/main.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@app</span><span class="o">.</span><span class="n">on_event</span><span class="p">(</span><span class="s2">&quot;startup&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">startup_event</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize database on startup.&quot;&quot;&quot;</span>
    <span class="n">init_db</span><span class="p">()</span>

    <span class="c1"># Create reports directory if it doesn&#39;t exist</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">app.utils.report.report_generator</span><span class="w"> </span><span class="kn">import</span> <span class="n">REPORTS_DIR</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">REPORTS_DIR</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.generate_report" class="doc doc-heading">
            <code>app.generate_report</code>


</h2>

    <div class="doc doc-contents first">

        <p>CLI script to generate energy reports directly from the command line.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.generate_report.get_user_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">generate_report</span><span class="o">.</span><span class="n">get_user_devices</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get all devices for a user.</p>

            <details class="quote">
              <summary>Source code in <code>app/generate_report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_user_devices</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all devices for a user.&quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.generate_report.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">generate_report</span><span class="o">.</span><span class="n">main</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a report based on command line arguments.</p>

            <details class="quote">
              <summary>Source code in <code>app/generate_report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a report based on command line arguments.&quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Validate user</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">validate_user_id</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating report for user: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Determine date range</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">historical</span><span class="p">:</span>
        <span class="c1"># Use March 2024 dates where we know data exists</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>  <span class="c1"># Latest record date</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using historical data period (March 2024)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use current dates</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using current date period&quot;</span><span class="p">)</span>

    <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date range: </span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get device IDs if not specified</span>
    <span class="n">device_ids</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device_ids</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">get_user_devices</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
        <span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using all devices (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">) for the user&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using specified devices: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create a title if not specified</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Energy Report (</span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="c1"># Generate a UUID for the report</span>
    <span class="n">report_uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="c1"># Create report object</span>
    <span class="n">report_db</span> <span class="o">=</span> <span class="n">ReportDB</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">report_uuid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="n">report_type</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">report_type</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date_str</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date_str</span><span class="p">,</span>
        <span class="n">device_ids</span><span class="o">=</span><span class="n">device_ids</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;pending&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Create report in database</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating report record...&quot;</span><span class="p">)</span>
    <span class="n">mongo_id</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">create_report</span><span class="p">(</span><span class="n">report_db</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report record created with MongoDB ID: </span><span class="si">{</span><span class="n">mongo_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report UUID: </span><span class="si">{</span><span class="n">report_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate the report using the UUID we assigned</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating report...&quot;</span><span class="p">)</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">report_uuid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="n">file_path</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report successfully generated!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating report: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.generate_report.parse_args" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">generate_report</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Parse command line arguments.</p>

            <details class="quote">
              <summary>Source code in <code>app/generate_report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">parse_args</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Parse command line arguments.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Generate energy usage reports&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--user_id&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;User ID to generate report for&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report format&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--days&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of days to include in report&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--title&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report title&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--device_ids&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specific device IDs to include (space-separated)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--report_type&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report type (default: energy)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--historical&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use historical data (March 2024)&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.generate_report.validate_user_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">generate_report</span><span class="o">.</span><span class="n">validate_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the user exists in the database.</p>

            <details class="quote">
              <summary>Source code in <code>app/generate_report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the user exists in the database.&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: User with ID </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.data_util" class="doc doc-heading">
            <code>app.data_util</code>


</h2>

    <div class="doc doc-contents first">

        <p>Utility to check for usage data and optionally generate test data.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.data_util.check_usage_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">data_util</span><span class="o">.</span><span class="n">check_usage_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if usage data exists for a user's devices.</p>

            <details class="quote">
              <summary>Source code in <code>app/data_util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_usage_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if usage data exists for a user&#39;s devices.&quot;&quot;&quot;</span>
    <span class="c1"># Get devices for the user</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
    <span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No devices found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span><span class="si">}</span><span class="s2"> devices for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check for usage data within the specified time range</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">},</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
            <span class="s2">&quot;$lte&quot;</span><span class="p">:</span> <span class="n">end_date</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">count</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">count_documents</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> usage records in the last </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No usage records found in the last </span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
        <span class="c1"># Check if there&#39;s any usage data at all for these devices</span>
        <span class="n">all_time_count</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">count_documents</span><span class="p">({</span><span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}})</span>
        <span class="k">if</span> <span class="n">all_time_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">all_time_count</span><span class="si">}</span><span class="s2"> usage records for these devices across all time&quot;</span><span class="p">)</span>
            <span class="c1"># Show the earliest and latest records</span>
            <span class="n">earliest</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}})</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">latest</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}})</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">earliest_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">earliest</span><span class="p">)</span>
            <span class="n">latest_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">latest</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">earliest_list</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Earliest record: </span><span class="si">{</span><span class="n">earliest_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">latest_list</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Latest record: </span><span class="si">{</span><span class="n">latest_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No usage records found for these devices at all&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.data_util.generate_test_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">data_util</span><span class="o">.</span><span class="n">generate_test_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">records_per_device</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate test usage data for a user's devices.</p>

            <details class="quote">
              <summary>Source code in <code>app/data_util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_test_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">records_per_device</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate test usage data for a user&#39;s devices.&quot;&quot;&quot;</span>
    <span class="c1"># Get devices for the user</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">devices</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No devices found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating test data for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s2"> devices&quot;</span><span class="p">)</span>

    <span class="c1"># Generate data</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">days</span><span class="p">)</span>

    <span class="n">generated_count</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">device_name</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;Unknown Device&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">records_per_device</span><span class="p">):</span>
            <span class="c1"># Generate a random timestamp in the date range</span>
            <span class="n">random_days</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">days</span><span class="p">)</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_days</span><span class="p">)</span>

            <span class="c1"># Generate random energy consumption (0.1 to 5.0 kWh)</span>
            <span class="n">energy_consumed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Generate random duration (10 to 480 minutes)</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>

            <span class="c1"># Create usage record</span>
            <span class="n">usage_record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
                <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="n">energy_consumed</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;idle&quot;</span><span class="p">]),</span>
                <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;light&quot;</span> <span class="ow">in</span> <span class="n">device_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;usage_minutes&quot;</span><span class="p">:</span> <span class="n">duration</span>
                <span class="p">},</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">timestamp</span>
            <span class="p">}</span>

            <span class="c1"># Insert into the database</span>
            <span class="n">us_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">usage_record</span><span class="p">)</span>
            <span class="n">generated_count</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated </span><span class="si">{</span><span class="n">generated_count</span><span class="si">}</span><span class="s2"> test usage records&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.inspect_data" class="doc doc-heading">
            <code>app.inspect_data</code>


</h2>

    <div class="doc doc-contents first">

        <p>Script to inspect and fix usage data for generating reports.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.inspect_data.inspect_usage_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">inspect_data</span><span class="o">.</span><span class="n">inspect_usage_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Inspect usage data for a user in a specific date range.</p>

            <details class="quote">
              <summary>Source code in <code>app/inspect_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">inspect_usage_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inspect usage data for a user in a specific date range.&quot;&quot;&quot;</span>
    <span class="c1"># Get devices for the user</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
    <span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No devices found for user </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Build query</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">},</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
            <span class="s2">&quot;$lte&quot;</span><span class="p">:</span> <span class="n">end_date</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Fetch the records</span>
    <span class="n">records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span><span class="si">}</span><span class="s2"> records in the date range&quot;</span><span class="p">)</span>

    <span class="c1"># Check for missing fields</span>
    <span class="n">fields_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="s2">&quot;duration&quot;</span><span class="p">,</span> <span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="s2">&quot;metrics&quot;</span><span class="p">]</span>
    <span class="n">missing_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_check</span><span class="p">:</span>
        <span class="n">missing_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">records</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields_to_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">record</span> <span class="ow">or</span> <span class="n">record</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">missing_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Missing fields summary:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">missing_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2">: Missing in </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2"> records (</span><span class="si">{</span><span class="n">count</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">records</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%)&quot;</span><span class="p">)</span>

    <span class="c1"># Show a few example records</span>
    <span class="k">if</span> <span class="n">records</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Sample record structure:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Check for None values in energy_consumed</span>
    <span class="n">none_energy</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">records</span> <span class="k">if</span> <span class="s2">&quot;energy_consumed&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">r</span> <span class="ow">or</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">none_energy</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">none_energy</span><span class="p">)</span><span class="si">}</span><span class="s2"> records with None energy_consumed values&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Would you like to fix these records? (y/n)&quot;</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="nb">input</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">response</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">none_energy</span><span class="p">:</span>
                <span class="c1"># Update with default value</span>
                <span class="n">us_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;_id&quot;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;_id&quot;</span><span class="p">]},</span>
                    <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">}}</span>
                <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fixed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">none_energy</span><span class="p">)</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>

    <span class="c1"># Return the records for additional processing</span>
    <span class="k">return</span> <span class="n">records</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.patched_report_generator" class="doc doc-heading">
            <code>app.patched_report_generator</code>


</h2>

    <div class="doc doc-contents first">

        <p>Patched version of report generator that handles None values.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.fetch_energy_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">fetch_energy_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Patched version of fetch_energy_data that handles None values.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span>
<span class="normal">98</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_energy_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patched version of fetch_energy_data that handles None values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build the query</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Filter by device IDs</span>
    <span class="k">if</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Get all devices owned by the user</span>
        <span class="n">user_devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">user_device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">user_device_ids</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">user_device_ids</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Add date range filter</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">or</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="n">timestamp_query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">start_date</span><span class="p">:</span>
            <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="k">if</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_date</span>

        <span class="k">if</span> <span class="n">timestamp_query</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp_query</span>

    <span class="c1"># Execute the query</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cursor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">usage_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usage data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">, length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Fix missing or None values</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">record</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">usage_data</span><span class="p">):</span>
        <span class="c1"># Fill in missing energy_consumed with zeros</span>
        <span class="k">if</span> <span class="s2">&quot;energy_consumed&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">record</span> <span class="ow">or</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fixing record </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Adding default energy_consumed = 0.0&quot;</span><span class="p">)</span>
            <span class="n">record</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="c1"># Convert timestamp to ISO format if it&#39;s a datetime object</span>
        <span class="k">if</span> <span class="s2">&quot;timestamp&quot;</span> <span class="ow">in</span> <span class="n">record</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">):</span>
            <span class="n">record</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

    <span class="c1"># Enhance usage data with device information</span>
    <span class="n">enhanced_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">usage_data</span><span class="p">:</span>
        <span class="c1"># Get device info</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

        <span class="c1"># Create enhanced record with location</span>
        <span class="n">enhanced_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span>
            <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
            <span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>  <span class="c1"># Default to 0 if missing</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;room_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="p">}</span>

        <span class="n">enhanced_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enhanced_record</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">enhanced_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.fetch_user_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">fetch_user_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Fetch user data for report personalization.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fetch_user_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fetch user data for report personalization.&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.generate_energy_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">generate_energy_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Patched version that handles the path to the report generator.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_energy_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patched version that handles the path to the report generator.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">app.utils.report.report_generator</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_energy_report</span> <span class="k">as</span> <span class="n">gen_report</span>

    <span class="c1"># Print some debug info</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating </span><span class="si">{</span><span class="nb">format</span><span class="si">}</span><span class="s2"> report with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> records&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="n">energy_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Sample record: </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Call the original function</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="n">gen_report</span><span class="p">(</span>
            <span class="n">energy_data</span><span class="o">=</span><span class="n">energy_data</span><span class="p">,</span>
            <span class="n">user_data</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">report_path</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in report generation: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.generate_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Patched version of generate_report that uses our fixed functions.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Patched version of generate_report that uses our fixed functions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get report data</span>
    <span class="n">report_data</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Report not found&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Update status to generating</span>
        <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;generating&quot;</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}}</span>
        <span class="p">)</span>

        <span class="c1"># Fetch energy data with our patched function</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">):</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;start_date&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">):</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;end_date&quot;</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">energy_data</span> <span class="o">=</span> <span class="n">fetch_energy_data</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
            <span class="n">device_ids</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">energy_data</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;No energy data found for the specified criteria&quot;</span>
            <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="c1"># Fetch user data for personalization</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">fetch_user_data</span><span class="p">(</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>

        <span class="c1"># Generate the report with our patched function</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="n">generate_energy_report</span><span class="p">(</span>
            <span class="n">energy_data</span><span class="o">=</span><span class="n">energy_data</span><span class="p">,</span>
            <span class="n">user_data</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_path</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to generate report file&quot;</span>
            <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">error_msg</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}}</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="c1"># Update the report record with success status</span>
        <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;completed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;file_path&quot;</span><span class="p">:</span> <span class="n">report_path</span><span class="p">,</span>
                <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
            <span class="p">}}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">report_path</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Update the report record with failure status</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;failed&quot;</span><span class="p">,</span> <span class="s2">&quot;error_message&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.get_user_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">get_user_devices</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get all devices for a user.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_user_devices</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all devices for a user.&quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">main</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Patched report generation script.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Patched report generation script.&quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;Generate energy usage reports&quot;</span><span class="p">)</span>

    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--user_id&quot;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;User ID to generate report for&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--format&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="s2">&quot;csv&quot;</span><span class="p">],</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;pdf&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report format&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--days&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of days to include in report&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--title&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report title&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--device_ids&quot;</span><span class="p">,</span> <span class="n">nargs</span><span class="o">=</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Specific device IDs to include (space-separated)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--report_type&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Report type (default: energy)&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--historical&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Use historical data (March 2024)&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parse_args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="c1"># Validate user</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">validate_user_id</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generating report for user: </span><span class="si">{</span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Determine date range</span>
    <span class="k">if</span> <span class="n">args</span><span class="o">.</span><span class="n">historical</span><span class="p">:</span>
        <span class="c1"># Use March 2024 dates where we know data exists</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">19</span><span class="p">)</span>  <span class="c1"># Latest record date</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using historical data period (March 2024)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Use current dates</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">days</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Using current date period&quot;</span><span class="p">)</span>

    <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">end_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date range: </span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Get device IDs if not specified</span>
    <span class="n">device_ids</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">device_ids</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">get_user_devices</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">)</span>
        <span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using all devices (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">) for the user&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using specified devices: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Create a title if not specified</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">title</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Energy Report (</span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="c1"># Generate a UUID for the report</span>
    <span class="n">report_uuid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="c1"># Create report object</span>
    <span class="n">report_db</span> <span class="o">=</span> <span class="n">ReportDB</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">report_uuid</span><span class="p">,</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">format</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="n">report_type</span><span class="o">=</span><span class="n">args</span><span class="o">.</span><span class="n">report_type</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date_str</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date_str</span><span class="p">,</span>
        <span class="n">device_ids</span><span class="o">=</span><span class="n">device_ids</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="s2">&quot;pending&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Create report in database</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Creating report record...&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">report_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report record created with MongoDB ID: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">inserted_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report UUID: </span><span class="si">{</span><span class="n">report_uuid</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate the report using the UUID we assigned</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generating report...&quot;</span><span class="p">)</span>
    <span class="n">success</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="n">generate_report</span><span class="p">(</span><span class="n">report_uuid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">success</span> <span class="ow">and</span> <span class="n">file_path</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report successfully generated!&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report file: </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error generating report: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.patched_report_generator.validate_user_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">patched_report_generator</span><span class="o">.</span><span class="n">validate_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the user exists in the database.</p>

            <details class="quote">
              <summary>Source code in <code>app/patched_report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the user exists in the database.&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: User with ID </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.core.auth" class="doc doc-heading">
            <code>app.core.auth</code>


</h2>

    <div class="doc doc-contents first">

        <p>Authentication dependencies for FastAPI.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.core.auth.get_current_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">auth</span><span class="o">.</span><span class="n">get_current_user</span><span class="p">(</span><span class="n">credentials</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">security</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the currently authenticated user.</p>
<p>Uses HTTP Basic Authentication to validate the user.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>credentials</code>
            </td>
            <td>
                  <code><span title="fastapi.security.HTTPBasicCredentials">HTTPBasicCredentials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The HTTP Basic credentials from the request</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<span title="app.core.auth.security">security</span>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>UserDB</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="fastapi.HTTPException">HTTPException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If authentication fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/core/auth.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_current_user</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="n">HTTPBasicCredentials</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">security</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">UserDB</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the currently authenticated user.</span>

<span class="sd">    Uses HTTP Basic Authentication to validate the user.</span>

<span class="sd">    Args:</span>
<span class="sd">        credentials: The HTTP Basic credentials from the request</span>

<span class="sd">    Returns:</span>
<span class="sd">        UserDB: The authenticated user</span>

<span class="sd">    Raises:</span>
<span class="sd">        HTTPException: If authentication fails</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">auth_exception</span> <span class="o">=</span> <span class="n">HTTPException</span><span class="p">(</span>
        <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
        <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Invalid username or password&quot;</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;WWW-Authenticate&quot;</span><span class="p">:</span> <span class="s2">&quot;Basic&quot;</span><span class="p">},</span>
    <span class="p">)</span>

    <span class="c1"># Try to find user by username</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">})</span>

    <span class="c1"># If not found, try by email</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">credentials</span><span class="o">.</span><span class="n">username</span><span class="p">})</span>

    <span class="c1"># Check credentials</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">verify_password</span><span class="p">(</span><span class="n">credentials</span><span class="o">.</span><span class="n">password</span><span class="p">,</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;hashed_password&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="n">auth_exception</span>

    <span class="c1"># Check if user is active</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>  <span class="c1"># Default to active if not specified</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_401_UNAUTHORIZED</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Inactive user account&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;WWW-Authenticate&quot;</span><span class="p">:</span> <span class="s2">&quot;Basic&quot;</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">UserDB</span><span class="p">(</span><span class="o">**</span><span class="n">user</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.core.password" class="doc doc-heading">
            <code>app.core.password</code>


</h2>

    <div class="doc doc-contents first">

        <p>Implements password security features.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.core.password.hash_password" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Hashes a password.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Password to hash.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hashed password.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If password fails to hash.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/core/password.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hash_password</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hashes a password.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (str): Password to hash.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Hashed password.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If password fails to hash.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pc</span><span class="o">.</span><span class="n">hash</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error hashing password: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.core.password.verify_password" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">verify_password</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Matches plain-text password with the hashed password.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Plain-text password.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>h</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hashed password.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(True: Passwords match); (False: Passwords don't match).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If passwords fail to compare.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/core/password.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_password</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">h</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matches plain-text password with the hashed password.</span>

<span class="sd">    Args:</span>
<span class="sd">        p (str): Plain-text password.</span>
<span class="sd">        h (str): Hashed password.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: (True: Passwords match); (False: Passwords don&#39;t match).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If passwords fail to compare.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pc</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error verifying password: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">e</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.core.password.verify_role" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">password</span><span class="o">.</span><span class="n">verify_role</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Enforces correct user role for access.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's current role.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required user role.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="fastapi.HTTPException">HTTPException</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If user lacks the required role.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/core/password.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">verify_role</span><span class="p">(</span><span class="n">u</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enforces correct user role for access.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (str): User&#39;s current role.</span>
<span class="sd">        r (str): Required user role.</span>

<span class="sd">    Raises:</span>
<span class="sd">        HTTPException: If user lacks the required role.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span> <span class="o">!=</span> <span class="n">r</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Permission denied. </span><span class="si">{</span><span class="n">r</span><span class="si">}</span><span class="s2"> role is required for access.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.db.data" class="doc doc-heading">
            <code>app.db.data</code>


</h2>

    <div class="doc doc-contents first">

        <p>Handles MongoDB database connections &amp; operations.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.db.data.init_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">init_db</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize MongoDB database &amp; creates indexes.</p>

            <details class="quote">
              <summary>Source code in <code>app/db/data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">init_db</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize MongoDB database &amp; creates indexes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># User collection</span>
    <span class="n">u_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># Unique identification</span>
    <span class="n">u_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Unique email address</span>
    <span class="n">u_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>            <span class="c1"># General username</span>

    <span class="c1"># Profile collection</span>
    <span class="n">p_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>         <span class="c1"># Unique identification</span>
    <span class="n">p_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>    <span class="c1"># Unique user identification</span>

    <span class="c1"># Device collection</span>
    <span class="n">d_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>             <span class="c1"># Device identification</span>
    <span class="n">d_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>                     <span class="c1"># User identification</span>
    <span class="n">d_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span> <span class="c1"># Filter type through user identification</span>

    <span class="c1"># Room collection</span>
    <span class="n">r_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># Unique identification</span>
    <span class="n">r_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>             <span class="c1"># User identification</span>
    <span class="n">r_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;home_id&quot;</span><span class="p">)</span>             <span class="c1"># Home identification</span>

    <span class="c1"># Usage collection</span>
    <span class="n">us_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                     <span class="c1"># Unique identification</span>
    <span class="n">us_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>                           <span class="c1"># Device identification</span>
    <span class="n">us_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span>                           <span class="c1"># Usage log</span>
    <span class="n">us_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;device_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>  <span class="c1"># Filter log by device identification</span>

    <span class="c1"># Automation collection</span>
    <span class="n">a_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>     <span class="c1"># Unique identification</span>
    <span class="n">a_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>             <span class="c1"># User identification</span>
    <span class="n">a_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>           <span class="c1"># User identification</span>

    <span class="c1"># Notification collection</span>
    <span class="n">n_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                 <span class="c1"># Unique identification</span>
    <span class="n">n_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>                                         <span class="c1"># User identification</span>
    <span class="n">n_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>  <span class="c1"># Filter notification read by device &amp; time</span>

    <span class="c1"># Access Management collection</span>
    <span class="n">am_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                        <span class="c1"># Unique identification</span>
    <span class="n">am_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;owner_id&quot;</span><span class="p">)</span>                               <span class="c1"># Owner identification</span>
    <span class="n">am_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;resource_id&quot;</span><span class="p">)</span>                            <span class="c1"># Resource identification</span>
    <span class="n">am_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;owner_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;resource_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>    <span class="c1"># Filters resource by its owner</span>

    <span class="c1"># Goal collection</span>
    <span class="n">g_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                 <span class="c1"># Unique identification</span>
    <span class="n">g_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>                         <span class="c1"># User identification</span>
    <span class="n">g_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">)</span>                            <span class="c1"># Type of goal</span>
    <span class="n">g_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)])</span>     <span class="c1"># Filters types of goals by user identification</span>

    <span class="c1"># Analytics collection</span>
    <span class="n">an_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                    <span class="c1"># Unique identification</span>
    <span class="n">an_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>                            <span class="c1"># User identification</span>
    <span class="n">an_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>                          <span class="c1"># Device identification</span>
    <span class="n">an_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>  <span class="c1"># Filters user identification by timestamp</span>

    <span class="c1"># Suggestion collection</span>
    <span class="n">s_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>                                     <span class="c1"># Unique identification</span>
    <span class="n">s_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>                                             <span class="c1"># User identification</span>
    <span class="n">s_c</span><span class="o">.</span><span class="n">create_index</span><span class="p">([(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)])</span>    <span class="c1"># Filters user identification with status by timestamp</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Database initialized with indexes.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.access_management" class="doc doc-heading">
            <code>app.models.access_management</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for access management validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.AccessLevel" class="doc doc-heading">
            <code>app.models.access_management.AccessLevel</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for access permission levels.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AccessLevel</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for access permission levels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">READ</span> <span class="o">=</span> <span class="s2">&quot;read&quot;</span>
    <span class="n">CONTROL</span> <span class="o">=</span> <span class="s2">&quot;control&quot;</span>
    <span class="n">MANAGE</span> <span class="o">=</span> <span class="s2">&quot;manage&quot;</span>
    <span class="n">ADMIN</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.AccessManagementDB" class="doc doc-heading">
            <code>app.models.access_management.AccessManagementDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing access management data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.owner_id">owner_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the resource.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.resource_id">resource_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.resource_type">resource_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.ResourceType" href="#app.models.access_management.ResourceType">ResourceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user granted access.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.access_level">access_level</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.AccessLevel" href="#app.models.access_management.AccessLevel">AccessLevel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Level of access granted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access was granted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.expires_at">expires_at</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access expires.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.active">active</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this access grant is currently active.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementDB.note">note</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional note about this access grant.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AccessManagementDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing access management data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique identifier.</span>
<span class="sd">        owner_id (str): ID of the user who owns the resource.</span>
<span class="sd">        resource_id (str): ID of the resource being shared.</span>
<span class="sd">        resource_type (ResourceType): Type of resource being shared.</span>
<span class="sd">        user_id (str): ID of the user granted access.</span>
<span class="sd">        access_level (AccessLevel): Level of access granted.</span>
<span class="sd">        created (datetime): When the access was granted.</span>
<span class="sd">        updated (Optional[datetime]): When the access was last updated.</span>
<span class="sd">        expires_at (Optional[datetime]): When the access expires.</span>
<span class="sd">        active (bool): Whether this access grant is currently active.</span>
<span class="sd">        note (Optional[str]): Optional note about this access grant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="n">ResourceType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_level</span><span class="p">:</span> <span class="n">AccessLevel</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">note</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.AccessManagementResponse" class="doc doc-heading">
            <code>app.models.access_management.AccessManagementResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for access management data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.owner_id">owner_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the resource.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.resource_id">resource_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.resource_type">resource_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.ResourceType" href="#app.models.access_management.ResourceType">ResourceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user granted access.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.access_level">access_level</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.AccessLevel" href="#app.models.access_management.AccessLevel">AccessLevel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Level of access granted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access was granted.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.expires_at">expires_at</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access expires.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementResponse.active">active</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this access grant is currently active.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AccessManagementResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for access management data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique identifier.</span>
<span class="sd">        owner_id (str): ID of the user who owns the resource.</span>
<span class="sd">        resource_id (str): ID of the resource being shared.</span>
<span class="sd">        resource_type (ResourceType): Type of resource being shared.</span>
<span class="sd">        user_id (str): ID of the user granted access.</span>
<span class="sd">        access_level (AccessLevel): Level of access granted.</span>
<span class="sd">        created (datetime): When the access was granted.</span>
<span class="sd">        expires_at (Optional[datetime]): When the access expires.</span>
<span class="sd">        active (bool): Whether this access grant is currently active.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="n">ResourceType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">access_level</span><span class="p">:</span> <span class="n">AccessLevel</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">note</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.AccessManagementUpdate" class="doc doc-heading">
            <code>app.models.access_management.AccessManagementUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating access management entries.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementUpdate.access_level">access_level</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.access_management.AccessLevel" href="#app.models.access_management.AccessLevel">AccessLevel</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated access level.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementUpdate.expires_at">expires_at</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated expiration time.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementUpdate.active">active</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated active status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.AccessManagementUpdate.note">note</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated note.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AccessManagementUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating access management entries.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        access_level (Optional[AccessLevel]): Updated access level.</span>
<span class="sd">        expires_at (Optional[datetime]): Updated expiration time.</span>
<span class="sd">        active (Optional[bool]): Updated active status.</span>
<span class="sd">        note (Optional[str]): Updated note.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">access_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessLevel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">note</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_note</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate note length.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            n (Optional[str]): Note to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated note.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Note must be less than 200 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.access_management.AccessManagementUpdate.validate_note" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">access_management</span><span class="o">.</span><span class="n">AccessManagementUpdate</span><span class="o">.</span><span class="n">validate_note</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate note length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Note to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated note.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If validation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/access_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_note</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate note length.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n (Optional[str]): Note to validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated note.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Note must be less than 200 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.CreateAccessManagement" class="doc doc-heading">
            <code>app.models.access_management.CreateAccessManagement</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for creating access management entries.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.owner_id">owner_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the resource.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.resource_id">resource_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.resource_type">resource_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.ResourceType" href="#app.models.access_management.ResourceType">ResourceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of resource being shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.user_ids">user_ids</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of user IDs to grant access to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.access_level">access_level</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.access_management.AccessLevel" href="#app.models.access_management.AccessLevel">AccessLevel</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Level of access to grant.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.expires_at">expires_at</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the access expires (optional).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.access_management.CreateAccessManagement.note">note</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional note about this access grant.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateAccessManagement</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for creating access management entries.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        owner_id (str): ID of the user who owns the resource.</span>
<span class="sd">        resource_id (str): ID of the resource being shared.</span>
<span class="sd">        resource_type (ResourceType): Type of resource being shared.</span>
<span class="sd">        user_ids (List[str]): List of user IDs to grant access to.</span>
<span class="sd">        access_level (AccessLevel): Level of access to grant.</span>
<span class="sd">        expires_at (Optional[datetime]): When the access expires (optional).</span>
<span class="sd">        note (Optional[str]): Optional note about this access grant.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="n">ResourceType</span>
    <span class="n">user_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">access_level</span><span class="p">:</span> <span class="n">AccessLevel</span>
    <span class="n">expires_at</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">note</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_note</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate note length.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            n (Optional[str]): Note to validate.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated note.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Note must be less than 200 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_ids&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_user_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate user IDs list.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            u (List[str]): List of user IDs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: Validated list of user IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one user ID must be provided.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot share with more than 50 users at once.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.access_management.CreateAccessManagement.validate_note" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">access_management</span><span class="o">.</span><span class="n">CreateAccessManagement</span><span class="o">.</span><span class="n">validate_note</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate note length.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Note to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated note.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If validation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/access_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;note&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_note</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate note length.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n (Optional[str]): Note to validate.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated note.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Note must be less than 200 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.access_management.CreateAccessManagement.validate_user_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">access_management</span><span class="o">.</span><span class="n">CreateAccessManagement</span><span class="o">.</span><span class="n">validate_user_ids</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate user IDs list.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of user IDs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: Validated list of user IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If validation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/access_management.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_ids&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_user_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate user IDs list.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        u (List[str]): List of user IDs.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: Validated list of user IDs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">u</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one user ID must be provided.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot share with more than 50 users at once.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.access_management.ResourceType" class="doc doc-heading">
            <code>app.models.access_management.ResourceType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for supported resource types in the system.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/access_management.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ResourceType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for supported resource types in the system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEVICE</span> <span class="o">=</span> <span class="s2">&quot;device&quot;</span>
    <span class="n">ROOM</span> <span class="o">=</span> <span class="s2">&quot;room&quot;</span>
    <span class="n">HOME</span> <span class="o">=</span> <span class="s2">&quot;home&quot;</span>
    <span class="n">AUTOMATION</span> <span class="o">=</span> <span class="s2">&quot;automation&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.analytics" class="doc doc-heading">
            <code>app.models.analytics</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for analytics validation and storage.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.analytics.AnalyticsDB" class="doc doc-heading">
            <code>app.models.analytics.AnalyticsDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing analytics data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique analytics identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user the analytics belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device generating the analytics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.data_type">data_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of analytics data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actual metrics being stored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.tags">tags</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tags for categorizing analytics data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the analytics data was recorded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the analytics data was last updated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/analytics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnalyticsDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing analytics data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique analytics identifier.</span>
<span class="sd">        user_id (str): ID of the user the analytics belongs to.</span>
<span class="sd">        device_id (str): ID of the device generating the analytics.</span>
<span class="sd">        data_type (str): Type of analytics data.</span>
<span class="sd">        metrics (Dict[str, Any]): The actual metrics being stored.</span>
<span class="sd">        tags (List[str]): Tags for categorizing analytics data.</span>
<span class="sd">        timestamp (datetime): When the analytics data was recorded.</span>
<span class="sd">        updated (Optional[datetime]): When the analytics data was last updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.analytics.AnalyticsQuery" class="doc doc-heading">
            <code>app.models.analytics.AnalyticsQuery</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for querying analytics data with filters.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.user_id">user_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by user ID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.device_id">device_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by device ID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.data_type">data_type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by data type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.start_time">start_time</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by start timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.end_time">end_time</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by end timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsQuery.tags">tags</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by tags.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/analytics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnalyticsQuery</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for querying analytics data with filters.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (Optional[str]): Filter by user ID.</span>
<span class="sd">        device_id (Optional[str]): Filter by device ID.</span>
<span class="sd">        data_type (Optional[str]): Filter by data type.</span>
<span class="sd">        start_time (Optional[datetime]): Filter by start timestamp.</span>
<span class="sd">        end_time (Optional[datetime]): Filter by end timestamp.</span>
<span class="sd">        tags (Optional[List[str]]): Filter by tags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_time_range</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that start_time comes before end_time if both are provided.</span>

<span class="sd">        Note: This validation only runs after all fields are populated, so it</span>
<span class="sd">        needs to be called separately after instantiation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_time_range_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that start_time comes before end_time if both are provided.</span>
<span class="sd">        Call this after instantiating the model.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_time must be before end_time&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.analytics.AnalyticsQuery.validate_time_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">AnalyticsQuery</span><span class="o">.</span><span class="n">validate_time_range</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate that start_time comes before end_time if both are provided.</p>
<p>Note: This validation only runs after all fields are populated, so it
needs to be called separately after instantiation.</p>

            <details class="quote">
              <summary>Source code in <code>app/models/analytics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">,</span> <span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_time_range</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that start_time comes before end_time if both are provided.</span>

<span class="sd">    Note: This validation only runs after all fields are populated, so it</span>
<span class="sd">    needs to be called separately after instantiation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.analytics.AnalyticsQuery.validate_time_range_post_init" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">AnalyticsQuery</span><span class="o">.</span><span class="n">validate_time_range_post_init</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Validate that start_time comes before end_time if both are provided.
Call this after instantiating the model.</p>

            <details class="quote">
              <summary>Source code in <code>app/models/analytics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_time_range_post_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that start_time comes before end_time if both are provided.</span>
<span class="sd">    Call this after instantiating the model.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;start_time must be before end_time&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.analytics.AnalyticsResponse" class="doc doc-heading">
            <code>app.models.analytics.AnalyticsResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for analytics data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique analytics identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user the analytics belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device generating the analytics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.data_type">data_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of analytics data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actual metrics being stored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.tags">tags</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tags for categorizing analytics data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsResponse.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the analytics data was recorded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/analytics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnalyticsResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for analytics data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique analytics identifier.</span>
<span class="sd">        user_id (str): ID of the user the analytics belongs to.</span>
<span class="sd">        device_id (str): ID of the device generating the analytics.</span>
<span class="sd">        data_type (str): Type of analytics data.</span>
<span class="sd">        metrics (Dict[str, Any]): The actual metrics being stored.</span>
<span class="sd">        tags (List[str]): Tags for categorizing analytics data.</span>
<span class="sd">        timestamp (datetime): When the analytics data was recorded.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.analytics.AnalyticsUpdate" class="doc doc-heading">
            <code>app.models.analytics.AnalyticsUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating analytics information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsUpdate.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated metrics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.AnalyticsUpdate.tags">tags</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated tags for categorizing analytics data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/analytics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AnalyticsUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating analytics information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        metrics (Optional[Dict[str, Any]]): Updated metrics.</span>
<span class="sd">        tags (Optional[List[str]]): Updated tags for categorizing analytics data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_tags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate tags.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (Optional[List[str]]): Tags to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[List[str]]: Validated tags.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If tags contain empty strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tags cannot contain empty strings.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.analytics.AnalyticsUpdate.validate_tags" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">AnalyticsUpdate</span><span class="o">.</span><span class="n">validate_tags</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate tags.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tags to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[List[str]]: Validated tags.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If tags contain empty strings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/analytics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_tags</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate tags.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (Optional[List[str]]): Tags to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[List[str]]: Validated tags.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If tags contain empty strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="ow">not</span> <span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">v</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Tags cannot contain empty strings.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">tag</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.analytics.CreateAnalytics" class="doc doc-heading">
            <code>app.models.analytics.CreateAnalytics</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for analytics data input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.CreateAnalytics.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user the analytics belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.CreateAnalytics.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device generating the analytics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.CreateAnalytics.data_type">data_type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of analytics data (energy, usage, temperature, etc.).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.CreateAnalytics.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actual metrics being stored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.analytics.CreateAnalytics.tags">tags</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tags for categorizing analytics data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/analytics.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateAnalytics</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for analytics data input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): ID of the user the analytics belongs to.</span>
<span class="sd">        device_id (str): ID of the device generating the analytics.</span>
<span class="sd">        data_type (str): Type of analytics data (energy, usage, temperature, etc.).</span>
<span class="sd">        metrics (Dict[str, Any]): The actual metrics being stored.</span>
<span class="sd">        tags (List[str]): Optional tags for categorizing analytics data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate ID fields.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (str): ID to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated ID.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If ID is empty or doesn&#39;t match UUID format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ID cannot be empty.&quot;</span><span class="p">)</span>

        <span class="c1"># Try to parse as UUID to ensure valid format</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ID must be a valid UUID format.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_data_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate data_type field.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (str): data_type to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated data_type.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If data_type is empty or invalid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">,</span> <span class="s2">&quot;motion&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data type cannot be empty.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_types</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data type must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.analytics.CreateAnalytics.validate_data_type" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">CreateAnalytics</span><span class="o">.</span><span class="n">validate_data_type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate data_type field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>data_type to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated data_type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If data_type is empty or invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/analytics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;data_type&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_data_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate data_type field.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (str): data_type to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated data_type.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If data_type is empty or invalid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">,</span> <span class="s2">&quot;motion&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">,</span> <span class="s2">&quot;other&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Data type cannot be empty.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_types</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data type must be one of: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_types</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.analytics.CreateAnalytics.validate_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">analytics</span><span class="o">.</span><span class="n">CreateAnalytics</span><span class="o">.</span><span class="n">validate_id</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate ID fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If ID is empty or doesn't match UUID format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/analytics.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">,</span> <span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate ID fields.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (str): ID to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated ID.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If ID is empty or doesn&#39;t match UUID format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ID cannot be empty.&quot;</span><span class="p">)</span>

    <span class="c1"># Try to parse as UUID to ensure valid format</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;ID must be a valid UUID format.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.automation" class="doc doc-heading">
            <code>app.models.automation</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for automation validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.automation.ActionType" class="doc doc-heading">
            <code>app.models.automation.ActionType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for different types of automation actions.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ActionType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for different types of automation actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEVICE_CONTROL</span> <span class="o">=</span> <span class="s2">&quot;device_control&quot;</span>
    <span class="n">NOTIFICATION</span> <span class="o">=</span> <span class="s2">&quot;notification&quot;</span>
    <span class="n">SCENE_ACTIVATION</span> <span class="o">=</span> <span class="s2">&quot;scene_activation&quot;</span>
    <span class="n">ENERGY_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;energy_management&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.AutomationDB" class="doc doc-heading">
            <code>app.models.automation.AutomationDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing automation data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique automation identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of what the automation does.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device associated with this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.enabled">enabled</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the automation is enabled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.trigger_type">trigger_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.TriggerType" href="#app.models.automation.TriggerType">TriggerType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of trigger for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.trigger_data">trigger_data</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration data for the trigger.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.action_type">action_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.ActionType" href="#app.models.automation.ActionType">ActionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of action for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.action_data">action_data</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration data for the action.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.conditions">conditions</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conditions that must be met.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the automation was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the automation was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.last_triggered">last_triggered</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the automation was last triggered.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationDB.execution_count">execution_count</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of times the automation has executed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutomationDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing automation data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique automation identifier.</span>
<span class="sd">        name (str): Name of the automation.</span>
<span class="sd">        description (str): Description of what the automation does.</span>
<span class="sd">        user_id (str): ID of the user who owns this automation.</span>
<span class="sd">        device_id (str): ID of the device associated with this automation.</span>
<span class="sd">        enabled (bool): Whether the automation is enabled.</span>
<span class="sd">        trigger_type (TriggerType): Type of trigger for this automation.</span>
<span class="sd">        trigger_data (Dict): Configuration data for the trigger.</span>
<span class="sd">        action_type (ActionType): Type of action for this automation.</span>
<span class="sd">        action_data (Dict): Configuration data for the action.</span>
<span class="sd">        conditions (Optional[List[Dict]]): Optional conditions that must be met.</span>
<span class="sd">        created (datetime): When the automation was created.</span>
<span class="sd">        updated (Optional[datetime]): When the automation was last updated.</span>
<span class="sd">        last_triggered (Optional[datetime]): When the automation was last triggered.</span>
<span class="sd">        execution_count (int): Number of times the automation has executed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">trigger_type</span><span class="p">:</span> <span class="n">TriggerType</span>
    <span class="n">trigger_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="n">ActionType</span>
    <span class="n">action_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_triggered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">execution_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.AutomationDetailResponse" class="doc doc-heading">
            <code>app.models.automation.AutomationDetailResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="app.models.automation.AutomationResponse" href="#app.models.automation.AutomationResponse">AutomationResponse</a></code></p>


        <p>Detailed model for automation data returned in API responses.
Extends AutomationResponse to include configuration details.</p>


<details class="additional-attributes" open>
  <summary>Additional Attributes</summary>
  <p>trigger_data (Dict): Configuration data for the trigger.
action_data (Dict): Configuration data for the action.
conditions (Optional[List[Dict]]): Optional conditions that must be met.
updated (Optional[datetime]): When the automation was last updated.</p>
</details>





              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutomationDetailResponse</span><span class="p">(</span><span class="n">AutomationResponse</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detailed model for automation data returned in API responses.</span>
<span class="sd">    Extends AutomationResponse to include configuration details.</span>

<span class="sd">    Additional Attributes:</span>
<span class="sd">        trigger_data (Dict): Configuration data for the trigger.</span>
<span class="sd">        action_data (Dict): Configuration data for the action.</span>
<span class="sd">        conditions (Optional[List[Dict]]): Optional conditions that must be met.</span>
<span class="sd">        updated (Optional[datetime]): When the automation was last updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trigger_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">action_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.AutomationResponse" class="doc doc-heading">
            <code>app.models.automation.AutomationResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for automation data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique automation identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of what the automation does.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device associated with this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.enabled">enabled</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the automation is enabled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.trigger_type">trigger_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.TriggerType" href="#app.models.automation.TriggerType">TriggerType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of trigger for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.action_type">action_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.ActionType" href="#app.models.automation.ActionType">ActionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of action for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the automation was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.last_triggered">last_triggered</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the automation was last triggered.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationResponse.execution_count">execution_count</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of times the automation has executed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutomationResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for automation data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique automation identifier.</span>
<span class="sd">        name (str): Name of the automation.</span>
<span class="sd">        description (str): Description of what the automation does.</span>
<span class="sd">        user_id (str): ID of the user who owns this automation.</span>
<span class="sd">        device_id (str): ID of the device associated with this automation.</span>
<span class="sd">        enabled (bool): Whether the automation is enabled.</span>
<span class="sd">        trigger_type (TriggerType): Type of trigger for this automation.</span>
<span class="sd">        action_type (ActionType): Type of action for this automation.</span>
<span class="sd">        created (datetime): When the automation was created.</span>
<span class="sd">        last_triggered (Optional[datetime]): When the automation was last triggered.</span>
<span class="sd">        execution_count (int): Number of times the automation has executed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">trigger_type</span><span class="p">:</span> <span class="n">TriggerType</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="n">ActionType</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">last_triggered</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">execution_count</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.AutomationUpdate" class="doc doc-heading">
            <code>app.models.automation.AutomationUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating automation information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.name">name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated name of the automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated description.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.enabled">enabled</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated enabled status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.trigger_type">trigger_type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.automation.TriggerType" href="#app.models.automation.TriggerType">TriggerType</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated trigger type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.trigger_data">trigger_data</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated trigger configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.action_type">action_type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.automation.ActionType" href="#app.models.automation.ActionType">ActionType</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated action type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.action_data">action_data</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated action configuration.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.AutomationUpdate.conditions">conditions</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated conditions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">AutomationUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating automation information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (Optional[str]): Updated name of the automation.</span>
<span class="sd">        description (Optional[str]): Updated description.</span>
<span class="sd">        enabled (Optional[bool]): Updated enabled status.</span>
<span class="sd">        trigger_type (Optional[TriggerType]): Updated trigger type.</span>
<span class="sd">        trigger_data (Optional[Dict]): Updated trigger configuration.</span>
<span class="sd">        action_type (Optional[ActionType]): Updated action type.</span>
<span class="sd">        action_data (Optional[Dict]): Updated action configuration.</span>
<span class="sd">        conditions (Optional[List[Dict]]): Updated conditions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">trigger_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TriggerType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">trigger_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ActionType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">action_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate automation name.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (Optional[str]): Name to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be at least 3 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be less than 50 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate automation description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (Optional[str]): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation description must be less than 500 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.automation.AutomationUpdate.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">automation</span><span class="o">.</span><span class="n">AutomationUpdate</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate automation description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/automation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate automation description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (Optional[str]): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation description must be less than 500 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.automation.AutomationUpdate.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">automation</span><span class="o">.</span><span class="n">AutomationUpdate</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate automation name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/automation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate automation name.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (Optional[str]): Name to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be less than 50 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.CreateAutomation" class="doc doc-heading">
            <code>app.models.automation.CreateAutomation</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for automation creation input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of what the automation does.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device associated with this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.enabled">enabled</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the automation is enabled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.trigger_type">trigger_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.TriggerType" href="#app.models.automation.TriggerType">TriggerType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of trigger for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.trigger_data">trigger_data</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration data for the trigger.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.action_type">action_type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.automation.ActionType" href="#app.models.automation.ActionType">ActionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of action for this automation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.action_data">action_data</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration data for the action.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.automation.CreateAutomation.conditions">conditions</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional conditions that must be met.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateAutomation</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for automation creation input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Name of the automation.</span>
<span class="sd">        description (str): Description of what the automation does.</span>
<span class="sd">        user_id (str): ID of the user who owns this automation.</span>
<span class="sd">        device_id (str): ID of the device associated with this automation.</span>
<span class="sd">        enabled (bool): Whether the automation is enabled.</span>
<span class="sd">        trigger_type (TriggerType): Type of trigger for this automation.</span>
<span class="sd">        trigger_data (Dict): Configuration data for the trigger.</span>
<span class="sd">        action_type (ActionType): Type of action for this automation.</span>
<span class="sd">        action_data (Dict): Configuration data for the action.</span>
<span class="sd">        conditions (Optional[List[Dict]]): Optional conditions that must be met.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>  
    <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">trigger_type</span><span class="p">:</span> <span class="n">TriggerType</span>
    <span class="n">trigger_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="n">ActionType</span>
    <span class="n">action_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">conditions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate automation name.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (str): Name to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be less than 50 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate automation description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (str): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation description must be less than 500 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.automation.CreateAutomation.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">automation</span><span class="o">.</span><span class="n">CreateAutomation</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate automation description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/automation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate automation description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (str): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation description must be less than 500 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.automation.CreateAutomation.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">automation</span><span class="o">.</span><span class="n">CreateAutomation</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate automation name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/automation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate automation name.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (str): Name to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be at least 3 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Automation name must be less than 50 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.automation.TriggerType" class="doc doc-heading">
            <code>app.models.automation.TriggerType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for different types of automation triggers.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/automation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TriggerType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for different types of automation triggers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">TIME</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
    <span class="n">SENSOR</span> <span class="o">=</span> <span class="s2">&quot;sensor&quot;</span>
    <span class="n">MANUAL</span> <span class="o">=</span> <span class="s2">&quot;manual&quot;</span>
    <span class="n">DEVICE_STATE</span> <span class="o">=</span> <span class="s2">&quot;device_state&quot;</span>
    <span class="n">LOCATION</span> <span class="o">=</span> <span class="s2">&quot;location&quot;</span>
    <span class="n">WEATHER</span> <span class="o">=</span> <span class="s2">&quot;weather&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.device" class="doc doc-heading">
            <code>app.models.device</code>


</h2>

    <div class="doc doc-contents first">

        <p>Model for device validation &amp; storage.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.device.CreateDevice" class="doc doc-heading">
            <code>app.models.device.CreateDevice</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for device registration input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.device.DeviceType" href="#app.models.device.DeviceType">DeviceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.room_id">room_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the room where the device is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.ip_address">ip_address</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device IP address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.mac_address">mac_address</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device MAC address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.manufacturer">manufacturer</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device manufacturer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.model">model</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.firmware_version">firmware_version</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current firmware version.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.CreateDevice.settings">settings</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device-specific settings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateDevice</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for device registration input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Device name.</span>
<span class="sd">        type (DeviceType): Type of device.</span>
<span class="sd">        user_id (str): ID of the user who owns the device.</span>
<span class="sd">        room_id (Optional[str]): ID of the room where the device is located.</span>
<span class="sd">        ip_address (Optional[str]): Device IP address.</span>
<span class="sd">        mac_address (Optional[str]): Device MAC address.</span>
<span class="sd">        manufacturer (Optional[str]): Device manufacturer.</span>
<span class="sd">        model (Optional[str]): Device model.</span>
<span class="sd">        firmware_version (Optional[str]): Current firmware version.</span>
<span class="sd">        settings (Optional[Dict]): Device-specific settings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DeviceType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mac_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">firmware_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate device name according to requirements.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Device name to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated device name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name can&#39;t be empty.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name must be less than 100 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.device.CreateDevice.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">CreateDevice</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate device name according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated device name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/device.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate device name according to requirements.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Device name to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated device name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name can&#39;t be empty.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name must be less than 100 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.device.DeviceDB" class="doc doc-heading">
            <code>app.models.device.DeviceDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing device data in the database</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique device identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.device.DeviceType" href="#app.models.device.DeviceType">DeviceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.room_id">room_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the room where the device is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.ip_address">ip_address</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device IP address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.mac_address">mac_address</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device MAC address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.manufacturer">manufacturer</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device manufacturer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.model">model</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.firmware_version">firmware_version</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current firmware version.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.settings">settings</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device-specific settings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.device.DeviceStatus" href="#app.models.device.DeviceStatus">DeviceStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current device status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.last_online">last_online</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the device was last seen online.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the device was added to the system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the device data was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceDB.capabilities">capabilities</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device capabilities/features.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing device data in the database</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique device identifier.</span>
<span class="sd">        name (str): Device name.</span>
<span class="sd">        type (DeviceType): Type of device.</span>
<span class="sd">        user_id (str): ID of the user who owns the device.</span>
<span class="sd">        room_id (Optional[str]): ID of the room where the device is located.</span>
<span class="sd">        ip_address (Optional[str]): Device IP address.</span>
<span class="sd">        mac_address (Optional[str]): Device MAC address.</span>
<span class="sd">        manufacturer (Optional[str]): Device manufacturer.</span>
<span class="sd">        model (Optional[str]): Device model.</span>
<span class="sd">        firmware_version (Optional[str]): Current firmware version.</span>
<span class="sd">        settings (Optional[Dict]): Device-specific settings.</span>
<span class="sd">        status (DeviceStatus): Current device status.</span>
<span class="sd">        last_online (Optional[datetime]): When the device was last seen online.</span>
<span class="sd">        created (datetime): When the device was added to the system.</span>
<span class="sd">        updated (Optional[datetime]): When the device data was last updated.</span>
<span class="sd">        capabilities (List[str]): List of device capabilities/features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DeviceType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">mac_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">firmware_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DeviceStatus</span> <span class="o">=</span> <span class="n">DeviceStatus</span><span class="o">.</span><span class="n">OFFLINE</span>
    <span class="n">last_online</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">capabilities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.device.DeviceResponse" class="doc doc-heading">
            <code>app.models.device.DeviceResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for device data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique device identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.device.DeviceType" href="#app.models.device.DeviceType">DeviceType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the device.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.room_id">room_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the room where the device is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.manufacturer">manufacturer</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device manufacturer.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.model">model</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.device.DeviceStatus" href="#app.models.device.DeviceStatus">DeviceStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current device status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.last_online">last_online</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the device was last seen online.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the device was added to the system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceResponse.capabilities">capabilities</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device capabilities/features.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for device data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique device identifier.</span>
<span class="sd">        name (str): Device name.</span>
<span class="sd">        type (DeviceType): Type of device.</span>
<span class="sd">        user_id (str): ID of the user who owns the device.</span>
<span class="sd">        room_id (Optional[str]): ID of the room where the device is located.</span>
<span class="sd">        manufacturer (Optional[str]): Device manufacturer.</span>
<span class="sd">        model (Optional[str]): Device model.</span>
<span class="sd">        status (DeviceStatus): Current device status.</span>
<span class="sd">        last_online (Optional[datetime]): When the device was last seen online.</span>
<span class="sd">        created (datetime): When the device was added to the system.</span>
<span class="sd">        capabilities (List[str]): List of device capabilities/features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">DeviceType</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">DeviceStatus</span>
    <span class="n">last_online</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">capabilities</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.device.DeviceStatus" class="doc doc-heading">
            <code>app.models.device.DeviceStatus</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of possible device statuses.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of possible device statuses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ONLINE</span> <span class="o">=</span> <span class="s2">&quot;online&quot;</span>
    <span class="n">OFFLINE</span> <span class="o">=</span> <span class="s2">&quot;offline&quot;</span>
    <span class="n">ERROR</span> <span class="o">=</span> <span class="s2">&quot;error&quot;</span>
    <span class="n">MAINTENANCE</span> <span class="o">=</span> <span class="s2">&quot;maintenance&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.device.DeviceType" class="doc doc-heading">
            <code>app.models.device.DeviceType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of supported device types.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of supported device types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">LIGHT</span> <span class="o">=</span> <span class="s2">&quot;light&quot;</span>
    <span class="n">THERMOSTAT</span> <span class="o">=</span> <span class="s2">&quot;thermostat&quot;</span>
    <span class="n">LOCK</span> <span class="o">=</span> <span class="s2">&quot;lock&quot;</span>
    <span class="n">CAMERA</span> <span class="o">=</span> <span class="s2">&quot;camera&quot;</span>
    <span class="n">SENSOR</span> <span class="o">=</span> <span class="s2">&quot;sensor&quot;</span>
    <span class="n">SWITCH</span> <span class="o">=</span> <span class="s2">&quot;switch&quot;</span>
    <span class="n">OUTLET</span> <span class="o">=</span> <span class="s2">&quot;outlet&quot;</span>
    <span class="n">SPEAKER</span> <span class="o">=</span> <span class="s2">&quot;speaker&quot;</span>
    <span class="n">OTHER</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.device.DeviceUpdate" class="doc doc-heading">
            <code>app.models.device.DeviceUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating device information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.name">name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated device name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.room_id">room_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated room location.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.ip_address">ip_address</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated IP address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.firmware_version">firmware_version</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated firmware version.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.settings">settings</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated device settings.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.device.DeviceUpdate.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.device.DeviceStatus" href="#app.models.device.DeviceStatus">DeviceStatus</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated device status.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/device.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DeviceUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating device information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (Optional[str]): Updated device name.</span>
<span class="sd">        room_id (Optional[str]): Updated room location.</span>
<span class="sd">        ip_address (Optional[str]): Updated IP address.</span>
<span class="sd">        firmware_version (Optional[str]): Updated firmware version.</span>
<span class="sd">        settings (Optional[Dict]): Updated device settings.</span>
<span class="sd">        status (Optional[DeviceStatus]): Updated device status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ip_address</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">firmware_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">settings</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DeviceStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate device name according to requirements.</span>

<span class="sd">        Args:</span>
<span class="sd">            n (Optional[str]): Device name to be validated.</span>

<span class="sd">        Returns: </span>
<span class="sd">            Optional[str]: Validated device name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name can&#39;t be empty.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name must be less than 100 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.device.DeviceUpdate.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">device</span><span class="o">.</span><span class="n">DeviceUpdate</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate device name according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated device name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/device.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate device name according to requirements.</span>

<span class="sd">    Args:</span>
<span class="sd">        n (Optional[str]): Device name to be validated.</span>

<span class="sd">    Returns: </span>
<span class="sd">        Optional[str]: Validated device name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name can&#39;t be empty.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device name must be less than 100 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.goal" class="doc doc-heading">
            <code>app.models.goal</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for energy goal validation and storage.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.goal.CreateEnergyGoal" class="doc doc-heading">
            <code>app.models.goal.CreateEnergyGoal</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for energy goal creation input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed description of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalType" href="#app.models.goal.GoalType">GoalType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of energy goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.target_value">target_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target value for the goal (e.g., kWh to save).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.timeframe">timeframe</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalTimeframe" href="#app.models.goal.GoalTimeframe">GoalTimeframe</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeframe for the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal starts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal ends (required for CUSTOM timeframe).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.CreateEnergyGoal.related_devices">related_devices</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs this goal applies to.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateEnergyGoal</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for energy goal creation input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): ID of the user who owns the goal.</span>
<span class="sd">        title (str): Title of the goal.</span>
<span class="sd">        description (str): Detailed description of the goal.</span>
<span class="sd">        type (GoalType): Type of energy goal.</span>
<span class="sd">        target_value (float): Target value for the goal (e.g., kWh to save).</span>
<span class="sd">        timeframe (GoalTimeframe): Timeframe for the goal.</span>
<span class="sd">        start_date (datetime): When the goal starts.</span>
<span class="sd">        end_date (Optional[datetime]): When the goal ends (required for CUSTOM timeframe).</span>
<span class="sd">        related_devices (Optional[List[str]]): List of device IDs this goal applies to.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">GoalType</span>
    <span class="n">target_value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">timeframe</span><span class="p">:</span> <span class="n">GoalTimeframe</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">related_devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the goal title.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            t (str): Title to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated title.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the goal description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            d (str): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 500 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;target_value&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_target_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the target value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (float): Target value to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Validated target value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target value must be greater than 0.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_end_date</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the end date based on timeframe and start date.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            end (Optional[datetime]): End date to be validated.</span>
<span class="sd">            values (dict): Previously validated values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[datetime]: Validated end date.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timeframe</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeframe&quot;</span><span class="p">)</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="n">GoalTimeframe</span><span class="o">.</span><span class="n">CUSTOM</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date is required for custom timeframe.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">start_date</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date must be after start date.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">end</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.goal.CreateEnergyGoal.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">CreateEnergyGoal</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the goal description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the goal description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        d (str): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 500 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.CreateEnergyGoal.validate_end_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">CreateEnergyGoal</span><span class="o">.</span><span class="n">validate_end_date</span><span class="p">(</span><span class="n">end</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the end date based on timeframe and start date.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>end</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>values</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Previously validated values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[datetime]: Validated end date.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_end_date</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">end</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">],</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the end date based on timeframe and start date.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        end (Optional[datetime]): End date to be validated.</span>
<span class="sd">        values (dict): Previously validated values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[datetime]: Validated end date.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timeframe</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timeframe&quot;</span><span class="p">)</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="n">GoalTimeframe</span><span class="o">.</span><span class="n">CUSTOM</span> <span class="ow">and</span> <span class="n">end</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date is required for custom timeframe.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end</span> <span class="o">&lt;=</span> <span class="n">start_date</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End date must be after start date.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">end</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.CreateEnergyGoal.validate_target_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">CreateEnergyGoal</span><span class="o">.</span><span class="n">validate_target_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the target value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target value to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated target value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;target_value&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_target_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the target value.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (float): Target value to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Validated target value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target value must be greater than 0.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.CreateEnergyGoal.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">CreateEnergyGoal</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the goal title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the goal title.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        t (str): Title to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated title.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.EnergyGoalDB" class="doc doc-heading">
            <code>app.models.goal.EnergyGoalDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing energy goal data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique goal identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed description of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalType" href="#app.models.goal.GoalType">GoalType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of energy goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.target_value">target_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target value for the goal (e.g., kWh to save).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.current_value">current_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current progress value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.progress_percentage">progress_percentage</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentage of goal completion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.timeframe">timeframe</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalTimeframe" href="#app.models.goal.GoalTimeframe">GoalTimeframe</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeframe for the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal starts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal ends.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalStatus" href="#app.models.goal.GoalStatus">GoalStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.related_devices">related_devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs this goal applies to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal was last updated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyGoalDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing energy goal data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique goal identifier.</span>
<span class="sd">        user_id (str): ID of the user who owns the goal.</span>
<span class="sd">        title (str): Title of the goal.</span>
<span class="sd">        description (str): Detailed description of the goal.</span>
<span class="sd">        type (GoalType): Type of energy goal.</span>
<span class="sd">        target_value (float): Target value for the goal (e.g., kWh to save).</span>
<span class="sd">        current_value (float): Current progress value.</span>
<span class="sd">        progress_percentage (float): Percentage of goal completion.</span>
<span class="sd">        timeframe (GoalTimeframe): Timeframe for the goal.</span>
<span class="sd">        start_date (datetime): When the goal starts.</span>
<span class="sd">        end_date (Optional[datetime]): When the goal ends.</span>
<span class="sd">        status (GoalStatus): Current status of the goal.</span>
<span class="sd">        related_devices (List[str]): List of device IDs this goal applies to.</span>
<span class="sd">        created (datetime): When the goal was created.</span>
<span class="sd">        updated (Optional[datetime]): When the goal was last updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">GoalType</span>
    <span class="n">target_value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">current_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">progress_percentage</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">timeframe</span><span class="p">:</span> <span class="n">GoalTimeframe</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">GoalStatus</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">ACTIVE</span>
    <span class="n">related_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.EnergyGoalProgressUpdate" class="doc doc-heading">
            <code>app.models.goal.EnergyGoalProgressUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model specifically for updating goal progress.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalProgressUpdate.current_value">current_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New current value for the goal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyGoalProgressUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model specifically for updating goal progress.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        current_value (float): New current value for the goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_value</span><span class="p">:</span> <span class="nb">float</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;current_value&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_current_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the current value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (float): Current value to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Validated current value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Current value cannot be negative.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.goal.EnergyGoalProgressUpdate.validate_current_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">EnergyGoalProgressUpdate</span><span class="o">.</span><span class="n">validate_current_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the current value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current value to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated current value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;current_value&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_current_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the current value.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (float): Current value to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Validated current value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Current value cannot be negative.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.EnergyGoalResponse" class="doc doc-heading">
            <code>app.models.goal.EnergyGoalResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for energy goal data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique goal identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed description of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalType" href="#app.models.goal.GoalType">GoalType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of energy goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.target_value">target_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target value for the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.current_value">current_value</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current progress value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.progress_percentage">progress_percentage</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Percentage of goal completion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.timeframe">timeframe</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalTimeframe" href="#app.models.goal.GoalTimeframe">GoalTimeframe</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Timeframe for the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal starts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal ends.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.goal.GoalStatus" href="#app.models.goal.GoalStatus">GoalStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.related_devices">related_devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs this goal applies to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the goal was created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyGoalResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for energy goal data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique goal identifier.</span>
<span class="sd">        user_id (str): ID of the user who owns the goal.</span>
<span class="sd">        title (str): Title of the goal.</span>
<span class="sd">        description (str): Detailed description of the goal.</span>
<span class="sd">        type (GoalType): Type of energy goal.</span>
<span class="sd">        target_value (float): Target value for the goal.</span>
<span class="sd">        current_value (float): Current progress value.</span>
<span class="sd">        progress_percentage (float): Percentage of goal completion.</span>
<span class="sd">        timeframe (GoalTimeframe): Timeframe for the goal.</span>
<span class="sd">        start_date (datetime): When the goal starts.</span>
<span class="sd">        end_date (Optional[datetime]): When the goal ends.</span>
<span class="sd">        status (GoalStatus): Current status of the goal.</span>
<span class="sd">        related_devices (List[str]): List of device IDs this goal applies to.</span>
<span class="sd">        created (datetime): When the goal was created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">target_value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">current_value</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">progress_percentage</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">timeframe</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">related_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.EnergyGoalUpdate" class="doc doc-heading">
            <code>app.models.goal.EnergyGoalUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating energy goal information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.title">title</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated title of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated description of the goal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.target_value">target_value</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated target value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.current_value">current_value</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated current value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.goal.GoalStatus" href="#app.models.goal.GoalStatus">GoalStatus</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated goal status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated end date.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.goal.EnergyGoalUpdate.related_devices">related_devices</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated list of related devices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyGoalUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating energy goal information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        title (Optional[str]): Updated title of the goal.</span>
<span class="sd">        description (Optional[str]): Updated description of the goal.</span>
<span class="sd">        target_value (Optional[float]): Updated target value.</span>
<span class="sd">        current_value (Optional[float]): Updated current value.</span>
<span class="sd">        status (Optional[GoalStatus]): Updated goal status.</span>
<span class="sd">        end_date (Optional[datetime]): Updated end date.</span>
<span class="sd">        related_devices (Optional[List[str]]): Updated list of related devices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">target_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">current_value</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GoalStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">related_devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the goal title.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            t (Optional[str]): Title to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated title.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the goal description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            d (Optional[str]): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 500 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;target_value&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_target_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the target value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (Optional[float]): Target value to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[float]: Validated target value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target value must be greater than 0.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;current_value&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_current_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the current value.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            v (Optional[float]): Current value to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[float]: Validated current value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Current value cannot be negative.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.goal.EnergyGoalUpdate.validate_current_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">EnergyGoalUpdate</span><span class="o">.</span><span class="n">validate_current_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the current value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current value to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[float]: Validated current value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;current_value&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_current_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the current value.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (Optional[float]): Current value to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[float]: Validated current value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Current value cannot be negative.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.EnergyGoalUpdate.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">EnergyGoalUpdate</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the goal description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the goal description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        d (Optional[str]): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 500 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.EnergyGoalUpdate.validate_target_value" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">EnergyGoalUpdate</span><span class="o">.</span><span class="n">validate_target_value</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the target value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target value to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[float]: Validated target value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;target_value&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_target_value</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the target value.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        v (Optional[float]): Target value to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[float]: Validated target value.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Target value must be greater than 0.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.goal.EnergyGoalUpdate.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">goal</span><span class="o">.</span><span class="n">EnergyGoalUpdate</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the goal title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/goal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the goal title.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        t (Optional[str]): Title to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated title.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.GoalStatus" class="doc doc-heading">
            <code>app.models.goal.GoalStatus</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of goal statuses.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GoalStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of goal statuses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ACTIVE</span> <span class="o">=</span> <span class="s2">&quot;active&quot;</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
    <span class="n">PAUSED</span> <span class="o">=</span> <span class="s2">&quot;paused&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.GoalTimeframe" class="doc doc-heading">
            <code>app.models.goal.GoalTimeframe</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of goal timeframes.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GoalTimeframe</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of goal timeframes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DAILY</span> <span class="o">=</span> <span class="s2">&quot;daily&quot;</span>
    <span class="n">WEEKLY</span> <span class="o">=</span> <span class="s2">&quot;weekly&quot;</span>
    <span class="n">MONTHLY</span> <span class="o">=</span> <span class="s2">&quot;monthly&quot;</span>
    <span class="n">YEARLY</span> <span class="o">=</span> <span class="s2">&quot;yearly&quot;</span>
    <span class="n">CUSTOM</span> <span class="o">=</span> <span class="s2">&quot;custom&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.goal.GoalType" class="doc doc-heading">
            <code>app.models.goal.GoalType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of supported goal types.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/goal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GoalType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of supported goal types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ENERGY_SAVING</span> <span class="o">=</span> <span class="s2">&quot;energy_saving&quot;</span>
    <span class="n">CONSUMPTION_LIMIT</span> <span class="o">=</span> <span class="s2">&quot;consumption_limit&quot;</span>
    <span class="n">USAGE_REDUCTION</span> <span class="o">=</span> <span class="s2">&quot;usage_reduction&quot;</span>
    <span class="n">PEAK_AVOIDANCE</span> <span class="o">=</span> <span class="s2">&quot;peak_avoidance&quot;</span>
    <span class="n">RENEWABLE_USAGE</span> <span class="o">=</span> <span class="s2">&quot;renewable_usage&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.notification" class="doc doc-heading">
            <code>app.models.notification</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for notification validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.notification.CreateNotification" class="doc doc-heading">
            <code>app.models.notification.CreateNotification</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for notification creation input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user to whom the notification belongs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.message">message</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Content of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of notification (e.g., alert, info, warning).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.priority">priority</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.source">source</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of the notification (e.g., device, system).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.CreateNotification.source_id">source_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the source entity (if applicable).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/notification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateNotification</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for notification creation input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): ID of the user to whom the notification belongs.</span>
<span class="sd">        title (str): Title of the notification.</span>
<span class="sd">        message (str): Content of the notification.</span>
<span class="sd">        type (str): Type of notification (e.g., alert, info, warning).</span>
<span class="sd">        priority (str): Priority level of the notification.</span>
<span class="sd">        source (str): Source of the notification (e.g., device, system).</span>
<span class="sd">        source_id (Optional[str]): ID of the source entity (if applicable).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;alert&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;info&quot;</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;goal&quot;</span><span class="p">,</span> <span class="s2">&quot;security&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;system&quot;</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the notification title.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            title (str): Title to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated title.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the notification message.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            message (str): Message to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated message.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message must be at least 5 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message must be less than 1000 characters long.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">message</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate user_id format.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            user_id (str): User ID to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated user ID.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User ID must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">v</span>
        <span class="k">return</span> <span class="n">user_id</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.notification.CreateNotification.validate_message" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">notification</span><span class="o">.</span><span class="n">CreateNotification</span><span class="o">.</span><span class="n">validate_message</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the notification message.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Message to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated message.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/notification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_message</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the notification message.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        message (str): Message to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated message.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message must be at least 5 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Message must be less than 1000 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.notification.CreateNotification.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">notification</span><span class="o">.</span><span class="n">CreateNotification</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate the notification title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/notification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the notification title.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        title (str): Title to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated title.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.notification.CreateNotification.validate_user_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">notification</span><span class="o">.</span><span class="n">CreateNotification</span><span class="o">.</span><span class="n">validate_user_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate user_id format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated user ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/notification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate user_id format.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        user_id (str): User ID to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated user ID.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User ID must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">v</span>
    <span class="k">return</span> <span class="n">user_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.notification.NotificationBulkUpdate" class="doc doc-heading">
            <code>app.models.notification.NotificationBulkUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for bulk updating notifications.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationBulkUpdate.notification_ids">notification_ids</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of notification IDs to update.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationBulkUpdate.read">read</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New read status for all specified notifications.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/notification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NotificationBulkUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for bulk updating notifications.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        notification_ids (list[str]): List of notification IDs to update.</span>
<span class="sd">        read (bool): New read status for all specified notifications.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">notification_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">read</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;notification_ids&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_notification_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">notification_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate notification IDs format and ensure the list is not empty.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            notification_ids (list[str]): List of notification IDs to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: Validated list of notification IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">notification_ids</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one notification ID must be provided.&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">notification_id</span> <span class="ow">in</span> <span class="n">notification_ids</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">notification_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notification ID </span><span class="si">{</span><span class="n">notification_id</span><span class="si">}</span><span class="s2"> must be a valid UUID.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">notification_ids</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.notification.NotificationBulkUpdate.validate_notification_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">notification</span><span class="o">.</span><span class="n">NotificationBulkUpdate</span><span class="o">.</span><span class="n">validate_notification_ids</span><span class="p">(</span><span class="n">notification_ids</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate notification IDs format and ensure the list is not empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>notification_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of notification IDs to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[str]: Validated list of notification IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/notification.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;notification_ids&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_notification_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">notification_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate notification IDs format and ensure the list is not empty.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        notification_ids (list[str]): List of notification IDs to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[str]: Validated list of notification IDs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">notification_ids</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;At least one notification ID must be provided.&quot;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">notification_id</span> <span class="ow">in</span> <span class="n">notification_ids</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">notification_id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Notification ID </span><span class="si">{</span><span class="n">notification_id</span><span class="si">}</span><span class="s2"> must be a valid UUID.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">notification_ids</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.notification.NotificationDB" class="doc doc-heading">
            <code>app.models.notification.NotificationDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing notification data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique notification identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user to whom the notification belongs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.message">message</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Content of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.priority">priority</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.source">source</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.source_id">source_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the source entity (if applicable).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.read">read</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the notification has been read.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the notification was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationDB.read_timestamp">read_timestamp</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the notification was read.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/notification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NotificationDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing notification data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique notification identifier.</span>
<span class="sd">        user_id (str): ID of the user to whom the notification belongs.</span>
<span class="sd">        title (str): Title of the notification.</span>
<span class="sd">        message (str): Content of the notification.</span>
<span class="sd">        type (str): Type of notification.</span>
<span class="sd">        priority (str): Priority level of the notification.</span>
<span class="sd">        source (str): Source of the notification.</span>
<span class="sd">        source_id (Optional[str]): ID of the source entity (if applicable).</span>
<span class="sd">        read (bool): Whether the notification has been read.</span>
<span class="sd">        timestamp (datetime): When the notification was created.</span>
<span class="sd">        read_timestamp (Optional[datetime]): When the notification was read.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">read</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">read_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.notification.NotificationResponse" class="doc doc-heading">
            <code>app.models.notification.NotificationResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for notification data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique notification identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user to whom the notification belongs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.message">message</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Content of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.priority">priority</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.source">source</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Source of the notification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.source_id">source_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the source entity (if applicable).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.read">read</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the notification has been read.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the notification was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationResponse.read_timestamp">read_timestamp</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the notification was read.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/notification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NotificationResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for notification data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique notification identifier.</span>
<span class="sd">        user_id (str): ID of the user to whom the notification belongs.</span>
<span class="sd">        title (str): Title of the notification.</span>
<span class="sd">        message (str): Content of the notification.</span>
<span class="sd">        type (str): Type of notification.</span>
<span class="sd">        priority (str): Priority level of the notification.</span>
<span class="sd">        source (str): Source of the notification.</span>
<span class="sd">        source_id (Optional[str]): ID of the source entity (if applicable).</span>
<span class="sd">        read (bool): Whether the notification has been read.</span>
<span class="sd">        timestamp (datetime): When the notification was created.</span>
<span class="sd">        read_timestamp (Optional[datetime]): When the notification was read.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">source_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">read</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">read_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.notification.NotificationUpdate" class="doc doc-heading">
            <code>app.models.notification.NotificationUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating notification information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationUpdate.read">read</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated read status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.notification.NotificationUpdate.read_timestamp">read_timestamp</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated read timestamp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/notification.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NotificationUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating notification information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        read (Optional[bool]): Updated read status.</span>
<span class="sd">        read_timestamp (Optional[datetime]): Updated read timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">read_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.profile" class="doc doc-heading">
            <code>app.models.profile</code>


</h2>

    <div class="doc doc-contents first">

        <p>Model for user profile validation &amp; handling.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.profile.CreateProfile" class="doc doc-heading">
            <code>app.models.profile.CreateProfile</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for creating a new user profile.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User identification.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.first_name">first_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's first name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.last_name">last_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's last name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.display_name">display_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's display name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.avatar">avatar</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to user's avatar image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.phone_number">phone_number</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's phone number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.timezone">timezone</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone, defaults to UTC.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.temperature_unit">temperature_unit</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred temperature unit (C/F).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.CreateProfile.dark_mode">dark_mode</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UI theme preference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/profile.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateProfile</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for creating a new user profile.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): User identification.</span>
<span class="sd">        first_name (str): User&#39;s first name.</span>
<span class="sd">        last_name (str): User&#39;s last name.</span>
<span class="sd">        display_name (Optional[str]): User&#39;s display name.</span>
<span class="sd">        avatar (Optional[str]): URL to user&#39;s avatar image.</span>
<span class="sd">        phone_number (Optional[str]): User&#39;s phone number.</span>
<span class="sd">        timezone (str): User&#39;s timezone, defaults to UTC.</span>
<span class="sd">        temperature_unit (str): Preferred temperature unit (C/F).</span>
<span class="sd">        dark_mode (bool): UI theme preference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">display_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">avatar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">phone_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>
    <span class="n">temperature_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;temperature_unit&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_temp_unit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate temperature unit is either C(elsius) or F(ahrenheit).</span>

<span class="sd">        Args:</span>
<span class="sd">            u (str): Temperature unit.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Value must either be C or F.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Temperature unit must be either `C` or `F`.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;timezone&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_timezone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Basic timezone validation.</span>

<span class="sd">        Args:</span>
<span class="sd">            t (str): User&#39;s timezone.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: User&#39;s timezone isn&#39;t valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timezone can&#39;t be empty.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.profile.CreateProfile.validate_temp_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">CreateProfile</span><span class="o">.</span><span class="n">validate_temp_unit</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate temperature unit is either C(elsius) or F(ahrenheit).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature unit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value must either be C or F.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/profile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;temperature_unit&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_temp_unit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate temperature unit is either C(elsius) or F(ahrenheit).</span>

<span class="sd">    Args:</span>
<span class="sd">        u (str): Temperature unit.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Value must either be C or F.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Temperature unit must be either `C` or `F`.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.profile.CreateProfile.validate_timezone" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">CreateProfile</span><span class="o">.</span><span class="n">validate_timezone</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Basic timezone validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone isn't valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/profile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;timezone&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_timezone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic timezone validation.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (str): User&#39;s timezone.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: User&#39;s timezone isn&#39;t valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timezone can&#39;t be empty.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.profile.ProfileDB" class="doc doc-heading">
            <code>app.models.profile.ProfileDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing profile data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique profile identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique associated user ID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.first_name">first_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's first name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.last_name">last_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's last name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.display_name">display_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's display name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.avatar">avatar</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to user's avatar image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.phone_number">phone_number</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's phone number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.timezone">timezone</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone, defaults to UTC.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.temperature_unit">temperature_unit</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred temperature unit (C/F).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.dark_mode">dark_mode</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UI theme preference.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.favorite_devices">favorite_devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of favorite devices.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Profile creation timestamp.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Last update timestamp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/profile.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProfileDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing profile data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique profile identifier.</span>
<span class="sd">        user_id (str): Unique associated user ID.</span>
<span class="sd">        first_name (str): User&#39;s first name.</span>
<span class="sd">        last_name (str): User&#39;s last name.</span>
<span class="sd">        display_name (Optional[str]): User&#39;s display name.</span>
<span class="sd">        avatar (Optional[str]): URL to user&#39;s avatar image.</span>
<span class="sd">        phone_number (Optional[str]): User&#39;s phone number.</span>
<span class="sd">        timezone (str): User&#39;s timezone, defaults to UTC.</span>
<span class="sd">        temperature_unit (str): Preferred temperature unit (C/F).</span>
<span class="sd">        dark_mode (bool): UI theme preference.</span>
<span class="sd">        favorite_devices (List[str]): IDs of favorite devices.</span>
<span class="sd">        created (datetime): Profile creation timestamp.</span>
<span class="sd">        updated (Optional[datetime]): Last update timestamp.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">display_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">avatar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">phone_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UTC&quot;</span>
    <span class="n">temperature_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">favorite_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.profile.ProfileResponse" class="doc doc-heading">
            <code>app.models.profile.ProfileResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for profile data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique profile identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated user ID.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.first_name">first_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's first name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.last_name">last_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's last name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.display_name">display_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's display name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.avatar">avatar</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to user's avatar image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.timezone">timezone</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.temperature_unit">temperature_unit</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred temperature unit.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.dark_mode">dark_mode</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UI theme preference.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileResponse.favorite_devices">favorite_devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of favorite devices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/profile.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProfileResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for profile data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique profile identifier.</span>
<span class="sd">        user_id (str): Associated user ID.</span>
<span class="sd">        first_name (str): User&#39;s first name.</span>
<span class="sd">        last_name (str): User&#39;s last name.</span>
<span class="sd">        display_name (Optional[str]): User&#39;s display name.</span>
<span class="sd">        avatar (Optional[str]): URL to user&#39;s avatar image.</span>
<span class="sd">        timezone (str): User&#39;s timezone.</span>
<span class="sd">        temperature_unit (str): Preferred temperature unit.</span>
<span class="sd">        dark_mode (bool): UI theme preference.</span>
<span class="sd">        favorite_devices (List[str]): IDs of favorite devices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">display_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">avatar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">temperature_unit</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">favorite_devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.profile.ProfileUpdate" class="doc doc-heading">
            <code>app.models.profile.ProfileUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating profile information.</p>
<p>All fields are optional since updates may only change some fields.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.first_name">first_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's first name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.last_name">last_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's last name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.display_name">display_name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's display name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.avatar">avatar</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to user's avatar image.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.phone_number">phone_number</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's phone number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.timezone">timezone</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.temperature_unit">temperature_unit</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Preferred temperature unit.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.dark_mode">dark_mode</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UI theme preference.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.profile.ProfileUpdate.favorite_devices">favorite_devices</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of favorite devices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/profile.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ProfileUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating profile information.</span>

<span class="sd">    All fields are optional since updates may only change some fields.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        first_name (Optional[str]): User&#39;s first name.</span>
<span class="sd">        last_name (Optional[str]): User&#39;s last name.</span>
<span class="sd">        display_name (Optional[str]): User&#39;s display name.</span>
<span class="sd">        avatar (Optional[str]): URL to user&#39;s avatar image.</span>
<span class="sd">        phone_number (Optional[str]): User&#39;s phone number.</span>
<span class="sd">        timezone (Optional[str]): User&#39;s timezone.</span>
<span class="sd">        temperature_unit (Optional[str]): Preferred temperature unit.</span>
<span class="sd">        dark_mode (Optional[bool]): UI theme preference.</span>
<span class="sd">        favorite_devices (Optional[List[str]]): IDs of favorite devices.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">display_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">avatar</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">phone_number</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">temperature_unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">favorite_devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;temperature_unit&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_temp_unit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate temperature unit is getting C or F if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            u (Optional[str]): Temperature unit.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If temperature unit isn&#39;t valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Temperature unit must either be `C` or `F`.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;timezone&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_timezone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Basic timezone validation if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            t (Optional[str]): User&#39;s timezone.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If timezone isn&#39;t valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timezone can&#39;t be an empty string&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.profile.ProfileUpdate.validate_temp_unit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ProfileUpdate</span><span class="o">.</span><span class="n">validate_temp_unit</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate temperature unit is getting C or F if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Temperature unit.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If temperature unit isn't valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/profile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;temperature_unit&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_temp_unit</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate temperature unit is getting C or F if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        u (Optional[str]): Temperature unit.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If temperature unit isn&#39;t valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">u</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">u</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Temperature unit must either be `C` or `F`.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.profile.ProfileUpdate.validate_timezone" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">ProfileUpdate</span><span class="o">.</span><span class="n">validate_timezone</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Basic timezone validation if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's timezone.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If timezone isn't valid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/profile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;timezone&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_timezone</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Basic timezone validation if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        t (Optional[str]): User&#39;s timezone.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If timezone isn&#39;t valid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Timezone can&#39;t be an empty string&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.report" class="doc doc-heading">
            <code>app.models.report</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for report generation and storage.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.report.CreateReportRequest" class="doc doc-heading">
            <code>app.models.report.CreateReportRequest</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for report generation request.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user requesting the report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.title">title</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional title for the report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.format">format</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportFormat" href="#app.models.report.ReportFormat">ReportFormat</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Desired report format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.start_date">start_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional start date in YYYY-MM-DD format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional end date in YYYY-MM-DD format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.device_ids">device_ids</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional list of device IDs to include.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.CreateReportRequest.report_type">report_type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of report (e.g., "energy", "usage", "anomaly").</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/report.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateReportRequest</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for report generation request.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): ID of the user requesting the report.</span>
<span class="sd">        title (Optional[str]): Optional title for the report.</span>
<span class="sd">        format (ReportFormat): Desired report format.</span>
<span class="sd">        start_date (Optional[str]): Optional start date in YYYY-MM-DD format.</span>
<span class="sd">        end_date (Optional[str]): Optional end date in YYYY-MM-DD format.</span>
<span class="sd">        device_ids (Optional[List[str]]): Optional list of device IDs to include.</span>
<span class="sd">        report_type (Optional[str]): Type of report (e.g., &quot;energy&quot;, &quot;usage&quot;, &quot;anomaly&quot;).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">ReportFormat</span> <span class="o">=</span> <span class="n">ReportFormat</span><span class="o">.</span><span class="n">PDF</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">report_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate report title.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">title</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_date_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate date format.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Date must be in YYYY-MM-DD format&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">date</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.report.CreateReportRequest.validate_date_format" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">CreateReportRequest</span><span class="o">.</span><span class="n">validate_date_format</span><span class="p">(</span><span class="n">date</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate date format.</p>

            <details class="quote">
              <summary>Source code in <code>app/models/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">,</span> <span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_date_format</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate date format.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Date must be in YYYY-MM-DD format&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">date</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.report.CreateReportRequest.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">CreateReportRequest</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate report title.</p>

            <details class="quote">
              <summary>Source code in <code>app/models/report.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate report title.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">title</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.report.ReportDB" class="doc doc-heading">
            <code>app.models.report.ReportDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing report data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique report identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who requested the report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report title.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.format">format</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportFormat" href="#app.models.report.ReportFormat">ReportFormat</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.file_path">file_path</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated report file.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportStatus" href="#app.models.report.ReportStatus">ReportStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of report generation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.start_date">start_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for report data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.end_date">end_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for report data.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.device_ids">device_ids</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device IDs included in the report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the report was requested.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.completed">completed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the report generation finished.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.error_message">error_message</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Error message if generation failed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportDB.metadata">metadata</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional report metadata.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/report.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing report data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique report identifier.</span>
<span class="sd">        user_id (str): ID of the user who requested the report.</span>
<span class="sd">        title (str): Report title.</span>
<span class="sd">        format (ReportFormat): Report format.</span>
<span class="sd">        file_path (Optional[str]): Path to the generated report file.</span>
<span class="sd">        status (ReportStatus): Current status of report generation.</span>
<span class="sd">        start_date (Optional[str]): Start date for report data.</span>
<span class="sd">        end_date (Optional[str]): End date for report data.</span>
<span class="sd">        device_ids (List[str]): Device IDs included in the report.</span>
<span class="sd">        created (datetime): When the report was requested.</span>
<span class="sd">        completed (Optional[datetime]): When the report generation finished.</span>
<span class="sd">        error_message (Optional[str]): Error message if generation failed.</span>
<span class="sd">        metadata (Dict[str, Any]): Additional report metadata.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">format</span><span class="p">:</span> <span class="n">ReportFormat</span>
    <span class="n">file_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">ReportStatus</span> <span class="o">=</span> <span class="n">ReportStatus</span><span class="o">.</span><span class="n">PENDING</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">device_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">report_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">completed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.report.ReportFormat" class="doc doc-heading">
            <code>app.models.report.ReportFormat</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of supported report formats.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/report.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportFormat</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of supported report formats.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PDF</span> <span class="o">=</span> <span class="s2">&quot;pdf&quot;</span>
    <span class="n">CSV</span> <span class="o">=</span> <span class="s2">&quot;csv&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.report.ReportResponse" class="doc doc-heading">
            <code>app.models.report.ReportResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for report data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique report identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who requested the report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report title.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.format">format</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportFormat" href="#app.models.report.ReportFormat">ReportFormat</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report format.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportStatus" href="#app.models.report.ReportStatus">ReportStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of report generation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the report was requested.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.completed">completed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the report generation finished.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.report.ReportResponse.download_url">download_url</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>URL to download the report file.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/report.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for report data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique report identifier.</span>
<span class="sd">        user_id (str): ID of the user who requested the report.</span>
<span class="sd">        title (str): Report title.</span>
<span class="sd">        format (ReportFormat): Report format.</span>
<span class="sd">        status (ReportStatus): Current status of report generation.</span>
<span class="sd">        created (datetime): When the report was requested.</span>
<span class="sd">        completed (Optional[datetime]): When the report generation finished.</span>
<span class="sd">        download_url (Optional[str]): URL to download the report file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">report_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">device_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">completed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">download_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.report.ReportStatus" class="doc doc-heading">
            <code>app.models.report.ReportStatus</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enumeration of report generation statuses.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/report.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enumeration of report generation statuses.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="s2">&quot;pending&quot;</span>
    <span class="n">GENERATING</span> <span class="o">=</span> <span class="s2">&quot;generating&quot;</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
    <span class="n">FAILED</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.room" class="doc doc-heading">
            <code>app.models.room</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for room validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.room.CreateRoom" class="doc doc-heading">
            <code>app.models.room.CreateRoom</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for room creation input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Room's name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.home_id">home_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the home this room belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional description of the room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of room (e.g., bedroom, kitchen, living room).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.floor">floor</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Floor number where the room is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.CreateRoom.devices">devices</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs in this room.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/room.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateRoom</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for room creation input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Room&#39;s name.</span>
<span class="sd">        home_id (str): ID of the home this room belongs to.</span>
<span class="sd">        description (Optional[str]): Optional description of the room.</span>
<span class="sd">        type (str): Type of room (e.g., bedroom, kitchen, living room).</span>
<span class="sd">        floor (int): Floor number where the room is located.</span>
<span class="sd">        devices (Optional[List[str]]): List of device IDs in this room.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">home_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Default to first floor</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate room name according to requirements.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            n (str): Room name to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated room name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be at least 2 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be less than 50 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;floor&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_floor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate floor number.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            f (int): Floor number to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Validated floor number.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>  <span class="c1"># Allow for basement floors</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be less than -5.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>  <span class="c1"># Allow for very tall buildings</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be greater than 200.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.room.CreateRoom.validate_floor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">room</span><span class="o">.</span><span class="n">CreateRoom</span><span class="o">.</span><span class="n">validate_floor</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate floor number.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Floor number to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated floor number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/room.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;floor&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_floor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate floor number.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        f (int): Floor number to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Validated floor number.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>  <span class="c1"># Allow for basement floors</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be less than -5.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>  <span class="c1"># Allow for very tall buildings</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be greater than 200.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.room.CreateRoom.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">room</span><span class="o">.</span><span class="n">CreateRoom</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate room name according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Room name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated room name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/room.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate room name according to requirements.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n (str): Room name to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated room name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be at least 2 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be less than 50 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.room.RoomDB" class="doc doc-heading">
            <code>app.models.room.RoomDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing room data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique room identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who owns this room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.home_id">home_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the home this room belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Room name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional description of the room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.floor">floor</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Floor number where the room is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.devices">devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs in this room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the room was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the room was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomDB.active">active</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the room is currently active.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/room.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RoomDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing room data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique room identifier.</span>
<span class="sd">        user_id (str): ID of the user who owns this room.</span>
<span class="sd">        home_id (str): ID of the home this room belongs to.</span>
<span class="sd">        name (str): Room name.</span>
<span class="sd">        description (Optional[str]): Optional description of the room.</span>
<span class="sd">        type (str): Type of room.</span>
<span class="sd">        floor (int): Floor number where the room is located.</span>
<span class="sd">        devices (List[str]): List of device IDs in this room.</span>
<span class="sd">        created (datetime): When the room was created.</span>
<span class="sd">        updated (Optional[datetime]): When the room was last updated.</span>
<span class="sd">        active (bool): Whether the room is currently active.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">home_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.room.RoomResponse" class="doc doc-heading">
            <code>app.models.room.RoomResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for room data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique room identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Room name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.home_id">home_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the home this room belongs to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.type">type</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.floor">floor</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Floor number where the room is located.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.devices">devices</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs in this room.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the room was created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/room.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RoomResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for room data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique room identifier.</span>
<span class="sd">        name (str): Room name.</span>
<span class="sd">        home_id (str): ID of the home this room belongs to.</span>
<span class="sd">        type (str): Type of room.</span>
<span class="sd">        floor (int): Floor number where the room is located.</span>
<span class="sd">        devices (List[str]): List of device IDs in this room.</span>
<span class="sd">        created (datetime): When the room was created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">home_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">floor</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.room.RoomUpdate" class="doc doc-heading">
            <code>app.models.room.RoomUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating room information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomUpdate.name">name</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated room name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomUpdate.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated room description.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomUpdate.type">type</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated room type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomUpdate.floor">floor</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated floor number.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.room.RoomUpdate.devices">devices</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated list of device IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/room.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RoomUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating room information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (Optional[str]): Updated room name.</span>
<span class="sd">        description (Optional[str]): Updated room description.</span>
<span class="sd">        type (Optional[str]): Updated room type.</span>
<span class="sd">        floor (Optional[int]): Updated floor number.</span>
<span class="sd">        devices (Optional[List[str]]): Updated list of device IDs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">floor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate room name according to requirements.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            n (Optional[str]): Room name to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated room name.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be at least 2 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be less than 50 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;floor&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_floor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate floor number.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            f (Optional[int]): Floor number to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[int]: Validated floor number.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be less than -5.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be greater than 200.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.room.RoomUpdate.validate_floor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">room</span><span class="o">.</span><span class="n">RoomUpdate</span><span class="o">.</span><span class="n">validate_floor</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate floor number.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Floor number to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[int]: Validated floor number.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/room.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;floor&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_floor</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate floor number.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        f (Optional[int]): Floor number to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[int]: Validated floor number.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be less than -5.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">f</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Floor number cannot be greater than 200.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.room.RoomUpdate.validate_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">room</span><span class="o">.</span><span class="n">RoomUpdate</span><span class="o">.</span><span class="n">validate_name</span><span class="p">(</span><span class="n">n</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate room name according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Room name to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated room name.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/room.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate room name according to requirements.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        n (Optional[str]): Room name to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated room name.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be at least 2 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Room name must be less than 50 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.suggestion" class="doc doc-heading">
            <code>app.models.suggestion</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for suggestion validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.CreateSuggestion" class="doc doc-heading">
            <code>app.models.suggestion.CreateSuggestion</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for suggestion creation input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who receives the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed description of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionType" href="#app.models.suggestion.SuggestionType">SuggestionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.priority">priority</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level (1-5, with 5 being highest).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.CreateSuggestion.related_device_ids">related_device_ids</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of related devices, if any.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateSuggestion</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for suggestion creation input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        user_id (str): ID of the user who receives the suggestion.</span>
<span class="sd">        title (str): Title of the suggestion.</span>
<span class="sd">        description (str): Detailed description of the suggestion.</span>
<span class="sd">        type (SuggestionType): Type of the suggestion.</span>
<span class="sd">        priority (int): Priority level (1-5, with 5 being highest).</span>
<span class="sd">        related_device_ids (Optional[List[str]]): IDs of related devices, if any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">SuggestionType</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># Default to medium priority</span>
    <span class="n">related_device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate suggestion title.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            t (str): Title to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated title.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate suggestion description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            d (str): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 1000 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate priority level.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            p (int): Priority to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Validated priority.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Priority must be between 1 and 5.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">p</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate user ID format.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            uid (str): User ID to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated user ID.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered an invalid format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid user_id format. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">return</span> <span class="n">uid</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;related_device_ids&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_device_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate device IDs format.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            devices (Optional[List[str]]): Device IDs to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[List[str]]: Validated device IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered an invalid format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid device ID format: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.CreateSuggestion.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">CreateSuggestion</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate suggestion description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate suggestion description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        d (str): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 1000 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.CreateSuggestion.validate_device_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">CreateSuggestion</span><span class="o">.</span><span class="n">validate_device_ids</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate device IDs format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>devices</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device IDs to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[List[str]]: Validated device IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered an invalid format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;related_device_ids&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_device_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate device IDs format.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        devices (Optional[List[str]]): Device IDs to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[List[str]]: Validated device IDs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered an invalid format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid device ID format: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.CreateSuggestion.validate_priority" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">CreateSuggestion</span><span class="o">.</span><span class="n">validate_priority</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate priority level.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated priority.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate priority level.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        p (int): Priority to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: Validated priority.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Priority must be between 1 and 5.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.CreateSuggestion.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">CreateSuggestion</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate suggestion title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate suggestion title.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        t (str): Title to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated title.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.CreateSuggestion.validate_user_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">CreateSuggestion</span><span class="o">.</span><span class="n">validate_user_id</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate user ID format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>uid</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User ID to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated user ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered an invalid format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_user_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate user ID format.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        uid (str): User ID to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated user ID.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered an invalid format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid user_id format. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">return</span> <span class="n">uid</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.SuggestionDB" class="doc doc-heading">
            <code>app.models.suggestion.SuggestionDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing suggestion data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique suggestion identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who receives the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Detailed description of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionType" href="#app.models.suggestion.SuggestionType">SuggestionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.priority">priority</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level (1-5, with 5 being highest).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionStatus" href="#app.models.suggestion.SuggestionStatus">SuggestionStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.related_device_ids">related_device_ids</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>IDs of related devices, if any.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the suggestion was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the suggestion was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.implemented_date">implemented_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the suggestion was implemented.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionDB.user_feedback">user_feedback</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feedback from the user on the suggestion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuggestionDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing suggestion data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique suggestion identifier.</span>
<span class="sd">        user_id (str): ID of the user who receives the suggestion.</span>
<span class="sd">        title (str): Title of the suggestion.</span>
<span class="sd">        description (str): Detailed description of the suggestion.</span>
<span class="sd">        type (SuggestionType): Type of the suggestion.</span>
<span class="sd">        priority (int): Priority level (1-5, with 5 being highest).</span>
<span class="sd">        status (SuggestionStatus): Current status of the suggestion.</span>
<span class="sd">        related_device_ids (Optional[List[str]]): IDs of related devices, if any.</span>
<span class="sd">        created (datetime): When the suggestion was created.</span>
<span class="sd">        updated (Optional[datetime]): When the suggestion was last updated.</span>
<span class="sd">        implemented_date (Optional[datetime]): When the suggestion was implemented.</span>
<span class="sd">        user_feedback (Optional[str]): Feedback from the user on the suggestion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">SuggestionType</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">SuggestionStatus</span> <span class="o">=</span> <span class="n">SuggestionStatus</span><span class="o">.</span><span class="n">PENDING</span>
    <span class="n">related_device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implemented_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">user_feedback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.SuggestionResponse" class="doc doc-heading">
            <code>app.models.suggestion.SuggestionResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for suggestion data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique suggestion identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user who receives the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.title">title</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.description">description</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.type">type</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionType" href="#app.models.suggestion.SuggestionType">SuggestionType</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.priority">priority</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority level.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.status">status</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionStatus" href="#app.models.suggestion.SuggestionStatus">SuggestionStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current status of the suggestion.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the suggestion was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionResponse.implemented_date">implemented_date</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the suggestion was implemented, if applicable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuggestionResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for suggestion data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique suggestion identifier.</span>
<span class="sd">        user_id (str): ID of the user who receives the suggestion.</span>
<span class="sd">        title (str): Title of the suggestion.</span>
<span class="sd">        description (str): Description of the suggestion.</span>
<span class="sd">        type (SuggestionType): Type of the suggestion.</span>
<span class="sd">        priority (int): Priority level.</span>
<span class="sd">        status (SuggestionStatus): Current status of the suggestion.</span>
<span class="sd">        created (datetime): When the suggestion was created.</span>
<span class="sd">        implemented_date (Optional[datetime]): When the suggestion was implemented, if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">SuggestionType</span>
    <span class="n">priority</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">SuggestionStatus</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">related_device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">implemented_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.SuggestionStatus" class="doc doc-heading">
            <code>app.models.suggestion.SuggestionStatus</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for suggestion status.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuggestionStatus</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for suggestion status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="s2">&quot;pending&quot;</span>
    <span class="n">ACCEPTED</span> <span class="o">=</span> <span class="s2">&quot;accepted&quot;</span>
    <span class="n">REJECTED</span> <span class="o">=</span> <span class="s2">&quot;rejected&quot;</span>
    <span class="n">IMPLEMENTED</span> <span class="o">=</span> <span class="s2">&quot;implemented&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.SuggestionType" class="doc doc-heading">
            <code>app.models.suggestion.SuggestionType</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="str">str</span></code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Enum for suggestion types.</p>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuggestionType</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enum for suggestion types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ENERGY_SAVING</span> <span class="o">=</span> <span class="s2">&quot;energy_saving&quot;</span>
    <span class="n">SECURITY</span> <span class="o">=</span> <span class="s2">&quot;security&quot;</span>
    <span class="n">COMFORT</span> <span class="o">=</span> <span class="s2">&quot;comfort&quot;</span>
    <span class="n">AUTOMATION</span> <span class="o">=</span> <span class="s2">&quot;automation&quot;</span>
    <span class="n">OTHER</span> <span class="o">=</span> <span class="s2">&quot;other&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.suggestion.SuggestionUpdate" class="doc doc-heading">
            <code>app.models.suggestion.SuggestionUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating suggestion information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.title">title</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated title.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.description">description</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated description.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.priority">priority</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated priority.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="app.models.suggestion.SuggestionStatus" href="#app.models.suggestion.SuggestionStatus">SuggestionStatus</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated status.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.related_device_ids">related_device_ids</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated related device IDs.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.suggestion.SuggestionUpdate.user_feedback">user_feedback</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User feedback on the suggestion.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/suggestion.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SuggestionUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating suggestion information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        title (Optional[str]): Updated title.</span>
<span class="sd">        description (Optional[str]): Updated description.</span>
<span class="sd">        priority (Optional[int]): Updated priority.</span>
<span class="sd">        status (Optional[SuggestionStatus]): Updated status.</span>
<span class="sd">        related_device_ids (Optional[List[str]]): Updated related device IDs.</span>
<span class="sd">        user_feedback (Optional[str]): User feedback on the suggestion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">title</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">description</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SuggestionStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">related_device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">user_feedback</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate suggestion title.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            t (Optional[str]): Title to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated title.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">t</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate suggestion description.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            d (Optional[str]): Description to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated description.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 1000 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate priority level.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            p (Optional[int]): Priority to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[int]: Validated priority.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Priority must be between 1 and 5.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_feedback&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_feedback</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate user feedback.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            f (Optional[str]): Feedback to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: Validated feedback.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feedback must be less than 500 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">f</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;related_device_ids&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_device_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate device IDs format.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            devices (Optional[List[str]]): Device IDs to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[List[str]]: Validated device IDs.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered an invalid format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid device ID format: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.SuggestionUpdate.validate_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">SuggestionUpdate</span><span class="o">.</span><span class="n">validate_description</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate suggestion description.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Description to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated description.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_description</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate suggestion description.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        d (Optional[str]): Description to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated description.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be at least 10 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Description must be less than 1000 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.SuggestionUpdate.validate_device_ids" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">SuggestionUpdate</span><span class="o">.</span><span class="n">validate_device_ids</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate device IDs format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>devices</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device IDs to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[List[str]]: Validated device IDs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered an invalid format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;related_device_ids&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_device_ids</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">devices</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate device IDs format.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        devices (Optional[List[str]]): Device IDs to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[List[str]]: Validated device IDs.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered an invalid format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">devices</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">uuid</span><span class="o">.</span><span class="n">UUID</span><span class="p">(</span><span class="n">device_id</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid device ID format: </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2">. Must be a valid UUID.&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.SuggestionUpdate.validate_feedback" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">SuggestionUpdate</span><span class="o">.</span><span class="n">validate_feedback</span><span class="p">(</span><span class="n">f</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate user feedback.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Feedback to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated feedback.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;user_feedback&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_feedback</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate user feedback.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        f (Optional[str]): Feedback to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated feedback.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Feedback must be less than 500 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">f</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.SuggestionUpdate.validate_priority" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">SuggestionUpdate</span><span class="o">.</span><span class="n">validate_priority</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate priority level.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Priority to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[int]: Validated priority.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;priority&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_priority</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate priority level.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        p (Optional[int]): Priority to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[int]: Validated priority.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">p</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">p</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Priority must be between 1 and 5.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.suggestion.SuggestionUpdate.validate_title" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">suggestion</span><span class="o">.</span><span class="n">SuggestionUpdate</span><span class="o">.</span><span class="n">validate_title</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate suggestion title.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Title to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[str]: Validated title.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/suggestion.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_title</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate suggestion title.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        t (Optional[str]): Title to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[str]: Validated title.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Title must be less than 100 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">t</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.usage" class="doc doc-heading">
            <code>app.models.usage</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for device usage tracking.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.usage.CreateUsage" class="doc doc-heading">
            <code>app.models.usage.CreateUsage</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for creating new device usage records.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device being monitored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Usage metrics specific to device type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the usage was recorded (defaults to now).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.duration">duration</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration of usage in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.energy_consumed">energy_consumed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy used in kWh.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.CreateUsage.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device status during measurement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateUsage</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for creating new device usage records.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        device_id (str): ID of the device being monitored.</span>
<span class="sd">        metrics (Dict[str, Any]): Usage metrics specific to device type.</span>
<span class="sd">        timestamp (Optional[datetime]): When the usage was recorded (defaults to now).</span>
<span class="sd">        duration (Optional[int]): Duration of usage in seconds.</span>
<span class="sd">        energy_consumed (Optional[float]): Energy used in kWh.</span>
<span class="sd">        status (Optional[str]): Device status during measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">energy_consumed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_device_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate device_id format.</span>

<span class="sd">        Args:</span>
<span class="sd">            v (str): Device ID to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated device ID.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Invalid device ID format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device ID must be a valid string&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_energy_consumed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate energy consumption is positive if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            v (Optional[float]): Energy consumption to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[float]: Validated energy consumption data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Negative energy consumption.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Energy consumption cannot be negative&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_duration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate duration is positive if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            v (Optional[int]): Energy consumption duration to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[int]: Validated energy duration data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Negative duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duration cannot be negative&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.usage.CreateUsage.validate_device_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">CreateUsage</span><span class="o">.</span><span class="n">validate_device_id</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate device_id format.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device ID to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated device ID.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Invalid device ID format.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_device_id</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate device_id format.</span>

<span class="sd">    Args:</span>
<span class="sd">        v (str): Device ID to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated device ID.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Invalid device ID format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Device ID must be a valid string&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.usage.CreateUsage.validate_duration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">CreateUsage</span><span class="o">.</span><span class="n">validate_duration</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate duration is positive if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption duration to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[int]: Validated energy duration data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Negative duration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_duration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate duration is positive if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        v (Optional[int]): Energy consumption duration to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[int]: Validated energy duration data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Negative duration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duration cannot be negative&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.usage.CreateUsage.validate_energy_consumed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">CreateUsage</span><span class="o">.</span><span class="n">validate_energy_consumed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate energy consumption is positive if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[float]: Validated energy consumption data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Negative energy consumption.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_energy_consumed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate energy consumption is positive if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        v (Optional[float]): Energy consumption to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[float]: Validated energy consumption data.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Negative energy consumption.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Energy consumption cannot be negative&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageAggregateResponse" class="doc doc-heading">
            <code>app.models.usage.UsageAggregateResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for aggregated usage statistics returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device being monitored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.start_date">start_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start of the aggregation period.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.end_date">end_date</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End of the aggregation period.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.total_duration">total_duration</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total usage duration in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.total_energy">total_energy</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total energy consumed in kWh.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.average_metrics">average_metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Average of numeric metrics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageAggregateResponse.usage_count">usage_count</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of usage records in the period.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageAggregateResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for aggregated usage statistics returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        device_id (str): ID of the device being monitored.</span>
<span class="sd">        start_date (datetime): Start of the aggregation period.</span>
<span class="sd">        end_date (datetime): End of the aggregation period.</span>
<span class="sd">        total_duration (int): Total usage duration in seconds.</span>
<span class="sd">        total_energy (float): Total energy consumed in kWh.</span>
<span class="sd">        average_metrics (Dict[str, float]): Average of numeric metrics.</span>
<span class="sd">        usage_count (int): Number of usage records in the period.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">total_duration</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_energy</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">average_metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">usage_count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageBulkCreate" class="doc doc-heading">
            <code>app.models.usage.UsageBulkCreate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for bulk creation of usage records.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageBulkCreate.records">records</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="app.models.usage.CreateUsage" href="#app.models.usage.CreateUsage">CreateUsage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of usage records to create.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageBulkCreate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for bulk creation of usage records.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        records (List[CreateUsage]): List of usage records to create.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">records</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CreateUsage</span><span class="p">]</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_records</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CreateUsage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">CreateUsage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate records list is not empty.</span>

<span class="sd">        Args:</span>
<span class="sd">            v (List[CreateUsage]): Records to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[CreateUsage]: Validated usage records.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Records list is empty.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Records list cannot be empty&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.usage.UsageBulkCreate.validate_records" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">UsageBulkCreate</span><span class="o">.</span><span class="n">validate_records</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate records list is not empty.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="app.models.usage.CreateUsage" href="#app.models.usage.CreateUsage">CreateUsage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Records to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="app.models.usage.CreateUsage" href="#app.models.usage.CreateUsage">CreateUsage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[CreateUsage]: Validated usage records.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Records list is empty.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;records&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_records</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">CreateUsage</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">CreateUsage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate records list is not empty.</span>

<span class="sd">    Args:</span>
<span class="sd">        v (List[CreateUsage]): Records to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[CreateUsage]: Validated usage records.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Records list is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Records list cannot be empty&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageDB" class="doc doc-heading">
            <code>app.models.usage.UsageDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing device usage data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique usage record identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device being monitored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Usage metrics specific to device type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the usage was recorded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.duration">duration</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration of usage in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.energy_consumed">energy_consumed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy used in kWh.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device status during measurement.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When this record was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When this record was last updated.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing device usage data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique usage record identifier.</span>
<span class="sd">        device_id (str): ID of the device being monitored.</span>
<span class="sd">        metrics (Dict[str, Any]): Usage metrics specific to device type.</span>
<span class="sd">        timestamp (datetime): When the usage was recorded.</span>
<span class="sd">        duration (Optional[int]): Duration of usage in seconds.</span>
<span class="sd">        energy_consumed (Optional[float]): Energy used in kWh.</span>
<span class="sd">        status (Optional[str]): Device status during measurement.</span>
<span class="sd">        created (datetime): When this record was created.</span>
<span class="sd">        updated (Optional[datetime]): When this record was last updated.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">energy_consumed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageResponse" class="doc doc-heading">
            <code>app.models.usage.UsageResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for usage data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique usage record identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.device_id">device_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the device being monitored.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Usage metrics specific to device type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.timestamp">timestamp</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the usage was recorded.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.duration">duration</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Duration of usage in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.energy_consumed">energy_consumed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy used in kWh.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageResponse.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device status during measurement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for usage data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique usage record identifier.</span>
<span class="sd">        device_id (str): ID of the device being monitored.</span>
<span class="sd">        metrics (Dict[str, Any]): Usage metrics specific to device type.</span>
<span class="sd">        timestamp (datetime): When the usage was recorded.</span>
<span class="sd">        duration (Optional[int]): Duration of usage in seconds.</span>
<span class="sd">        energy_consumed (Optional[float]): Energy used in kWh.</span>
<span class="sd">        status (Optional[str]): Device status during measurement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">energy_consumed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageTimeRange" class="doc doc-heading">
            <code>app.models.usage.UsageTimeRange</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for specifying a time range for usage queries.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageTimeRange.start_time">start_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start of the time range.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageTimeRange.end_time">end_time</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End of the time range.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageTimeRange.device_id">device_id</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional device ID to filter by.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageTimeRange</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for specifying a time range for usage queries.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        start_time (datetime): Start of the time range.</span>
<span class="sd">        end_time (datetime): End of the time range.</span>
<span class="sd">        device_id (Optional[str]): Optional device ID to filter by.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_end_time</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate end_time is after start_time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End time must be after start time&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.usage.UsageTimeRange.validate_end_time" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">UsageTimeRange</span><span class="o">.</span><span class="n">validate_end_time</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate end_time is after start_time.</p>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_end_time</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">info</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate end_time is after start_time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="n">info</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;End time must be after start time&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.usage.UsageUpdate" class="doc doc-heading">
            <code>app.models.usage.UsageUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating usage information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageUpdate.metrics">metrics</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated metrics.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageUpdate.duration">duration</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated duration in seconds.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageUpdate.energy_consumed">energy_consumed</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated energy consumption in kWh.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.usage.UsageUpdate.status">status</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated device status.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/usage.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UsageUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating usage information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        metrics (Optional[Dict[str, Any]]): Updated metrics.</span>
<span class="sd">        duration (Optional[int]): Updated duration in seconds.</span>
<span class="sd">        energy_consumed (Optional[float]): Updated energy consumption in kWh.</span>
<span class="sd">        status (Optional[str]): Updated device status.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">metrics</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">duration</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">energy_consumed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_energy_consumed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate energy consumption is positive if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            v Optional[float]: Energy consumption metric to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[float]: Validated energy consumption data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ValueError: Negative energy consumption.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Energy consumption cannot be negative&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_duration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate duration is positive if provided.</span>

<span class="sd">        Args:</span>
<span class="sd">            v Optional[float]: Energy consumption duration to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[float]: Validated energy duration data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ValueError: Negative duration.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duration cannot be negative&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.usage.UsageUpdate.validate_duration" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">UsageUpdate</span><span class="o">.</span><span class="n">validate_duration</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate duration is positive if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption duration to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[float]: Validated energy duration data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ValueError</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Negative duration.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;duration&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_duration</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate duration is positive if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        v Optional[float]: Energy consumption duration to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[float]: Validated energy duration data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ValueError: Negative duration.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Duration cannot be negative&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.usage.UsageUpdate.validate_energy_consumed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">usage</span><span class="o">.</span><span class="n">UsageUpdate</span><span class="o">.</span><span class="n">validate_energy_consumed</span><span class="p">(</span><span class="n">v</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate energy consumption is positive if provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption metric to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[float]: Validated energy consumption data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ValueError</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Negative energy consumption.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/usage.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_energy_consumed</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate energy consumption is positive if provided.</span>

<span class="sd">    Args:</span>
<span class="sd">        v Optional[float]: Energy consumption metric to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[float]: Validated energy consumption data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ValueError: Negative energy consumption.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Energy consumption cannot be negative&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">v</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.models.user" class="doc doc-heading">
            <code>app.models.user</code>


</h2>

    <div class="doc doc-contents first">

        <p>Models for user validation.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.models.user.CreateUser" class="doc doc-heading">
            <code>app.models.user.CreateUser</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for user registration input.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.CreateUser.username">username</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's desired username.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.CreateUser.email">email</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's email address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.CreateUser.password">password</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's password.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">CreateUser</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for user registration input.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        username (str): User&#39;s desired username.</span>
<span class="sd">        email (str): User&#39;s email address.</span>
<span class="sd">        password (str): User&#39;s password.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>     <span class="c1"># Defaults to admin</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_username</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate username according to requirements.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            u (str): Username to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated username.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be less than 30 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate password according to requirements.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            p (str): Password to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated password.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 number.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 letter.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 lowercase letter.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 uppercase letter.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;!@#$%^&amp;*()_+-=[]</span><span class="si">{}</span><span class="s2">|;&#39;:</span><span class="se">\&quot;</span><span class="s2">,.&lt;&gt;?/&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 special character.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.user.CreateUser.validate_password" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">CreateUser</span><span class="o">.</span><span class="n">validate_password</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate password according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Password to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated password.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;password&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_password</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate password according to requirements.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        p (str): Password to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated password.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must be at least 8 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 number.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 letter.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 lowercase letter.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 uppercase letter.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="s2">&quot;!@#$%^&amp;*()_+-=[]</span><span class="si">{}</span><span class="s2">|;&#39;:</span><span class="se">\&quot;</span><span class="s2">,.&lt;&gt;?/&quot;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">p</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password must contain at least 1 special character.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.models.user.CreateUser.validate_username" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">CreateUser</span><span class="o">.</span><span class="n">validate_username</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate username according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated username.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_username</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate username according to requirements.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        u (str): Username to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated username.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be at least 3 characters long.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be less than 30 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.user.UserDB" class="doc doc-heading">
            <code>app.models.user.UserDB</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Internal model representing user data in the database.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique user identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.username">username</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.email">email</span></code></td>
            <td>
                  <code><span title="pydantic.EmailStr">EmailStr</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's email address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.hashed_password">hashed_password</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Securely hashed password.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.active">active</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the user account is currently active.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the user account was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.updated">updated</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the user account was last updated.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserDB.role">role</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's role, default to admin.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserDB</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Internal model representing user data in the database.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique user identifier.</span>
<span class="sd">        username (str): Username.</span>
<span class="sd">        email (EmailStr): User&#39;s email address.</span>
<span class="sd">        hashed_password (str): Securely hashed password.</span>
<span class="sd">        active (bool): Whether the user account is currently active.</span>
<span class="sd">        created (datetime): When the user account was created.</span>
<span class="sd">        updated (Optional[datetime]): When the user account was last updated.</span>
<span class="sd">        role (str): User&#39;s role, default to admin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()))</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">EmailStr</span>
    <span class="n">hashed_password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">verified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">)</span>
    <span class="n">updated</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">role</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;admin&quot;</span>     <span class="c1"># Defaults to admin</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.user.UserResponse" class="doc doc-heading">
            <code>app.models.user.UserResponse</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for user data returned in API responses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserResponse.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique user identifier.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserResponse.username">username</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserResponse.email">email</span></code></td>
            <td>
                  <code><span title="pydantic.EmailStr">EmailStr</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's email address.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserResponse.active">active</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the user account is currently active.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserResponse.created">created</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the user account was created.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserResponse</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for user data returned in API responses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        id (str): Unique user identifier.</span>
<span class="sd">        username (str): Username.</span>
<span class="sd">        email (EmailStr): User&#39;s email address.</span>
<span class="sd">        active (bool): Whether the user account is currently active.</span>
<span class="sd">        created (datetime): When the user account was created.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">active</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">created</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="n">model_config</span> <span class="o">=</span> <span class="n">ConfigDict</span><span class="p">(</span><span class="n">from_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="app.models.user.UserUpdate" class="doc doc-heading">
            <code>app.models.user.UserUpdate</code>


</h3>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Model for updating user information.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserUpdate.username">username</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's updated username.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="app.models.user.UserUpdate.email">email</span></code></td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="pydantic.EmailStr">EmailStr</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User's updated email address.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>app/models/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserUpdate</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Model for updating user information.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        username (Optional[str]): User&#39;s updated username.</span>
<span class="sd">        email (Optional[EmailStr]): User&#39;s updated email address.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">email</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EmailStr</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">validate_username</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate username according to requirements.</span>

<span class="sd">        Arguments:</span>
<span class="sd">            u (str): Username to be validated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Validated username.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Validation encountered a missing requirement.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be at least 3 characters long.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be less than 30 characters long.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.models.user.UserUpdate.validate_username" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">models</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">UserUpdate</span><span class="o">.</span><span class="n">validate_username</span><span class="p">(</span><span class="n">u</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Validate username according to requirements.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Username to be validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validated username.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation encountered a missing requirement.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/models/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@field_validator</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
<span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">validate_username</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">u</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate username according to requirements.</span>

<span class="sd">    Arguments:</span>
<span class="sd">        u (str): Username to be validated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Validated username.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: Validation encountered a missing requirement.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be at least 3 characters long.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Username must be less than 30 characters long.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.access_management_routes" class="doc doc-heading">
            <code>app.routes.access_management_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Access management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.access_management_routes.create_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">access_management_routes</span><span class="o">.</span><span class="n">create_access_management</span><span class="p">(</span><span class="n">access_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create new access management entries.</p>
<p>Users can only create entries where they are the owner.
Admin users can create entries for any owner.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/access_management_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">AccessManagementResponse</span><span class="p">],</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_access_management</span><span class="p">(</span>
    <span class="n">access_create</span><span class="p">:</span> <span class="n">CreateAccessManagement</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create new access management entries.</span>

<span class="sd">    Users can only create entries where they are the owner.</span>
<span class="sd">    Admin users can create entries for any owner.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">access_create</span><span class="o">.</span><span class="n">owner_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create access for another owner&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a list to hold all created entries</span>
    <span class="n">created_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create an entry for each user_id in the list</span>
    <span class="k">for</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="n">access_create</span><span class="o">.</span><span class="n">user_ids</span><span class="p">:</span>
        <span class="c1"># Create a new AccessManagementDB model</span>
        <span class="n">access_db</span> <span class="o">=</span> <span class="n">AccessManagementDB</span><span class="p">(</span>
            <span class="n">owner_id</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
            <span class="n">resource_id</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">resource_id</span><span class="p">,</span>
            <span class="n">resource_type</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">resource_type</span><span class="p">,</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
            <span class="n">access_level</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">access_level</span><span class="p">,</span>
            <span class="n">expires_at</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">expires_at</span><span class="p">,</span>
            <span class="n">note</span><span class="o">=</span><span class="n">access_create</span><span class="o">.</span><span class="n">note</span>
        <span class="p">)</span>

        <span class="c1"># Insert the entry into the database</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">am_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">access_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
            <span class="n">created_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">access_db</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="c1"># Skip duplicates and continue</span>
            <span class="k">continue</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">created_entries</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;No access entries were created. They might already exist.&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">AccessManagementResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">created_entries</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.access_management_routes.delete_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">access_management_routes</span><span class="o">.</span><span class="n">delete_access_management</span><span class="p">(</span><span class="n">entry_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete an access management entry.</p>
<p>Users can only delete entries where they are the owner.
Admin users can delete any entry.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/access_management_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{entry_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_access_management</span><span class="p">(</span>
    <span class="n">entry_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an access management entry.</span>

<span class="sd">    Users can only delete entries where they are the owner.</span>
<span class="sd">    Admin users can delete any entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the entry to delete</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Access management entry with ID </span><span class="si">{</span><span class="n">entry_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this access entry&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete access management entry&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.access_management_routes.get_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">access_management_routes</span><span class="o">.</span><span class="n">get_access_management</span><span class="p">(</span><span class="n">entry_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single access management entry by ID.</p>
<p>Users can only access entries where they are the owner or the granted user.
Admin users can access any entry.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/access_management_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{entry_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AccessManagementResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_access_management</span><span class="p">(</span>
    <span class="n">entry_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single access management entry by ID.</span>

<span class="sd">    Users can only access entries where they are the owner or the granted user.</span>
<span class="sd">    Admin users can access any entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the entry</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Access management entry with ID </span><span class="si">{</span><span class="n">entry_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner, the granted user, or an admin</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> 
        <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">]</span> <span class="ow">and</span> 
        <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this entry&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AccessManagementResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.access_management_routes.get_all_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">access_management_routes</span><span class="o">.</span><span class="n">get_all_access_management</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">owner_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resource_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resource_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">access_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all access management entries.</p>
<p>Admin users can see all entries.
Regular users can only see entries where they are the owner or the granted user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/access_management_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">AccessManagementResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_access_management</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">owner_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resource_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resource_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ResourceType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">access_level</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AccessLevel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AccessManagementResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all access management entries.</span>

<span class="sd">    Admin users can see all entries.</span>
<span class="sd">    Regular users can only see entries where they are the owner or the granted user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access entries they own or are granted to them</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;$or&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;owner_id&quot;</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">}</span>
        <span class="p">]</span>

    <span class="c1"># Add filters if provided</span>
    <span class="k">if</span> <span class="n">owner_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">owner_id</span>
    <span class="k">if</span> <span class="n">resource_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;resource_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource_id</span>
    <span class="k">if</span> <span class="n">resource_type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;resource_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">resource_type</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">access_level</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;access_level&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">access_level</span>
    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to AccessManagementResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">AccessManagementResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">entries</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.access_management_routes.update_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">access_management_routes</span><span class="o">.</span><span class="n">update_access_management</span><span class="p">(</span><span class="n">entry_id</span><span class="p">,</span> <span class="n">access_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update an access management entry.</p>
<p>Users can only update entries where they are the owner.
Admin users can update any entry.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/access_management_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{entry_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AccessManagementResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_access_management</span><span class="p">(</span>
    <span class="n">entry_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">access_update</span><span class="p">:</span> <span class="n">AccessManagementUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an access management entry.</span>

<span class="sd">    Users can only update entries where they are the owner.</span>
<span class="sd">    Admin users can update any entry.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the entry to update</span>
    <span class="n">entry</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entry</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Access management entry with ID </span><span class="si">{</span><span class="n">entry_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;owner_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this access entry&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">access_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Access management entry not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate entry&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated entry</span>
    <span class="n">updated_entry</span> <span class="o">=</span> <span class="n">am_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">entry_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">AccessManagementResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_entry</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.analytics_routes" class="doc doc-heading">
            <code>app.routes.analytics_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Analytics data management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.analytics_routes.create_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">analytics_routes</span><span class="o">.</span><span class="n">create_analytics</span><span class="p">(</span><span class="n">analytics_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new analytics record.
Users can only create analytics for themselves, while admins can create for any user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/analytics_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AnalyticsResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_analytics</span><span class="p">(</span>
    <span class="n">analytics_create</span><span class="p">:</span> <span class="n">CreateAnalytics</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new analytics record.</span>
<span class="sd">    Users can only create analytics for themselves, while admins can create for any user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the analytics owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">analytics_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create analytics for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new AnalyticsDB model</span>
    <span class="n">analytics_db</span> <span class="o">=</span> <span class="n">AnalyticsDB</span><span class="p">(</span><span class="o">**</span><span class="n">analytics_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the analytics into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">an_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">analytics_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Analytics with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AnalyticsResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">analytics_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.analytics_routes.delete_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">analytics_routes</span><span class="o">.</span><span class="n">delete_analytics</span><span class="p">(</span><span class="n">analytics_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete an analytics record.
Users can only delete their own analytics, while admins can delete any analytics.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/analytics_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{analytics_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_analytics</span><span class="p">(</span>
    <span class="n">analytics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an analytics record.</span>
<span class="sd">    Users can only delete their own analytics, while admins can delete any analytics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the analytics to delete</span>
    <span class="n">analytics</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">analytics</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Analytics with ID </span><span class="si">{</span><span class="n">analytics_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">analytics</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this analytics data&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete analytics data&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.analytics_routes.get_all_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">analytics_routes</span><span class="o">.</span><span class="n">get_all_analytics</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all analytics data with filtering options.
Admin users can see all analytics, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/analytics_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">AnalyticsResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_analytics</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AnalyticsResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all analytics data with filtering options.</span>
<span class="sd">    Admin users can see all analytics, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create query object and validate time range if provided</span>
    <span class="n">query_params</span> <span class="o">=</span> <span class="n">AnalyticsQuery</span><span class="p">(</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">device_id</span><span class="o">=</span><span class="n">device_id</span><span class="p">,</span>
        <span class="n">data_type</span><span class="o">=</span><span class="n">data_type</span><span class="p">,</span>
        <span class="n">start_time</span><span class="o">=</span><span class="n">start_time</span><span class="p">,</span>
        <span class="n">end_time</span><span class="o">=</span><span class="n">end_time</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="n">tags</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">start_time</span> <span class="ow">and</span> <span class="n">end_time</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">query_params</span><span class="o">.</span><span class="n">validate_time_range_post_init</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>

    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own analytics</span>
        <span class="n">query_params</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build MongoDB query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">user_id</span>
    <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">device_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">device_id</span>
    <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">data_type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;data_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">data_type</span>

    <span class="c1"># Time range filters</span>
    <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">start_time</span> <span class="ow">or</span> <span class="n">query_params</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">][</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">start_time</span>
        <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">][</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query_params</span><span class="o">.</span><span class="n">end_time</span>

    <span class="c1"># Tags filter (if one of the specified tags is in the analytics tags list)</span>
    <span class="k">if</span> <span class="n">query_params</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">query_params</span><span class="o">.</span><span class="n">tags</span><span class="p">}</span>

    <span class="c1"># Add sorting by timestamp (descending)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">analytics_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to AnalyticsResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">AnalyticsResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">analytics_data</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.analytics_routes.get_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">analytics_routes</span><span class="o">.</span><span class="n">get_analytics</span><span class="p">(</span><span class="n">analytics_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single analytics record by ID.
Users can only access their own analytics, while admins can access any analytics.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/analytics_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{analytics_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AnalyticsResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_analytics</span><span class="p">(</span>
    <span class="n">analytics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single analytics record by ID.</span>
<span class="sd">    Users can only access their own analytics, while admins can access any analytics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the analytics record</span>
    <span class="n">analytics</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">analytics</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Analytics with ID </span><span class="si">{</span><span class="n">analytics_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">analytics</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this analytics data&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AnalyticsResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">analytics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.analytics_routes.update_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">analytics_routes</span><span class="o">.</span><span class="n">update_analytics</span><span class="p">(</span><span class="n">analytics_id</span><span class="p">,</span> <span class="n">analytics_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update an analytics record.
Users can only update their own analytics, while admins can update any analytics.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/analytics_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{analytics_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AnalyticsResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_analytics</span><span class="p">(</span>
    <span class="n">analytics_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">analytics_update</span><span class="p">:</span> <span class="n">AnalyticsUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an analytics record.</span>
<span class="sd">    Users can only update their own analytics, while admins can update any analytics.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the analytics to update</span>
    <span class="n">analytics</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">analytics</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Analytics with ID </span><span class="si">{</span><span class="n">analytics_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">analytics</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this analytics data&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">analytics_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Analytics data not modified&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated analytics</span>
    <span class="n">updated_analytics</span> <span class="o">=</span> <span class="n">an_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">analytics_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">AnalyticsResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_analytics</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.automation_routes" class="doc doc-heading">
            <code>app.routes.automation_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Automation management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.automation_routes.create_automation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">automation_routes</span><span class="o">.</span><span class="n">create_automation</span><span class="p">(</span><span class="n">automation_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new automation.
Users can only create automations for themselves, while admins can create for any user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/automation_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AutomationDetailResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_automation</span><span class="p">(</span>
    <span class="n">automation_create</span><span class="p">:</span> <span class="n">CreateAutomation</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new automation.</span>
<span class="sd">    Users can only create automations for themselves, while admins can create for any user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the automation owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">automation_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create automation for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new AutomationDB model</span>
    <span class="n">automation_db</span> <span class="o">=</span> <span class="n">AutomationDB</span><span class="p">(</span><span class="o">**</span><span class="n">automation_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the automation into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">a_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">automation_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Automation with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AutomationDetailResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">automation_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.automation_routes.delete_automation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">automation_routes</span><span class="o">.</span><span class="n">delete_automation</span><span class="p">(</span><span class="n">automation_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete an automation.
Users can only delete their own automations, while admins can delete any automation.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/automation_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{automation_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_automation</span><span class="p">(</span>
    <span class="n">automation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an automation.</span>
<span class="sd">    Users can only delete their own automations, while admins can delete any automation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the automation to delete</span>
    <span class="n">automation</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">automation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Automation with ID </span><span class="si">{</span><span class="n">automation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the automation owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this automation&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete automation&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.automation_routes.get_all_automations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">automation_routes</span><span class="o">.</span><span class="n">get_all_automations</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">trigger_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enabled</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all automations.
Admin users can see all automations, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/automation_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">AutomationResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_automations</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">trigger_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TriggerType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">action_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ActionType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">enabled</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AutomationResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all automations.</span>
<span class="sd">    Admin users can see all automations, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own automations</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">device_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
    <span class="k">if</span> <span class="n">trigger_type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;trigger_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trigger_type</span>
    <span class="k">if</span> <span class="n">action_type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;action_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">action_type</span>
    <span class="k">if</span> <span class="n">enabled</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;enabled&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">enabled</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">automations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to AutomationResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">AutomationResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">automation</span><span class="p">)</span> <span class="k">for</span> <span class="n">automation</span> <span class="ow">in</span> <span class="n">automations</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.automation_routes.get_automation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">automation_routes</span><span class="o">.</span><span class="n">get_automation</span><span class="p">(</span><span class="n">automation_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single automation by ID.
Users can only access their own automations, while admins can access any automation.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/automation_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{automation_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AutomationDetailResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_automation</span><span class="p">(</span>
    <span class="n">automation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single automation by ID.</span>
<span class="sd">    Users can only access their own automations, while admins can access any automation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the automation</span>
    <span class="n">automation</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">automation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Automation with ID </span><span class="si">{</span><span class="n">automation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the automation owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this automation&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">AutomationDetailResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">automation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.automation_routes.update_automation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">automation_routes</span><span class="o">.</span><span class="n">update_automation</span><span class="p">(</span><span class="n">automation_id</span><span class="p">,</span> <span class="n">automation_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update an automation's information.
Users can only update their own automations, while admins can update any automation.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/automation_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{automation_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">AutomationDetailResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_automation</span><span class="p">(</span>
    <span class="n">automation_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">automation_update</span><span class="p">:</span> <span class="n">AutomationUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an automation&#39;s information.</span>
<span class="sd">    Users can only update their own automations, while admins can update any automation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the automation to update</span>
    <span class="n">automation</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">automation</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Automation with ID </span><span class="si">{</span><span class="n">automation_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the automation owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this automation&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">automation_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Automation data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate entry&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated automation</span>
    <span class="n">updated_automation</span> <span class="o">=</span> <span class="n">a_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">automation_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">AutomationDetailResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_automation</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.device_routes" class="doc doc-heading">
            <code>app.routes.device_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Device management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.device_routes.create_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">device_routes</span><span class="o">.</span><span class="n">create_device</span><span class="p">(</span><span class="n">device_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new device.
Users can only create devices for themselves, while admins can create devices for any user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/device_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">DeviceResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_device</span><span class="p">(</span>
    <span class="n">device_create</span><span class="p">:</span> <span class="n">CreateDevice</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new device.</span>
<span class="sd">    Users can only create devices for themselves, while admins can create devices for any user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the device owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">device_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create device for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Generate a unique ID for the device</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

    <span class="c1"># Create a new DeviceDB model with the generated ID</span>
    <span class="n">device_data</span> <span class="o">=</span> <span class="n">device_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
    <span class="n">device_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>
    <span class="n">device_db</span> <span class="o">=</span> <span class="n">DeviceDB</span><span class="p">(</span><span class="o">**</span><span class="n">device_data</span><span class="p">)</span>

    <span class="c1"># Insert the device into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">d_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">device_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Device with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Fetch the newly created device from the database</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">DeviceResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.device_routes.delete_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">device_routes</span><span class="o">.</span><span class="n">delete_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a device.
Users can only delete their own devices, while admins can delete any device.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/device_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{device_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_device</span><span class="p">(</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a device.</span>
<span class="sd">    Users can only delete their own devices, while admins can delete any device.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the device to delete</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Device with ID </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the device owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this device&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete device&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.device_routes.get_all_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">device_routes</span><span class="o">.</span><span class="n">get_all_devices</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">room_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">manufacturer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all devices.
Admin users can see all devices, while regular users can only see their own.</p>
<p>Filter parameters:
- user_id: Filter by user ID
- type: Filter by device type
- room_id: Filter by room ID
- status: Filter by device status
- manufacturer: Filter by manufacturer</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/device_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">DeviceResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_devices</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DeviceType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DeviceStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">DeviceResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all devices.</span>
<span class="sd">    Admin users can see all devices, while regular users can only see their own.</span>

<span class="sd">    Filter parameters:</span>
<span class="sd">    - user_id: Filter by user ID</span>
<span class="sd">    - type: Filter by device type</span>
<span class="sd">    - room_id: Filter by room ID</span>
<span class="sd">    - status: Filter by device status</span>
<span class="sd">    - manufacturer: Filter by manufacturer</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own devices</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">room_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;room_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">room_id</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
    <span class="k">if</span> <span class="n">manufacturer</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;manufacturer&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manufacturer</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to DeviceResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">DeviceResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.device_routes.get_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">device_routes</span><span class="o">.</span><span class="n">get_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single device by ID.
Users can only access their own devices, while admins can access any device.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/device_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{device_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">DeviceResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_device</span><span class="p">(</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single device by ID.</span>
<span class="sd">    Users can only access their own devices, while admins can access any device.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the device</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Device with ID </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the device owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this device&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">DeviceResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.device_routes.update_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">device_routes</span><span class="o">.</span><span class="n">update_device</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">device_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a device's information.
Users can only update their own devices, while admins can update any device.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/device_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{device_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">DeviceResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_device</span><span class="p">(</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">device_update</span><span class="p">:</span> <span class="n">DeviceUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a device&#39;s information.</span>
<span class="sd">    Users can only update their own devices, while admins can update any device.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the device to update</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Device with ID </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the device owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this device&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">device_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Device data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate device&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated device</span>
    <span class="n">updated_device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">DeviceResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_device</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.goal_routes" class="doc doc-heading">
            <code>app.routes.goal_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Energy goal management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.create_goal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">create_goal</span><span class="p">(</span><span class="n">goal_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new energy goal.
Users can only create their own goals, while admins can create any goal.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">EnergyGoalResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_goal</span><span class="p">(</span>
    <span class="n">goal_create</span><span class="p">:</span> <span class="n">CreateEnergyGoal</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new energy goal.</span>
<span class="sd">    Users can only create their own goals, while admins can create any goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the goal owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">goal_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create goal for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new EnergyGoalDB model</span>
    <span class="n">goal_db</span> <span class="o">=</span> <span class="n">EnergyGoalDB</span><span class="p">(</span><span class="o">**</span><span class="n">goal_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Calculate initial progress percentage</span>
    <span class="k">if</span> <span class="n">goal_db</span><span class="o">.</span><span class="n">target_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">goal_db</span><span class="o">.</span><span class="n">progress_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">goal_db</span><span class="o">.</span><span class="n">current_value</span> <span class="o">/</span> <span class="n">goal_db</span><span class="o">.</span><span class="n">target_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Insert the goal into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">g_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">goal_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Goal with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">EnergyGoalResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">goal_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.delete_goal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">delete_goal</span><span class="p">(</span><span class="n">goal_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete an energy goal.
Users can only delete their own goals, while admins can delete any goal.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{goal_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_goal</span><span class="p">(</span>
    <span class="n">goal_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete an energy goal.</span>
<span class="sd">    Users can only delete their own goals, while admins can delete any goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the goal to delete</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Goal with ID </span><span class="si">{</span><span class="n">goal_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the goal owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this goal&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete goal&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.get_all_goals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">get_all_goals</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timeframe</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all energy goals with filtering options.
Admin users can see all goals, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">EnergyGoalResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_goals</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GoalType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GoalStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timeframe</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">GoalTimeframe</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">EnergyGoalResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all energy goals with filtering options.</span>
<span class="sd">    Admin users can see all goals, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own goals</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
    <span class="k">if</span> <span class="n">timeframe</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timeframe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timeframe</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">goals</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to EnergyGoalResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">EnergyGoalResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span> <span class="k">for</span> <span class="n">goal</span> <span class="ow">in</span> <span class="n">goals</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.get_goal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">get_goal</span><span class="p">(</span><span class="n">goal_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single energy goal by ID.
Users can only access their own goals, while admins can access any goal.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{goal_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">EnergyGoalResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_goal</span><span class="p">(</span>
    <span class="n">goal_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single energy goal by ID.</span>
<span class="sd">    Users can only access their own goals, while admins can access any goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the goal</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">goal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Goal with ID </span><span class="si">{</span><span class="n">goal_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the goal owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this goal&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">EnergyGoalResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.update_goal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">update_goal</span><span class="p">(</span><span class="n">goal_id</span><span class="p">,</span> <span class="n">goal_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update an energy goal's information.
Users can only update their own goals, while admins can update any goal.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{goal_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">EnergyGoalResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_goal</span><span class="p">(</span>
    <span class="n">goal_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">goal_update</span><span class="p">:</span> <span class="n">EnergyGoalUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an energy goal&#39;s information.</span>
<span class="sd">    Users can only update their own goals, while admins can update any goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the goal to update</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Goal with ID </span><span class="si">{</span><span class="n">goal_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the goal owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this goal&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">goal_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Calculate progress percentage if current_value or target_value is updated</span>
    <span class="k">if</span> <span class="s2">&quot;current_value&quot;</span> <span class="ow">in</span> <span class="n">update_data</span> <span class="ow">or</span> <span class="s2">&quot;target_value&quot;</span> <span class="ow">in</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="n">current_value</span> <span class="o">=</span> <span class="n">update_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;current_value&quot;</span><span class="p">,</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;current_value&quot;</span><span class="p">])</span>
        <span class="n">target_value</span> <span class="o">=</span> <span class="n">update_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target_value&quot;</span><span class="p">,</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;target_value&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">target_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;progress_percentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_value</span> <span class="o">/</span> <span class="n">target_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Goal data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated goal</span>
    <span class="n">updated_goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">EnergyGoalResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_goal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.goal_routes.update_goal_progress" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">goal_routes</span><span class="o">.</span><span class="n">update_goal_progress</span><span class="p">(</span><span class="n">goal_id</span><span class="p">,</span> <span class="n">progress_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update an energy goal's progress.
Users can only update their own goals, while admins can update any goal.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/goal_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{goal_id}</span><span class="s2">/progress&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">EnergyGoalResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_goal_progress</span><span class="p">(</span>
    <span class="n">goal_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">progress_update</span><span class="p">:</span> <span class="n">EnergyGoalProgressUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update an energy goal&#39;s progress.</span>
<span class="sd">    Users can only update their own goals, while admins can update any goal.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the goal to update</span>
    <span class="n">goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">goal</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Goal with ID </span><span class="si">{</span><span class="n">goal_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the goal owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this goal&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data</span>
    <span class="n">current_value</span> <span class="o">=</span> <span class="n">progress_update</span><span class="o">.</span><span class="n">current_value</span>
    <span class="n">target_value</span> <span class="o">=</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;target_value&quot;</span><span class="p">]</span>

    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;current_value&quot;</span><span class="p">:</span> <span class="n">current_value</span><span class="p">,</span>
        <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1"># Calculate progress percentage</span>
    <span class="k">if</span> <span class="n">target_value</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;progress_percentage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">current_value</span> <span class="o">/</span> <span class="n">target_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="c1"># Auto-update status if completed</span>
        <span class="k">if</span> <span class="n">current_value</span> <span class="o">&gt;=</span> <span class="n">target_value</span> <span class="ow">and</span> <span class="n">goal</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">ACTIVE</span><span class="p">:</span>
            <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">GoalStatus</span><span class="o">.</span><span class="n">COMPLETED</span>

    <span class="c1"># Perform the update</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Goal progress not modified&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Error updating goal progress: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated goal</span>
    <span class="n">updated_goal</span> <span class="o">=</span> <span class="n">g_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">goal_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">EnergyGoalResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_goal</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.notification_routes" class="doc doc-heading">
            <code>app.routes.notification_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Notification management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.bulk_update_notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">bulk_update_notifications</span><span class="p">(</span><span class="n">bulk_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update multiple notifications at once (typically to mark them as read/unread).
Users can only update their own notifications, while admins can update any notification.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/bulk_update&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">bulk_update_notifications</span><span class="p">(</span>
    <span class="n">bulk_update</span><span class="p">:</span> <span class="n">NotificationBulkUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update multiple notifications at once (typically to mark them as read/unread).</span>
<span class="sd">    Users can only update their own notifications, while admins can update any notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build query to match only authorized notifications</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">bulk_update</span><span class="o">.</span><span class="n">notification_ids</span><span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># For regular users, restrict to their own notifications</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Set up update data</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="n">bulk_update</span><span class="o">.</span><span class="n">read</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">bulk_update</span><span class="o">.</span><span class="n">read</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;read_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;read_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Perform the update</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">update_many</span><span class="p">(</span>
        <span class="n">query</span><span class="p">,</span>
        <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;modified_count&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span><span class="p">,</span>
        <span class="s2">&quot;matched_count&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">matched_count</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.create_notification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">create_notification</span><span class="p">(</span><span class="n">notification_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new notification.
Admins can create notifications for any user,
regular users can only create notifications for themselves.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">NotificationResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_notification</span><span class="p">(</span>
    <span class="n">notification_create</span><span class="p">:</span> <span class="n">CreateNotification</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new notification.</span>
<span class="sd">    Admins can create notifications for any user,</span>
<span class="sd">    regular users can only create notifications for themselves.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the notification owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">notification_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create notification for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new NotificationDB model</span>
    <span class="n">notification_db</span> <span class="o">=</span> <span class="n">NotificationDB</span><span class="p">(</span><span class="o">**</span><span class="n">notification_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the notification into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">n_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">notification_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Notification with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">NotificationResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">notification_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.delete_notification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">delete_notification</span><span class="p">(</span><span class="n">notification_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a notification.
Users can only delete their own notifications, while admins can delete any notification.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{notification_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_notification</span><span class="p">(</span>
    <span class="n">notification_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a notification.</span>
<span class="sd">    Users can only delete their own notifications, while admins can delete any notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the notification to delete</span>
    <span class="n">notification</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">notification</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Notification with ID </span><span class="si">{</span><span class="n">notification_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the notification owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">notification</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this notification&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete notification&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.delete_notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">delete_notifications</span><span class="p">(</span><span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete multiple notifications based on filter criteria.
Users can only delete their own notifications, while admins can delete any notification.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_notifications</span><span class="p">(</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete multiple notifications based on filter criteria.</span>
<span class="sd">    Users can only delete their own notifications, while admins can delete any notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build query</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only delete their own notifications</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>
    <span class="k">elif</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="c1"># Admin users can specify a user_id filter</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>

    <span class="c1"># Add additional filters if provided</span>
    <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">read</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>
    <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">delete_many</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.get_all_notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">get_all_notifications</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all notifications.
Admin users can see all notifications, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">NotificationResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_notifications</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">read</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">source</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">NotificationResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all notifications.</span>
<span class="sd">    Admin users can see all notifications, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own notifications</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">read</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;read&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">read</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>
    <span class="k">if</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;source&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">source</span>

    <span class="c1"># Date range query</span>
    <span class="n">date_query</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">from_date</span><span class="p">:</span>
        <span class="n">date_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_date</span>
    <span class="k">if</span> <span class="n">to_date</span><span class="p">:</span>
        <span class="n">date_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_date</span>
    <span class="k">if</span> <span class="n">date_query</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_query</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">notifications</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to NotificationResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">NotificationResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span> <span class="k">for</span> <span class="n">notification</span> <span class="ow">in</span> <span class="n">notifications</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.get_notification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">get_notification</span><span class="p">(</span><span class="n">notification_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single notification by ID.
Users can only access their own notifications, while admins can access any notification.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{notification_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">NotificationResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_notification</span><span class="p">(</span>
    <span class="n">notification_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single notification by ID.</span>
<span class="sd">    Users can only access their own notifications, while admins can access any notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the notification</span>
    <span class="n">notification</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">notification</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Notification with ID </span><span class="si">{</span><span class="n">notification_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the notification owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">notification</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this notification&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">NotificationResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.notification_routes.update_notification" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">notification_routes</span><span class="o">.</span><span class="n">update_notification</span><span class="p">(</span><span class="n">notification_id</span><span class="p">,</span> <span class="n">notification_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a notification's information.
Users can only update their own notifications, while admins can update any notification.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/notification_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{notification_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">NotificationResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_notification</span><span class="p">(</span>
    <span class="n">notification_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">notification_update</span><span class="p">:</span> <span class="n">NotificationUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a notification&#39;s information.</span>
<span class="sd">    Users can only update their own notifications, while admins can update any notification.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the notification to update</span>
    <span class="n">notification</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">notification</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Notification with ID </span><span class="si">{</span><span class="n">notification_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the notification owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">notification</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this notification&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">notification_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># If marking as read, add the read timestamp</span>
    <span class="k">if</span> <span class="n">notification_update</span><span class="o">.</span><span class="n">read</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">and</span> <span class="n">notification</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;read_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># If marking as unread, remove the read timestamp</span>
    <span class="k">if</span> <span class="n">notification_update</span><span class="o">.</span><span class="n">read</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;read_timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Notification data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate notification ID&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated notification</span>
    <span class="n">updated_notification</span> <span class="o">=</span> <span class="n">n_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">notification_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">NotificationResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_notification</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.profile_routes" class="doc doc-heading">
            <code>app.routes.profile_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Profile management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.profile_routes.create_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">profile_routes</span><span class="o">.</span><span class="n">create_profile</span><span class="p">(</span><span class="n">profile_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new profile.
Users can only create their own profile, while admins can create any profile.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/profile_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">ProfileResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_profile</span><span class="p">(</span>
    <span class="n">profile_create</span><span class="p">:</span> <span class="n">CreateProfile</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new profile.</span>
<span class="sd">    Users can only create their own profile, while admins can create any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the profile owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">profile_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create profile for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if a profile already exists for this user_id</span>
    <span class="n">existing_profile</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">profile_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">existing_profile</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Profile already exists for user with ID </span><span class="si">{</span><span class="n">profile_create</span><span class="o">.</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new ProfileDB model</span>
    <span class="n">profile_db</span> <span class="o">=</span> <span class="n">ProfileDB</span><span class="p">(</span><span class="o">**</span><span class="n">profile_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the profile into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">profile_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Profile with this ID or user_id already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ProfileResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">profile_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.profile_routes.delete_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">profile_routes</span><span class="o">.</span><span class="n">delete_profile</span><span class="p">(</span><span class="n">profile_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a profile.
Users can only delete their own profile, while admins can delete any profile.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/profile_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{profile_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a profile.</span>
<span class="sd">    Users can only delete their own profile, while admins can delete any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the profile to delete</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Profile with ID </span><span class="si">{</span><span class="n">profile_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the profile owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this profile&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete profile&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.profile_routes.get_all_profiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">profile_routes</span><span class="o">.</span><span class="n">get_all_profiles</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timezone</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature_unit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dark_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all profiles.
Admin users can see all profiles, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/profile_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">ProfileResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_profiles</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timezone</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">temperature_unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">dark_mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">ProfileResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all profiles.</span>
<span class="sd">    Admin users can see all profiles, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own profile</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">timezone</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timezone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timezone</span>
    <span class="k">if</span> <span class="n">temperature_unit</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;temperature_unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temperature_unit</span>
    <span class="k">if</span> <span class="n">dark_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;dark_mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dark_mode</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">profiles</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to ProfileResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ProfileResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span> <span class="k">for</span> <span class="n">profile</span> <span class="ow">in</span> <span class="n">profiles</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.profile_routes.get_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">profile_routes</span><span class="o">.</span><span class="n">get_profile</span><span class="p">(</span><span class="n">profile_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single profile by ID.
Users can only access their own profile, while admins can access any profile.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/profile_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{profile_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">ProfileResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single profile by ID.</span>
<span class="sd">    Users can only access their own profile, while admins can access any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the profile</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Profile with ID </span><span class="si">{</span><span class="n">profile_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the profile owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this profile&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">ProfileResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.profile_routes.update_profile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">profile_routes</span><span class="o">.</span><span class="n">update_profile</span><span class="p">(</span><span class="n">profile_id</span><span class="p">,</span> <span class="n">profile_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a profile's information.
Users can only update their own profile, while admins can update any profile.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/profile_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{profile_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">ProfileResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_profile</span><span class="p">(</span>
    <span class="n">profile_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">profile_update</span><span class="p">:</span> <span class="n">ProfileUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a profile&#39;s information.</span>
<span class="sd">    Users can only update their own profile, while admins can update any profile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the profile to update</span>
    <span class="n">profile</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">profile</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Profile with ID </span><span class="si">{</span><span class="n">profile_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the profile owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">profile</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this profile&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">profile_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Profile data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate user_id&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated profile</span>
    <span class="n">updated_profile</span> <span class="o">=</span> <span class="n">p_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">profile_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ProfileResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_profile</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.report_routes" class="doc doc-heading">
            <code>app.routes.report_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>API routes for report generation and management.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.create_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">create_report</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">background_tasks</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Request generation of a new energy report.</p>
<p>The report will be generated asynchronously in the background.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_202_ACCEPTED</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">ReportResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_report</span><span class="p">(</span>
    <span class="n">request</span><span class="p">:</span> <span class="n">CreateReportRequest</span><span class="p">,</span>
    <span class="n">background_tasks</span><span class="p">:</span> <span class="n">BackgroundTasks</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Request generation of a new energy report.</span>

<span class="sd">    The report will be generated asynchronously in the background.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a title if none provided</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">title</span><span class="p">:</span>
        <span class="n">timeframe</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">start_date</span> <span class="ow">and</span> <span class="n">request</span><span class="o">.</span><span class="n">end_date</span><span class="p">:</span>
            <span class="n">timeframe</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">end_date</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="n">request</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Energy Report</span><span class="si">{</span><span class="n">timeframe</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Create report record</span>
    <span class="n">report_db</span> <span class="o">=</span> <span class="n">ReportDB</span><span class="p">(</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user_id</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">end_date</span><span class="p">,</span>
        <span class="n">device_ids</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">device_ids</span> <span class="ow">or</span> <span class="p">[],</span>
        <span class="n">report_type</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">report_type</span>
    <span class="p">)</span>

    <span class="c1"># Save to database - run in executor to make it non-blocking</span>
    <span class="n">report_id</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">create_report</span><span class="p">)(</span><span class="n">report_db</span><span class="p">)</span>

    <span class="c1"># Start background task to generate report - will run in thread pool</span>
    <span class="nd">@run_in_executor</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report_wrapper</span><span class="p">(</span><span class="n">report_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span>

    <span class="n">background_tasks</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">generate_report_wrapper</span><span class="p">,</span> <span class="n">report_id</span><span class="p">)</span>

    <span class="c1"># Get the created report - run in executor to make it non-blocking</span>
    <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">)(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to create report&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create response with download URL</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">ReportResponse</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
        <span class="n">status</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
        <span class="n">report_type</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;report_type&quot;</span><span class="p">],</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
        <span class="n">device_ids</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="n">created</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
        <span class="n">completed</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completed&quot;</span><span class="p">),</span>
        <span class="n">download_url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v1/reports/</span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/download&quot;</span> <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.delete_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">delete_report</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ID of the report to delete&#39;</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a report and its associated file.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{report_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_report</span><span class="p">(</span>
    <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of the report to delete&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a report and its associated file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">)(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Report not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Delete the file if it exists</span>
    <span class="n">file_path</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">file_path</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Log but don&#39;t fail if file deletion fails</span>
            <span class="k">pass</span>

    <span class="c1"># Delete from database</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">delete_report</span><span class="p">)(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete report&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.download_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">download_report</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ID of the report to download&#39;</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Download a generated report file.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{report_id}</span><span class="s2">/download&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">download_report</span><span class="p">(</span>
    <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of the report to download&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a generated report file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">)(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Report not found&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Report is not ready for download. Current status: </span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="n">file_path</span> <span class="o">=</span> <span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;file_path&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Report file not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Determine file type for content-type header</span>
    <span class="n">media_type</span> <span class="o">=</span> <span class="s2">&quot;application/pdf&quot;</span> <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;pdf&quot;</span> <span class="k">else</span> <span class="s2">&quot;text/csv&quot;</span>

    <span class="c1"># Get filename from path</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">FileResponse</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="n">file_path</span><span class="p">,</span>
        <span class="n">media_type</span><span class="o">=</span><span class="n">media_type</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="n">filename</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.get_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ID of the report to retrieve&#39;</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the status and details of a specific report.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{report_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">ReportResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_report</span><span class="p">(</span>
    <span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of the report to retrieve&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the status and details of a specific report.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">)(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Report not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create response</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">ReportResponse</span><span class="p">(</span>
        <span class="nb">id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
        <span class="nb">format</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
        <span class="n">status</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
        <span class="n">report_type</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;report_type&quot;</span><span class="p">],</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
        <span class="n">device_ids</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="n">created</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
        <span class="n">completed</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completed&quot;</span><span class="p">),</span>
        <span class="n">download_url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v1/reports/</span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/download&quot;</span> <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">response</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.get_user_reports" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">get_user_reports</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;ID of the user&#39;</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Maximum number of reports to return&#39;</span><span class="p">),</span> <span class="n">offset</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">&#39;Offset for pagination&#39;</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all reports for a specific user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/user/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">ReportResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user_reports</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;ID of the user&quot;</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Maximum number of reports to return&quot;</span><span class="p">),</span>
    <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Offset for pagination&quot;</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all reports for a specific user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_in_executor</span><span class="p">(</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_user_reports</span><span class="p">)(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="c1"># Apply pagination</span>
    <span class="n">paginated_reports</span> <span class="o">=</span> <span class="n">reports</span><span class="p">[</span><span class="n">offset</span><span class="p">:</span><span class="n">offset</span><span class="o">+</span><span class="n">limit</span><span class="p">]</span>

    <span class="c1"># Create response</span>
    <span class="n">responses</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">report</span> <span class="ow">in</span> <span class="n">paginated_reports</span><span class="p">:</span>
        <span class="n">responses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">ReportResponse</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
                <span class="n">title</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">],</span>
                <span class="n">status</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
                <span class="n">report_type</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;report_type&quot;</span><span class="p">],</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
                <span class="n">device_ids</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">,</span> <span class="p">[]),</span>
                <span class="n">created</span><span class="o">=</span><span class="n">report</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
                <span class="n">completed</span><span class="o">=</span><span class="n">report</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;completed&quot;</span><span class="p">),</span>
                <span class="n">download_url</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;/api/v1/reports/</span><span class="si">{</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">/download&quot;</span> <span class="k">if</span> <span class="n">report</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">responses</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.report_routes.run_in_executor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">report_routes</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span><span class="n">func</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Decorator to run synchronous functions in a thread pool executor.
Makes them non-blocking for FastAPI's async framework.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/report_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">run_in_executor</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Decorator to run synchronous functions in a thread pool executor.</span>
<span class="sd">    Makes them non-blocking for FastAPI&#39;s async framework.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span><span class="o">.</span><span class="n">run_in_executor</span><span class="p">(</span>
            <span class="n">executor</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.room_routes" class="doc doc-heading">
            <code>app.routes.room_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Room management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.room_routes.create_room" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">room_routes</span><span class="o">.</span><span class="n">create_room</span><span class="p">(</span><span class="n">room_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new room.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/room_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">RoomResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_room</span><span class="p">(</span>
    <span class="n">room_create</span><span class="p">:</span> <span class="n">CreateRoom</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new room.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a new RoomDB model with user_id set to current user</span>
    <span class="n">room_db</span> <span class="o">=</span> <span class="n">RoomDB</span><span class="p">(</span>
        <span class="n">user_id</span><span class="o">=</span><span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>  <span class="c1"># Set the current user as the owner</span>
        <span class="o">**</span><span class="n">room_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># Insert the room into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">r_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">room_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Room with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">RoomResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">room_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.room_routes.delete_room" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">room_routes</span><span class="o">.</span><span class="n">delete_room</span><span class="p">(</span><span class="n">room_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a room.
Users can only delete their own rooms, while admins can delete any room.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/room_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{room_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_room</span><span class="p">(</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a room.</span>
<span class="sd">    Users can only delete their own rooms, while admins can delete any room.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the room to delete</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">room</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Room with ID </span><span class="si">{</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the room owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this room&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete room&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.room_routes.get_all_rooms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">room_routes</span><span class="o">.</span><span class="n">get_all_rooms</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">home_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">floor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all rooms with optional filtering.
Admin users can see all rooms, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/room_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">RoomResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_rooms</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">home_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">floor</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">RoomResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all rooms with optional filtering.</span>
<span class="sd">    Admin users can see all rooms, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own rooms</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">home_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;home_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">home_id</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">floor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;floor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">floor</span>
    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">rooms</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to RoomResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">RoomResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">room</span><span class="p">)</span> <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">rooms</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.room_routes.get_room" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">room_routes</span><span class="o">.</span><span class="n">get_room</span><span class="p">(</span><span class="n">room_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single room by ID.
Users can only access their own rooms, while admins can access any room.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/room_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{room_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">RoomResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_room</span><span class="p">(</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single room by ID.</span>
<span class="sd">    Users can only access their own rooms, while admins can access any room.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the room</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">room</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Room with ID </span><span class="si">{</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the room owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this room&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">RoomResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.room_routes.update_room" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">room_routes</span><span class="o">.</span><span class="n">update_room</span><span class="p">(</span><span class="n">room_id</span><span class="p">,</span> <span class="n">room_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a room's information.
Users can only update their own rooms, while admins can update any room.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/room_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{room_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">RoomResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_room</span><span class="p">(</span>
    <span class="n">room_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">room_update</span><span class="p">:</span> <span class="n">RoomUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a room&#39;s information.</span>
<span class="sd">    Users can only update their own rooms, while admins can update any room.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the room to update</span>
    <span class="n">room</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">room</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Room with ID </span><span class="si">{</span><span class="n">room_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the room owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this room&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">room_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Room data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate ID&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated room</span>
    <span class="n">updated_room</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">RoomResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_room</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.suggestion_routes" class="doc doc-heading">
            <code>app.routes.suggestion_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Suggestion management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.suggestion_routes.create_suggestion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">suggestion_routes</span><span class="o">.</span><span class="n">create_suggestion</span><span class="p">(</span><span class="n">suggestion_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new suggestion.
Users can only create suggestions for themselves, while admins can create suggestions for any user.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/suggestion_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">SuggestionResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_suggestion</span><span class="p">(</span>
    <span class="n">suggestion_create</span><span class="p">:</span> <span class="n">CreateSuggestion</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new suggestion.</span>
<span class="sd">    Users can only create suggestions for themselves, while admins can create suggestions for any user.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the suggestion owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">suggestion_create</span><span class="o">.</span><span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create suggestion for another user&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new SuggestionDB model</span>
    <span class="n">suggestion_db</span> <span class="o">=</span> <span class="n">SuggestionDB</span><span class="p">(</span><span class="o">**</span><span class="n">suggestion_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the suggestion into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">suggestion_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Suggestion with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">SuggestionResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">suggestion_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.suggestion_routes.delete_suggestion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">suggestion_routes</span><span class="o">.</span><span class="n">delete_suggestion</span><span class="p">(</span><span class="n">suggestion_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a suggestion.
Users can only delete their own suggestions, while admins can delete any suggestion.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/suggestion_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{suggestion_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_suggestion</span><span class="p">(</span>
    <span class="n">suggestion_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a suggestion.</span>
<span class="sd">    Users can only delete their own suggestions, while admins can delete any suggestion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the suggestion to delete</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestion</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Suggestion with ID </span><span class="si">{</span><span class="n">suggestion_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the suggestion owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">suggestion</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this suggestion&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete suggestion&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.suggestion_routes.get_all_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">suggestion_routes</span><span class="o">.</span><span class="n">get_all_suggestions</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">user_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">from_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">to_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all suggestions.
Admin users can see all suggestions, while regular users can only see their own.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/suggestion_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">SuggestionResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_suggestions</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SuggestionStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SuggestionType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">priority</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">from_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">to_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">SuggestionResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all suggestions.</span>
<span class="sd">    Admin users can see all suggestions, while regular users can only see their own.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># Non-admin users can only access their own suggestions</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_id</span>
    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">type</span>
    <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">priority</span>

    <span class="c1"># Date range filtering</span>
    <span class="k">if</span> <span class="n">from_date</span> <span class="ow">or</span> <span class="n">to_date</span><span class="p">:</span>
        <span class="n">date_query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">from_date</span><span class="p">:</span>
            <span class="n">date_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_date</span>
        <span class="k">if</span> <span class="n">to_date</span><span class="p">:</span>
            <span class="n">date_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_date</span>
        <span class="k">if</span> <span class="n">date_query</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date_query</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to SuggestionResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">SuggestionResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span> <span class="k">for</span> <span class="n">suggestion</span> <span class="ow">in</span> <span class="n">suggestions</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.suggestion_routes.get_suggestion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">suggestion_routes</span><span class="o">.</span><span class="n">get_suggestion</span><span class="p">(</span><span class="n">suggestion_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single suggestion by ID.
Users can only access their own suggestions, while admins can access any suggestion.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/suggestion_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{suggestion_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">SuggestionResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_suggestion</span><span class="p">(</span>
    <span class="n">suggestion_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single suggestion by ID.</span>
<span class="sd">    Users can only access their own suggestions, while admins can access any suggestion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the suggestion</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestion</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Suggestion with ID </span><span class="si">{</span><span class="n">suggestion_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the suggestion owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">suggestion</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this suggestion&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">SuggestionResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.suggestion_routes.update_suggestion" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">suggestion_routes</span><span class="o">.</span><span class="n">update_suggestion</span><span class="p">(</span><span class="n">suggestion_id</span><span class="p">,</span> <span class="n">suggestion_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a suggestion's information.
Users can only update their own suggestions, while admins can update any suggestion.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/suggestion_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{suggestion_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">SuggestionResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_suggestion</span><span class="p">(</span>
    <span class="n">suggestion_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">suggestion_update</span><span class="p">:</span> <span class="n">SuggestionUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a suggestion&#39;s information.</span>
<span class="sd">    Users can only update their own suggestions, while admins can update any suggestion.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the suggestion to update</span>
    <span class="n">suggestion</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">suggestion</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Suggestion with ID </span><span class="si">{</span><span class="n">suggestion_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check if the requesting user is the suggestion owner or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">suggestion</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this suggestion&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">suggestion_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Update implemented_date if status is changed to IMPLEMENTED</span>
    <span class="k">if</span> <span class="n">suggestion_update</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">SuggestionStatus</span><span class="o">.</span><span class="n">IMPLEMENTED</span><span class="p">:</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;implemented_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Suggestion data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated suggestion</span>
    <span class="n">updated_suggestion</span> <span class="o">=</span> <span class="n">s_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">suggestion_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">SuggestionResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_suggestion</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.usage_routes" class="doc doc-heading">
            <code>app.routes.usage_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>Usage data management routes for the smart home system.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.check_device_ownership" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">check_device_ownership</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if a user owns a device.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_device_ownership</span><span class="p">(</span><span class="n">device_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a user owns a device.&quot;&quot;&quot;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;user_id&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">user_id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.create_bulk_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">create_bulk_usage</span><span class="p">(</span><span class="n">bulk_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create multiple usage records at once.
Users can only create records for their own devices, while admins can create for any device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bulk_create</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.usage.UsageBulkCreate" href="#app.models.usage.UsageBulkCreate">UsageBulkCreate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of usage records to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[UsageResponse]: The newly created usage records</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/bulk&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">UsageResponse</span><span class="p">],</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_bulk_usage</span><span class="p">(</span>
    <span class="n">bulk_create</span><span class="p">:</span> <span class="n">UsageBulkCreate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create multiple usage records at once.</span>
<span class="sd">    Users can only create records for their own devices, while admins can create for any device.</span>

<span class="sd">    Args:</span>
<span class="sd">        bulk_create: List of usage records to create</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[UsageResponse]: The newly created usage records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">bulk_create</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
            <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Not authorized to create usage data for device </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">device_id</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="n">created_records</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">bulk_create</span><span class="o">.</span><span class="n">records</span><span class="p">:</span>
        <span class="c1"># Set timestamp to now if not provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">record</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
            <span class="n">record</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

        <span class="c1"># Create a new UsageDB model</span>
        <span class="n">usage_db</span> <span class="o">=</span> <span class="n">UsageDB</span><span class="p">(</span><span class="o">**</span><span class="n">record</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

        <span class="c1"># Insert the usage record into the database</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">us_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">usage_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
            <span class="n">created_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">usage_db</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="c1"># Continue with other records if one fails</span>
            <span class="k">continue</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">created_records</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to create any usage records&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">UsageResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">created_records</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.create_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">create_usage</span><span class="p">(</span><span class="n">usage_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new usage record.
Users can only create records for their own devices, while admins can create for any device.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>usage_create</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.usage.CreateUsage" href="#app.models.usage.CreateUsage">CreateUsage</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data for the new usage record</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>UsageResponse</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The newly created usage record</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UsageResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_usage</span><span class="p">(</span>
    <span class="n">usage_create</span><span class="p">:</span> <span class="n">CreateUsage</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new usage record.</span>
<span class="sd">    Users can only create records for their own devices, while admins can create for any device.</span>

<span class="sd">    Args:</span>
<span class="sd">        usage_create: Data for the new usage record</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        UsageResponse: The newly created usage record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">usage_create</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to create usage data for this device&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Set timestamp to now if not provided</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">usage_create</span><span class="o">.</span><span class="n">timestamp</span><span class="p">:</span>
        <span class="n">usage_create</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Create a new UsageDB model</span>
    <span class="n">usage_db</span> <span class="o">=</span> <span class="n">UsageDB</span><span class="p">(</span><span class="o">**</span><span class="n">usage_create</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>

    <span class="c1"># Insert the usage record into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">us_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">usage_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Usage record with this ID already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">UsageResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">usage_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.delete_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">delete_usage</span><span class="p">(</span><span class="n">usage_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a usage record.
Users can only delete records for their own devices, while admins can delete any record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>usage_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the usage record to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Response</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>204 No Content on success</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{usage_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_usage</span><span class="p">(</span>
    <span class="n">usage_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a usage record.</span>
<span class="sd">    Users can only delete records for their own devices, while admins can delete any record.</span>

<span class="sd">    Args:</span>
<span class="sd">        usage_id: The ID of the usage record to delete</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        Response: 204 No Content on success</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the usage record to delete</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">usage</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Usage record with ID </span><span class="si">{</span><span class="n">usage_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">usage</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to delete this usage record&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete usage record&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Return a proper 204 No Content response with no body</span>
    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.get_all_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">get_all_usage</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">limit</span><span class="o">=</span><span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">device_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_time</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_energy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="s1">&#39;timestamp_desc&#39;</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all usage records.
Admin users can see all records, while regular users can only see records for their devices.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>skip</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of records to skip (pagination)</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Query">Query</span>(0, ge=0)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of records to return (pagination)</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Query">Query</span>(100, ge=1, le=1000)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device_id</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by device ID</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_time</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by records after this time</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_time</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="datetime.datetime">datetime</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by records before this time</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by device status</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>min_energy</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by minimum energy consumed</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_energy</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Filter by maximum energy consumed</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sort</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sorting method for results</p>
              </div>
            </td>
            <td>
                  <code>&#39;timestamp_desc&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<a class="autorefs autorefs-internal" title="app.models.usage.UsageResponse" href="#app.models.usage.UsageResponse">UsageResponse</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[UsageResponse]: List of usage records</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">UsageResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_usage</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="n">ge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">le</span><span class="o">=</span><span class="mi">1000</span><span class="p">),</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">device_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_time</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">datetime</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">min_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">max_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">sort</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;timestamp_desc&quot;</span>  <span class="c1"># Options: timestamp_asc, timestamp_desc, energy_asc, energy_desc</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UsageResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all usage records.</span>
<span class="sd">    Admin users can see all records, while regular users can only see records for their devices.</span>

<span class="sd">    Args:</span>
<span class="sd">        skip: Number of records to skip (pagination)</span>
<span class="sd">        limit: Maximum number of records to return (pagination)</span>
<span class="sd">        current_user: The authenticated user</span>
<span class="sd">        device_id: Filter by device ID</span>
<span class="sd">        start_time: Filter by records after this time</span>
<span class="sd">        end_time: Filter by records before this time</span>
<span class="sd">        status: Filter by device status</span>
<span class="sd">        min_energy: Filter by minimum energy consumed</span>
<span class="sd">        max_energy: Filter by maximum energy consumed</span>
<span class="sd">        sort: Sorting method for results</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[UsageResponse]: List of usage records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">device_id</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_id</span>

        <span class="c1"># Check device ownership for regular users</span>
        <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
            <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this device&#39;s data&quot;</span>
                <span class="p">)</span>
    <span class="k">elif</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="c1"># For non-admin users without a specific device_id, find all their devices</span>
        <span class="n">user_devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">}))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># User has no devices, return empty list</span>

        <span class="n">device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">]</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}</span>

    <span class="c1"># Add time range filter if provided</span>
    <span class="k">if</span> <span class="n">start_time</span> <span class="ow">or</span> <span class="n">end_time</span><span class="p">:</span>
        <span class="n">time_query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">start_time</span><span class="p">:</span>
            <span class="n">time_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_time</span>
        <span class="k">if</span> <span class="n">end_time</span><span class="p">:</span>
            <span class="n">time_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_time</span>
        <span class="k">if</span> <span class="n">time_query</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_query</span>

    <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>

    <span class="c1"># Add energy consumption filter if provided</span>
    <span class="k">if</span> <span class="n">min_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">max_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">energy_query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">min_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">energy_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_energy</span>
        <span class="k">if</span> <span class="n">max_energy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">energy_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_energy</span>
        <span class="k">if</span> <span class="n">energy_query</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energy_query</span>

    <span class="c1"># Determine sort order</span>
    <span class="n">sort_field</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span>
    <span class="n">sort_direction</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Default to newest first</span>

    <span class="k">if</span> <span class="n">sort</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;timestamp_asc&quot;</span><span class="p">:</span>
            <span class="n">sort_field</span><span class="p">,</span> <span class="n">sort_direction</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;timestamp_desc&quot;</span><span class="p">:</span>
            <span class="n">sort_field</span><span class="p">,</span> <span class="n">sort_direction</span> <span class="o">=</span> <span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;energy_asc&quot;</span><span class="p">:</span>
            <span class="n">sort_field</span><span class="p">,</span> <span class="n">sort_direction</span> <span class="o">=</span> <span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">sort</span> <span class="o">==</span> <span class="s2">&quot;energy_desc&quot;</span><span class="p">:</span>
            <span class="n">sort_field</span><span class="p">,</span> <span class="n">sort_direction</span> <span class="o">=</span> <span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># Convert cursor to list</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sort_field</span><span class="p">,</span> <span class="n">sort_direction</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="n">usage_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="c1"># Convert to UsageResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">UsageResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">record</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">usage_records</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.get_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">get_usage</span><span class="p">(</span><span class="n">usage_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single usage record by ID.
Users can only access usage data for their own devices, while admins can access any record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>usage_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the usage record to get</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>UsageResponse</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The requested usage record</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{usage_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UsageResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_usage</span><span class="p">(</span>
    <span class="n">usage_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single usage record by ID.</span>
<span class="sd">    Users can only access usage data for their own devices, while admins can access any record.</span>

<span class="sd">    Args:</span>
<span class="sd">        usage_id: The ID of the usage record to get</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        UsageResponse: The requested usage record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get the usage record</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">usage</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Usage record with ID </span><span class="si">{</span><span class="n">usage_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">usage</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this usage record&quot;</span>
            <span class="p">)</span>

    <span class="k">return</span> <span class="n">UsageResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.get_usage_aggregate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">get_usage_aggregate</span><span class="p">(</span><span class="n">time_range</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get aggregated usage statistics for a specified time range and device.
Users can only access data for their own devices, while admins can access any data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>time_range</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.usage.UsageTimeRange" href="#app.models.usage.UsageTimeRange">UsageTimeRange</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Object containing start_time, end_time, and device_id</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>UsageAggregateResponse</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Aggregated usage statistics</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/aggregate/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UsageAggregateResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_usage_aggregate</span><span class="p">(</span>
    <span class="n">time_range</span><span class="p">:</span> <span class="n">UsageTimeRange</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get aggregated usage statistics for a specified time range and device.</span>
<span class="sd">    Users can only access data for their own devices, while admins can access any data.</span>

<span class="sd">    Args:</span>
<span class="sd">        time_range: Object containing start_time, end_time, and device_id</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        UsageAggregateResponse: Aggregated usage statistics</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TimeRange validator already checks that end_time is after start_time</span>

    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">time_range</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this device&#39;s data&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">time_range</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;$gte&quot;</span><span class="p">:</span> <span class="n">time_range</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
            <span class="s2">&quot;$lte&quot;</span><span class="p">:</span> <span class="n">time_range</span><span class="o">.</span><span class="n">end_time</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1"># Get all usage records for the specified time range and device</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">usage_records</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">usage_records</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;No usage records found for the specified criteria&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Initialize aggregation results</span>
    <span class="n">total_duration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total_energy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">usage_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">usage_records</span><span class="p">)</span>

    <span class="c1"># Collect numeric metrics for averaging</span>
    <span class="n">metric_sums</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">metric_counts</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">usage_records</span><span class="p">:</span>
        <span class="c1"># Sum duration and energy</span>
        <span class="k">if</span> <span class="s2">&quot;duration&quot;</span> <span class="ow">in</span> <span class="n">record</span> <span class="ow">and</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]:</span>
            <span class="n">total_duration</span> <span class="o">+=</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;energy_consumed&quot;</span> <span class="ow">in</span> <span class="n">record</span> <span class="ow">and</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]:</span>
            <span class="n">total_energy</span> <span class="o">+=</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">]</span>

        <span class="c1"># Collect metrics for averaging</span>
        <span class="k">if</span> <span class="s2">&quot;metrics&quot;</span> <span class="ow">in</span> <span class="n">record</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">record</span><span class="p">[</span><span class="s2">&quot;metrics&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>  <span class="c1"># Only average numeric metrics</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metric_sums</span><span class="p">:</span>
                        <span class="n">metric_sums</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="n">metric_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="n">metric_sums</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
                    <span class="n">metric_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># Calculate average metrics</span>
    <span class="n">average_metrics</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metric_sums</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">metric_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">average_metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">metric_sums</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">/</span> <span class="n">metric_counts</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="c1"># Create the aggregated response</span>
    <span class="n">aggregated_data</span> <span class="o">=</span> <span class="n">UsageAggregateResponse</span><span class="p">(</span>
        <span class="n">device_id</span><span class="o">=</span><span class="n">time_range</span><span class="o">.</span><span class="n">device_id</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">time_range</span><span class="o">.</span><span class="n">start_time</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">time_range</span><span class="o">.</span><span class="n">end_time</span><span class="p">,</span>
        <span class="n">total_duration</span><span class="o">=</span><span class="n">total_duration</span><span class="p">,</span>
        <span class="n">total_energy</span><span class="o">=</span><span class="n">total_energy</span><span class="p">,</span>
        <span class="n">average_metrics</span><span class="o">=</span><span class="n">average_metrics</span><span class="p">,</span>
        <span class="n">usage_count</span><span class="o">=</span><span class="n">usage_count</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">aggregated_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.usage_routes.update_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">usage_routes</span><span class="o">.</span><span class="n">update_usage</span><span class="p">(</span><span class="n">usage_id</span><span class="p">,</span> <span class="n">usage_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a usage record's information.
Users can only update records for their own devices, while admins can update any record.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>usage_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the usage record to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>usage_update</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.usage.UsageUpdate" href="#app.models.usage.UsageUpdate">UsageUpdate</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_user</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.user.UserDB" href="#app.models.user.UserDB">UserDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The authenticated user</p>
              </div>
            </td>
            <td>
                  <code><span title="fastapi.Depends">Depends</span>(<a class="autorefs autorefs-internal" title="app.core.auth.get_current_user(credentials=Depends(security))

  
      async
   (app.core.auth.get_current_user)" href="#app.core.auth.get_current_user">get_current_user</a>)</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>UsageResponse</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The updated usage record</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/routes/usage_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{usage_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UsageResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_usage</span><span class="p">(</span>
    <span class="n">usage_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">usage_update</span><span class="p">:</span> <span class="n">UsageUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a usage record&#39;s information.</span>
<span class="sd">    Users can only update records for their own devices, while admins can update any record.</span>

<span class="sd">    Args:</span>
<span class="sd">        usage_id: The ID of the usage record to update</span>
<span class="sd">        usage_update: The data to update</span>
<span class="sd">        current_user: The authenticated user</span>

<span class="sd">    Returns:</span>
<span class="sd">        UsageResponse: The updated usage record</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Find the usage record to update</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">usage</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Usage record with ID </span><span class="si">{</span><span class="n">usage_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Check device ownership for regular users</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="n">owns_device</span> <span class="o">=</span> <span class="n">check_device_ownership</span><span class="p">(</span><span class="n">usage</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">],</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">owns_device</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this usage record&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">usage_update</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">update_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># &gt; 1 to account for the updated timestamp</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Usage record data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Failed to update usage record: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated usage record</span>
    <span class="n">updated_usage</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">usage_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">UsageResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_usage</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.routes.user_routes" class="doc doc-heading">
            <code>app.routes.user_routes</code>


</h2>

    <div class="doc doc-contents first">

        <p>User management routes for the smart home system with debug prints.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.routes.user_routes.create_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">user_routes</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">user_create</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Create a new user.
Only admin users can create new users.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/user_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UserResponse</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_201_CREATED</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_user</span><span class="p">(</span>
    <span class="n">user_create</span><span class="p">:</span> <span class="n">CreateUser</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a new user.</span>
<span class="sd">    Only admin users can create new users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Debug print</span>
    <span class="c1"># print(f&quot;DEBUG: create_user called with username={user_create.username}, u_c={u_c}&quot;)</span>

    <span class="c1"># Verify admin role</span>
    <span class="n">verify_role</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">)</span>

    <span class="c1"># Check if username or email already exists</span>
    <span class="n">username_exists</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user_create</span><span class="o">.</span><span class="n">username</span><span class="p">})</span>
    <span class="c1"># print(f&quot;DEBUG: username_exists={username_exists}&quot;)</span>

    <span class="k">if</span> <span class="n">username_exists</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Username already exists&quot;</span>
        <span class="p">)</span>

    <span class="n">email_exists</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user_create</span><span class="o">.</span><span class="n">email</span><span class="p">})</span>
    <span class="c1"># print(f&quot;DEBUG: email_exists={email_exists}&quot;)</span>

    <span class="k">if</span> <span class="n">email_exists</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already exists&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create a new UserDB model</span>
    <span class="n">hashed_password</span> <span class="o">=</span> <span class="n">hash_password</span><span class="p">(</span><span class="n">user_create</span><span class="o">.</span><span class="n">password</span><span class="p">)</span>
    <span class="n">user_db</span> <span class="o">=</span> <span class="n">UserDB</span><span class="p">(</span>
        <span class="n">username</span><span class="o">=</span><span class="n">user_create</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="n">email</span><span class="o">=</span><span class="n">user_create</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="n">hashed_password</span><span class="o">=</span><span class="n">hashed_password</span><span class="p">,</span>
        <span class="n">role</span><span class="o">=</span><span class="n">user_create</span><span class="o">.</span><span class="n">role</span>
    <span class="p">)</span>

    <span class="c1"># Insert the user into the database</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">u_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">user_db</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
    <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User with this ID, username, or email already exists&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">UserResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user_db</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.user_routes.delete_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">user_routes</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Delete a user.
Only admin users can delete users.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/user_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_user</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a user.</span>
<span class="sd">    Only admin users can delete users.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Verify admin role</span>
    <span class="n">verify_role</span><span class="p">(</span><span class="n">current_user</span><span class="o">.</span><span class="n">role</span><span class="p">,</span> <span class="s2">&quot;admin&quot;</span><span class="p">)</span>

    <span class="c1"># Find the user to delete</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User with ID </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Perform the deletion</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_500_INTERNAL_SERVER_ERROR</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Failed to delete user&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_204_NO_CONTENT</span><span class="p">,</span> <span class="n">content</span><span class="o">=</span><span class="p">{})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.user_routes.get_all_users" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">user_routes</span><span class="o">.</span><span class="n">get_all_users</span><span class="p">(</span><span class="n">skip</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span> <span class="n">role</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get all users (admin only).</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/user_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">UserResponse</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_all_users</span><span class="p">(</span>
    <span class="n">skip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">),</span>
    <span class="n">role</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">active</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">UserResponse</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get all users (admin only).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Debug print</span>
    <span class="c1"># print(f&quot;DEBUG: get_all_users called with u_c={u_c}, id(u_c)={id(u_c)}&quot;)</span>

    <span class="c1"># Check if user is admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to view all users&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Build query filter</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">role</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;role&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">role</span>
    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">active</span>

    <span class="c1"># Debug print</span>
    <span class="c1"># print(f&quot;DEBUG: Executing find with query={query}&quot;)</span>

    <span class="c1"># Convert cursor to list explicitly</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">skip</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
    <span class="c1"># print(f&quot;DEBUG: type(cursor)={type(cursor)}, cursor={cursor}&quot;)</span>

    <span class="n">users</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>
    <span class="c1"># print(f&quot;DEBUG: users={users}, len(users)={len(users)}&quot;)</span>

    <span class="c1"># Convert to UserResponse models</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">UserResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.user_routes.get_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">user_routes</span><span class="o">.</span><span class="n">get_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get a single user by ID.
Users can only access their own data, while admins can access any user's data.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/user_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UserResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_user</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get a single user by ID.</span>
<span class="sd">    Users can only access their own data, while admins can access any user&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>    
    <span class="c1"># Debug print</span>
    <span class="c1"># print(f&quot;DEBUG: get_user called with user_id={user_id}, u_c={u_c}&quot;)</span>

    <span class="c1"># Check if the requesting user is the user being requested or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to access this user&#39;s data&quot;</span>
        <span class="p">)</span>

    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="c1"># print(f&quot;DEBUG: find_one result={user}&quot;)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User with ID </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">UserResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.routes.user_routes.update_user" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">user_routes</span><span class="o">.</span><span class="n">update_user</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">user_update</span><span class="p">,</span> <span class="n">current_user</span><span class="o">=</span><span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">))</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Update a user's information.
Users can only update their own data, while admins can update any user's data.</p>

            <details class="quote">
              <summary>Source code in <code>app/routes/user_routes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@router</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span><span class="s2">&quot;/</span><span class="si">{user_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">UserResponse</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_user</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">user_update</span><span class="p">:</span> <span class="n">UserUpdate</span><span class="p">,</span>
    <span class="n">current_user</span><span class="p">:</span> <span class="n">UserDB</span> <span class="o">=</span> <span class="n">Depends</span><span class="p">(</span><span class="n">get_current_user</span><span class="p">)</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update a user&#39;s information.</span>
<span class="sd">    Users can only update their own data, while admins can update any user&#39;s data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Check if the requesting user is the user being updated or an admin</span>
    <span class="k">if</span> <span class="n">current_user</span><span class="o">.</span><span class="n">role</span> <span class="o">!=</span> <span class="s2">&quot;admin&quot;</span> <span class="ow">and</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">user_id</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_403_FORBIDDEN</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Not authorized to update this user&#39;s data&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Find the user to update</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
            <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_404_NOT_FOUND</span><span class="p">,</span>
            <span class="n">detail</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User with ID </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Create update data dictionary with only the provided fields</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">user_update</span><span class="o">.</span><span class="n">username</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check if new username already exists (if it&#39;s different from current)</span>
        <span class="k">if</span> <span class="n">user_update</span><span class="o">.</span><span class="n">username</span> <span class="o">!=</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user_update</span><span class="o">.</span><span class="n">username</span><span class="p">}):</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Username already exists&quot;</span>
                <span class="p">)</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;username&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_update</span><span class="o">.</span><span class="n">username</span>

    <span class="k">if</span> <span class="n">user_update</span><span class="o">.</span><span class="n">email</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Check if new email already exists (if it&#39;s different from current)</span>
        <span class="k">if</span> <span class="n">user_update</span><span class="o">.</span><span class="n">email</span> <span class="o">!=</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user_update</span><span class="o">.</span><span class="n">email</span><span class="p">}):</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Email already exists&quot;</span>
                <span class="p">)</span>
        <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">user_update</span><span class="o">.</span><span class="n">email</span>

    <span class="c1"># Add updated timestamp</span>
    <span class="n">update_data</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>

    <span class="c1"># Perform the update if there&#39;s data to update</span>
    <span class="k">if</span> <span class="n">update_data</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">},</span>
                <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                    <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_304_NOT_MODIFIED</span><span class="p">,</span>
                    <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;User data not modified&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">DuplicateKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">HTTPException</span><span class="p">(</span>
                <span class="n">status_code</span><span class="o">=</span><span class="n">status</span><span class="o">.</span><span class="n">HTTP_400_BAD_REQUEST</span><span class="p">,</span>
                <span class="n">detail</span><span class="o">=</span><span class="s2">&quot;Update would create a duplicate username or email&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Retrieve and return the updated user</span>
    <span class="n">updated_user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">UserResponse</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">updated_user</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.seeds.seed_database" class="doc doc-heading">
            <code>app.seeds.seed_database</code>


</h2>

    <div class="doc doc-contents first">

        <p>Database seeding script for Smart Home Automation platform.
This script populates the MongoDB collections with realistic data.</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.clear_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">clear_collections</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Clear all collections to start fresh.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">clear_collections</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clear all collections to start fresh.&quot;&quot;&quot;</span>
    <span class="n">collections</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">user_collection</span><span class="p">,</span> <span class="n">profile_collection</span><span class="p">,</span> <span class="n">device_collection</span><span class="p">,</span> <span class="n">room_collection</span><span class="p">,</span> 
        <span class="n">usage_collection</span><span class="p">,</span> <span class="n">automation_collection</span><span class="p">,</span> <span class="n">notification_collection</span><span class="p">,</span> 
        <span class="n">access_management_collection</span><span class="p">,</span> <span class="n">goal_collection</span><span class="p">,</span> <span class="n">analytics_collection</span><span class="p">,</span> 
        <span class="n">suggestion_collection</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">collection</span> <span class="ow">in</span> <span class="n">collections</span><span class="p">:</span>
        <span class="n">collection</span><span class="o">.</span><span class="n">delete_many</span><span class="p">({})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All collections cleared.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_access_management" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_access_management</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create access management entries for sharing resources.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_access_management</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create access management entries for sharing resources.&quot;&quot;&quot;</span>
    <span class="n">access_entries</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># For each user who has devices</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">user_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Determine if this user shares devices (40% chance)</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
            <span class="c1"># Find possible recipients (other users)</span>
            <span class="n">other_users</span> <span class="o">=</span> <span class="p">[</span><span class="n">u</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">users</span> <span class="k">if</span> <span class="n">u</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">other_users</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Determine how many devices to share (1-3)</span>
            <span class="n">num_shares</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_devices</span><span class="p">)))</span>

            <span class="c1"># Select devices to share</span>
            <span class="n">devices_to_share</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">user_devices</span><span class="p">,</span> <span class="n">num_shares</span><span class="p">)</span>

            <span class="c1"># For each device, create sharing</span>
            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices_to_share</span><span class="p">:</span>
                <span class="c1"># Choose 1-3 users to share with</span>
                <span class="n">share_recipients</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">other_users</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_users</span><span class="p">))))</span>

                <span class="c1"># Determine access level</span>
                <span class="n">access_level</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;control&quot;</span><span class="p">,</span> <span class="s2">&quot;manage&quot;</span><span class="p">])</span>

                <span class="c1"># Determine if there&#39;s an expiration (30% chance)</span>
                <span class="n">expires_at</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                    <span class="c1"># Expire 1-30 days from now</span>
                    <span class="n">expires_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span>

                <span class="c1"># Create note (50% chance)</span>
                <span class="n">note</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="n">note_templates</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="sa">f</span><span class="s2">&quot;Sharing </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> with family&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Temporary access for house sitting&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Guest access to </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Please don&#39;t change the settings&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Access for the weekend&quot;</span>
                    <span class="p">]</span>
                    <span class="n">note</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">note_templates</span><span class="p">)</span>

                <span class="c1"># Create access entry for each recipient</span>
                <span class="k">for</span> <span class="n">recipient</span> <span class="ow">in</span> <span class="n">share_recipients</span><span class="p">:</span>
                    <span class="n">access_entry</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                        <span class="s2">&quot;owner_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;resource_id&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;resource_type&quot;</span><span class="p">:</span> <span class="s2">&quot;device&quot;</span><span class="p">,</span>  <span class="c1"># Simplified - could also be room, home, etc.</span>
                        <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">recipient</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;access_level&quot;</span><span class="p">:</span> <span class="n">access_level</span><span class="p">,</span>
                        <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">random_date</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span>
                        <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;expires_at&quot;</span><span class="p">:</span> <span class="n">expires_at</span><span class="p">,</span>
                        <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                        <span class="s2">&quot;note&quot;</span><span class="p">:</span> <span class="n">note</span>
                    <span class="p">}</span>

                    <span class="c1"># 30% chance of update</span>
                    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                        <span class="n">access_entry</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">access_entry</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

                    <span class="n">access_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">access_entry</span><span class="p">)</span>
                    <span class="n">access_management_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">access_entry</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">access_entries</span><span class="p">)</span><span class="si">}</span><span class="s2"> access management entries&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">access_entries</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_analytics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_analytics</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create analytics data for devices.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_analytics</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create analytics data for devices.&quot;&quot;&quot;</span>
    <span class="n">analytics_entries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">data_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">,</span> <span class="s2">&quot;motion&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="c1"># Skip offline devices</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;offline&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Determine appropriate data types for this device</span>
        <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;light&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;thermostat&quot;</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;humidity&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;lock&quot;</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;camera&quot;</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">,</span> <span class="s2">&quot;motion&quot;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sensor&quot;</span><span class="p">:</span>
            <span class="c1"># Determine sensor type from name</span>
            <span class="n">sensor_type</span> <span class="o">=</span> <span class="s2">&quot;motion&quot;</span>  <span class="c1"># default</span>
            <span class="k">if</span> <span class="s2">&quot;temperature&quot;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;humidity&quot;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;motion&quot;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;motion&quot;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="s2">&quot;light&quot;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;light&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">data_types</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;outlet&quot;</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">applicable_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">]</span>

        <span class="c1"># Determine number of analytics entries (1-20)</span>
        <span class="n">num_entries</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_entries</span><span class="p">):</span>
            <span class="c1"># Choose data type</span>
            <span class="n">data_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">applicable_types</span><span class="p">)</span>

            <span class="c1"># Generate metrics based on data type</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;consumption&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">3</span><span class="p">),</span>  <span class="c1"># kWh</span>
                    <span class="s2">&quot;cost&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span>  <span class="c1"># $</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1440</span><span class="p">)</span>  <span class="c1"># minutes</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;usage&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">480</span><span class="p">),</span>  <span class="c1"># minutes</span>
                    <span class="s2">&quot;interactions&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span>
                    <span class="s2">&quot;active_time&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># minutes</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># Celsius</span>
                    <span class="s2">&quot;setpoint&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># Celsius</span>
                    <span class="s2">&quot;outside_temp&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">35</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Celsius</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;humidity&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">70</span><span class="p">),</span>  <span class="c1"># Percent</span>
                    <span class="s2">&quot;comfort_zone&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;optimal&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">])</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;motion&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;detected&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">,</span>
                    <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span> <span class="k">if</span> <span class="n">metrics</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detected&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;peak_time&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;00&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;45&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Percent</span>
                    <span class="s2">&quot;color_temp&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6500</span><span class="p">),</span>  <span class="c1"># Kelvin</span>
                    <span class="s2">&quot;is_natural&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
                <span class="p">}</span>

            <span class="c1"># Generate tags</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>  <span class="c1"># 60% have tags</span>
                <span class="n">possible_tags</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span> <span class="s2">&quot;weekly&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span> <span class="s2">&quot;peak&quot;</span><span class="p">,</span> <span class="s2">&quot;off-peak&quot;</span><span class="p">,</span> <span class="s2">&quot;weekend&quot;</span><span class="p">,</span> <span class="s2">&quot;weekday&quot;</span><span class="p">]</span>
                <span class="n">num_tags</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
                <span class="n">tags</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">possible_tags</span><span class="p">,</span> <span class="n">num_tags</span><span class="p">)</span>

            <span class="c1"># Create analytics entry</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">random_datetime</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>
            <span class="n">analytics_entry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;data_type&quot;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">,</span>
                <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="n">tags</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

            <span class="c1"># 20% chance of update</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
                <span class="n">analytics_entry</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>

            <span class="n">analytics_entries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">analytics_entry</span><span class="p">)</span>
            <span class="n">analytics_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">analytics_entry</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">analytics_entries</span><span class="p">)</span><span class="si">}</span><span class="s2"> analytics entries&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">analytics_entries</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_automations" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_automations</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create automations for users' devices.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_automations</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create automations for users&#39; devices.&quot;&quot;&quot;</span>
    <span class="n">automations</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Map users to their devices</span>
    <span class="n">user_devices</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="n">user_devices</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">user_devices</span><span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

    <span class="n">trigger_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;sensor&quot;</span><span class="p">,</span> <span class="s2">&quot;manual&quot;</span><span class="p">,</span> <span class="s2">&quot;device_state&quot;</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="s2">&quot;weather&quot;</span><span class="p">]</span>
    <span class="n">action_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;device_control&quot;</span><span class="p">,</span> <span class="s2">&quot;notification&quot;</span><span class="p">,</span> <span class="s2">&quot;scene_activation&quot;</span><span class="p">,</span> <span class="s2">&quot;energy_management&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Determine number of automations (2-8)</span>
        <span class="n">num_automations</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_automations</span><span class="p">):</span>
            <span class="c1"># Select trigger type</span>
            <span class="n">trigger_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">trigger_types</span><span class="p">)</span>

            <span class="c1"># Select action type</span>
            <span class="n">action_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">action_types</span><span class="p">)</span>

            <span class="c1"># Select a device from user&#39;s devices</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])</span>

            <span class="c1"># Generate trigger data based on type</span>
            <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">23</span><span class="p">)</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;00&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;15&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;30&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;45&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;days&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">([</span><span class="s2">&quot;mon&quot;</span><span class="p">,</span> <span class="s2">&quot;tue&quot;</span><span class="p">,</span> <span class="s2">&quot;wed&quot;</span><span class="p">,</span> <span class="s2">&quot;thu&quot;</span><span class="p">,</span> <span class="s2">&quot;fri&quot;</span><span class="p">,</span> <span class="s2">&quot;sat&quot;</span><span class="p">,</span> <span class="s2">&quot;sun&quot;</span><span class="p">],</span> 
                                         <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;sensor&quot;</span><span class="p">:</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;sensor_id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;motion_detected&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature_above&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature_below&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;threshold&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;temperature&quot;</span> <span class="ow">in</span> <span class="n">trigger_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;condition&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;device_state&quot;</span><span class="p">:</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;on&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">,</span> <span class="s2">&quot;locked&quot;</span><span class="p">,</span> <span class="s2">&quot;unlocked&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;for_duration&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;arriving&quot;</span><span class="p">,</span> <span class="s2">&quot;leaving&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;user_ids&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;weather&quot;</span><span class="p">:</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;condition&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;sunny&quot;</span><span class="p">,</span> <span class="s2">&quot;rainy&quot;</span><span class="p">,</span> <span class="s2">&quot;cloudy&quot;</span><span class="p">,</span> <span class="s2">&quot;snowy&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;temperature_above&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">&quot;temperature_below&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># manual</span>
                <span class="n">trigger_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;button_press&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;single&quot;</span><span class="p">,</span> <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="s2">&quot;long&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="p">}</span>

            <span class="c1"># Generate action data based on type</span>
            <span class="n">action_data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;device_control&quot;</span><span class="p">:</span>
                <span class="n">target_device</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])</span>
                <span class="k">if</span> <span class="n">target_device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                    <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">target_device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;turn_on&quot;</span><span class="p">,</span> <span class="s2">&quot;turn_off&quot;</span><span class="p">,</span> <span class="s2">&quot;toggle&quot;</span><span class="p">,</span> <span class="s2">&quot;dim&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;dim&quot;</span> <span class="ow">in</span> <span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">}</span>
                <span class="k">elif</span> <span class="n">target_device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;thermostat&quot;</span><span class="p">:</span>
                    <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">target_device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;set_temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;set_mode&quot;</span><span class="p">]),</span>
                        <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span> <span class="k">if</span> <span class="s2">&quot;temperature&quot;</span> <span class="ow">in</span> <span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;heat&quot;</span><span class="p">,</span> <span class="s2">&quot;cool&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="s2">&quot;mode&quot;</span> <span class="ow">in</span> <span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;action&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">target_device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;turn_on&quot;</span><span class="p">,</span> <span class="s2">&quot;turn_off&quot;</span><span class="p">,</span> <span class="s2">&quot;toggle&quot;</span><span class="p">])</span>
                    <span class="p">}</span>
            <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;notification&quot;</span><span class="p">:</span>
                <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
                        <span class="s2">&quot;Home Alert&quot;</span><span class="p">,</span> <span class="s2">&quot;Device Status&quot;</span><span class="p">,</span> <span class="s2">&quot;Automation Triggered&quot;</span><span class="p">,</span> 
                        <span class="s2">&quot;Security Alert&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy Notification&quot;</span>
                    <span class="p">]),</span>
                    <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
                        <span class="s2">&quot;Your automation was triggered&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;Device </span><span class="si">{</span><span class="n">device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> has changed state&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Motion detected in your home&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Temperature threshold reached&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Someone has arrived home&quot;</span>
                    <span class="p">]),</span>
                    <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">])</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;scene_activation&quot;</span><span class="p">:</span>
                <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;scene_name&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span>
                        <span class="s2">&quot;Good Morning&quot;</span><span class="p">,</span> <span class="s2">&quot;Good Night&quot;</span><span class="p">,</span> <span class="s2">&quot;Movie Time&quot;</span><span class="p">,</span> <span class="s2">&quot;Dinner Mode&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Away Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Welcome Home&quot;</span><span class="p">,</span> <span class="s2">&quot;Party Mode&quot;</span><span class="p">,</span> <span class="s2">&quot;Reading Time&quot;</span>
                    <span class="p">])</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">action_type</span> <span class="o">==</span> <span class="s2">&quot;energy_management&quot;</span><span class="p">:</span>
                <span class="n">action_data</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;action&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;eco_mode&quot;</span><span class="p">,</span> <span class="s2">&quot;power_saving&quot;</span><span class="p">,</span> <span class="s2">&quot;schedule_adjustment&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
                        <span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]],</span> 
                        <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_devices</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]])))</span>
                    <span class="p">)]</span>
                <span class="p">}</span>

            <span class="c1"># Create name and description</span>
            <span class="k">if</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trigger_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;00:00&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">action_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;scene_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">action_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;sensor&quot;</span><span class="p">:</span>
                <span class="n">sensor_device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">trigger_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;sensor_id&quot;</span><span class="p">)),</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;When </span><span class="si">{</span><span class="n">sensor_device</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">sensor_device</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;sensor&#39;</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">trigger_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">elif</span> <span class="n">trigger_type</span> <span class="o">==</span> <span class="s2">&quot;location&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;When </span><span class="si">{</span><span class="n">trigger_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;condition&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> home&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trigger_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="si">}</span><span class="s2"> Automation </span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Automation that triggers when </span><span class="si">{</span><span class="n">trigger_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> and performs </span><span class="si">{</span><span class="n">action_type</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Create automation - use safe date range</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">created_date</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">end_date</span><span class="p">)</span>
            <span class="n">automation</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;enabled&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># 80% enabled</span>
                <span class="s2">&quot;trigger_type&quot;</span><span class="p">:</span> <span class="n">trigger_type</span><span class="p">,</span>
                <span class="s2">&quot;trigger_data&quot;</span><span class="p">:</span> <span class="n">trigger_data</span><span class="p">,</span>
                <span class="s2">&quot;action_type&quot;</span><span class="p">:</span> <span class="n">action_type</span><span class="p">,</span>
                <span class="s2">&quot;action_data&quot;</span><span class="p">:</span> <span class="n">action_data</span><span class="p">,</span>
                <span class="s2">&quot;conditions&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Simplified for now</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">created_date</span><span class="p">,</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">random_date</span><span class="p">(</span><span class="n">created_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;last_triggered&quot;</span><span class="p">:</span> <span class="n">random_date</span><span class="p">(</span><span class="n">created_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.4</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;execution_count&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="n">automations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">automation</span><span class="p">)</span>
            <span class="n">automation_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">automation</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">automations</span><span class="p">)</span><span class="si">}</span><span class="s2"> automations&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">automations</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_devices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_devices</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">rooms</span><span class="p">,</span> <span class="n">profiles</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create devices for each user, assigned to rooms.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_devices</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">rooms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">profiles</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create devices for each user, assigned to rooms.&quot;&quot;&quot;</span>
    <span class="n">devices</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">device_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">DEVICE_CAPABILITIES</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

    <span class="c1"># Map users to their rooms</span>
    <span class="n">user_rooms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">room</span> <span class="ow">in</span> <span class="n">rooms</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_rooms</span><span class="p">:</span>
            <span class="n">user_rooms</span><span class="p">[</span><span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">user_rooms</span><span class="p">[</span><span class="n">room</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>

    <span class="c1"># Create devices for each user</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">user_rooms</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Get this user&#39;s profile</span>
        <span class="n">user_profile</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">profiles</span> <span class="k">if</span> <span class="n">p</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Find rooms for this user</span>
        <span class="n">user_room_list</span> <span class="o">=</span> <span class="n">user_rooms</span><span class="p">[</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>

        <span class="c1"># Determine how many devices this user has (between 5 and 20)</span>
        <span class="n">num_devices</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

        <span class="c1"># Create devices and assign to rooms</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_devices</span><span class="p">):</span>
            <span class="c1"># Select random device type</span>
            <span class="n">device_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">device_types</span><span class="p">)</span>

            <span class="c1"># Select manufacturer for this device type</span>
            <span class="n">manufacturer</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">DEVICE_MANUFACTURERS</span><span class="p">[</span><span class="n">device_type</span><span class="p">])</span>

            <span class="c1"># Select model for this manufacturer if available, otherwise generic</span>
            <span class="k">if</span> <span class="n">manufacturer</span> <span class="ow">in</span> <span class="n">DEVICE_MODELS</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">DEVICE_MODELS</span><span class="p">[</span><span class="n">manufacturer</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">device_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;Basic&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Pro&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Plus&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Premium&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Select capabilities for this device type</span>
            <span class="n">capabilities</span> <span class="o">=</span> <span class="n">DEVICE_CAPABILITIES</span><span class="p">[</span><span class="n">device_type</span><span class="p">]</span>

            <span class="c1"># Select a room</span>
            <span class="n">room</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_room_list</span><span class="p">)</span>

            <span class="c1"># Create device name based on type and room</span>
            <span class="k">if</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                <span class="n">name_patterns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Light&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Lamp&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Ceiling Light&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Accent Light&quot;</span>
                <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_patterns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;thermostat&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Thermostat&quot;</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;lock&quot;</span><span class="p">:</span>
                <span class="n">name_patterns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Door Lock&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Front Door Lock&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Back Door Lock&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Side Door Lock&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Garage Door Lock&quot;</span>
                <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_patterns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;camera&quot;</span><span class="p">:</span>
                <span class="n">name_patterns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Camera&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Security Camera&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Indoor Camera </span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Doorbell Camera&quot;</span>
                <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_patterns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;sensor&quot;</span><span class="p">:</span>
                <span class="n">sensor_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Motion&quot;</span><span class="p">,</span> <span class="s2">&quot;Temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;Humidity&quot;</span><span class="p">,</span> <span class="s2">&quot;Door&quot;</span><span class="p">,</span> <span class="s2">&quot;Window&quot;</span><span class="p">,</span> <span class="s2">&quot;Water Leak&quot;</span><span class="p">]</span>
                <span class="n">sensor_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">sensor_types</span><span class="p">)</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">sensor_type</span><span class="si">}</span><span class="s2"> Sensor&quot;</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;switch&quot;</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Switch&quot;</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;outlet&quot;</span><span class="p">:</span>
                <span class="n">name_patterns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Outlet&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Smart Plug&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Power Outlet&quot;</span>
                <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_patterns</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;speaker&quot;</span><span class="p">:</span>
                <span class="n">name_patterns</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Speaker&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">manufacturer</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;Smart Speaker </span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">name_patterns</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">device_type</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Random device status with weights</span>
            <span class="n">status_choices</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;online&quot;</span><span class="p">,</span> <span class="s2">&quot;offline&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;maintenance&quot;</span><span class="p">]</span>
            <span class="n">status_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">]</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">status_choices</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">status_weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Random settings based on device type</span>
            <span class="n">settings</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="s2">&quot;color_temp&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">6500</span><span class="p">),</span>
                    <span class="s2">&quot;on&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="s2">&quot;color&quot;</span> <span class="ow">in</span> <span class="n">capabilities</span><span class="p">:</span>
                    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s2">&quot;hue&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">),</span>
                        <span class="s2">&quot;saturation&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
                    <span class="p">}</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;thermostat&quot;</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;current_temp&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">26</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;target_temp&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;mode&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;heat&quot;</span><span class="p">,</span> <span class="s2">&quot;cool&quot;</span><span class="p">,</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;off&quot;</span><span class="p">]),</span>
                    <span class="s2">&quot;eco_mode&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">device_type</span> <span class="o">==</span> <span class="s2">&quot;lock&quot;</span><span class="p">:</span>
                <span class="n">settings</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;locked&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">,</span>
                    <span class="s2">&quot;auto_lock_enabled&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>
                    <span class="s2">&quot;auto_lock_timeout&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
                <span class="p">}</span>

            <span class="c1"># Generate IP and MAC for some devices</span>
            <span class="n">ip_address</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">mac_address</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># 70% have IP</span>
                <span class="n">ip_address</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">ipv4</span><span class="p">()</span>
                <span class="n">mac_address</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">)</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>

            <span class="c1"># Firmware version</span>
            <span class="n">firmware_version</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Create device</span>
            <span class="n">device_id</span> <span class="o">=</span> <span class="n">generate_uuid</span><span class="p">()</span>
            <span class="c1"># Ensure device creation date is valid (not after March 1, 2024)</span>
            <span class="n">device_created_date</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">device</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">device_type</span><span class="p">,</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;room_id&quot;</span><span class="p">:</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;ip_address&quot;</span><span class="p">:</span> <span class="n">ip_address</span><span class="p">,</span>
                <span class="s2">&quot;mac_address&quot;</span><span class="p">:</span> <span class="n">mac_address</span><span class="p">,</span>
                <span class="s2">&quot;manufacturer&quot;</span><span class="p">:</span> <span class="n">manufacturer</span><span class="p">,</span>
                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                <span class="s2">&quot;firmware_version&quot;</span><span class="p">:</span> <span class="n">firmware_version</span><span class="p">,</span>
                <span class="s2">&quot;settings&quot;</span><span class="p">:</span> <span class="n">settings</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                <span class="s2">&quot;last_online&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1440</span><span class="p">))</span> <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;offline&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">device_created_date</span><span class="p">,</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">capabilities</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">capabilities</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">capabilities</span><span class="p">))))</span>
            <span class="p">}</span>

            <span class="c1"># 40% chance device has been updated</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.6</span><span class="p">:</span>
                <span class="n">device</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

            <span class="n">devices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
            <span class="n">device_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>

            <span class="c1"># Add device to room</span>
            <span class="n">room_collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]},</span>
                <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">}}</span>
            <span class="p">)</span>

            <span class="c1"># 20% chance this device is a favorite</span>
            <span class="k">if</span> <span class="n">user_profile</span> <span class="ow">and</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">:</span>
                <span class="n">profile_collection</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]},</span>
                    <span class="p">{</span><span class="s2">&quot;$push&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;favorite_devices&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">}}</span>
                <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span><span class="si">}</span><span class="s2"> devices&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">devices</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_energy_goals" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_energy_goals</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create energy saving goals for users.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_energy_goals</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create energy saving goals for users.&quot;&quot;&quot;</span>
    <span class="n">goals</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Goal templates</span>
    <span class="n">goal_templates</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Reduce Monthly Energy Usage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Goal to reduce total energy consumption by </span><span class="si">{target_value}% c</span><span class="s2">ompared to last month.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;energy_saving&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Limit Peak Hour Consumption&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Reduce energy usage during peak hours (6-9pm) to less than </span><span class="si">{target_value}</span><span class="s2"> kWh per day.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;consumption_limit&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Lower Standby Power Usage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Reduce standby power consumption by </span><span class="si">{target_value}</span><span class="s2">% by optimizing device settings.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;usage_reduction&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Avoid Peak Demand Charges&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Keep peak demand below </span><span class="si">{target_value}</span><span class="s2"> kW to avoid extra charges on your utility bill.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;peak_avoidance&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Increase Renewable Energy Usage&quot;</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Shift </span><span class="si">{target_value}% o</span><span class="s2">f energy consumption to hours with higher renewable energy availability.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;renewable_usage&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="c1"># 60% chance user has goals</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="c1"># Get user&#39;s devices</span>
            <span class="n">user_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Determine number of goals (1-3)</span>
            <span class="n">num_goals</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_goals</span><span class="p">):</span>
                <span class="c1"># Choose template</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">goal_templates</span><span class="p">)</span>

                <span class="c1"># Determine timeframe</span>
                <span class="n">timeframe</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;daily&quot;</span><span class="p">,</span> <span class="s2">&quot;weekly&quot;</span><span class="p">,</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span> <span class="s2">&quot;yearly&quot;</span><span class="p">])</span>

                <span class="c1"># Set target value based on goal type</span>
                <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;energy_saving&quot;</span> <span class="ow">or</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;usage_reduction&quot;</span><span class="p">:</span>
                    <span class="n">target_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>  <span class="c1"># Percent reduction</span>
                <span class="k">elif</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;consumption_limit&quot;</span><span class="p">:</span>
                    <span class="n">target_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>  <span class="c1"># kWh limit</span>
                <span class="k">elif</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;peak_avoidance&quot;</span><span class="p">:</span>
                    <span class="n">target_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>  <span class="c1"># kW limit</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># renewable_usage</span>
                    <span class="n">target_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>  <span class="c1"># Percent of renewable</span>

                <span class="c1"># Fill in description</span>
                <span class="n">description</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{target_value}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_value</span><span class="p">))</span>

                <span class="c1"># Determine start date</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

                <span class="c1"># Determine end date based on timeframe</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="s2">&quot;daily&quot;</span><span class="p">:</span>
                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="s2">&quot;weekly&quot;</span><span class="p">:</span>
                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="s2">&quot;monthly&quot;</span><span class="p">:</span>
                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">timeframe</span> <span class="o">==</span> <span class="s2">&quot;yearly&quot;</span><span class="p">:</span>
                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># custom</span>
                    <span class="n">end_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">90</span><span class="p">))</span>

                <span class="c1"># Determine related devices (if any)</span>
                <span class="n">related_devices</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># 70% chance of related devices</span>
                    <span class="n">num_related</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_devices</span><span class="p">)))</span>
                    <span class="n">related_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">user_devices</span><span class="p">,</span> <span class="n">num_related</span><span class="p">)]</span>

                <span class="c1"># Determine current progress</span>
                <span class="n">current_value</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">progress_percentage</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="c1"># If goal is in the past or ongoing, set some progress</span>
                <span class="k">if</span> <span class="n">end_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="ow">or</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;energy_saving&quot;</span> <span class="ow">or</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;usage_reduction&quot;</span><span class="p">:</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">target_value</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;consumption_limit&quot;</span><span class="p">:</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">target_value</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">target_value</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;peak_avoidance&quot;</span><span class="p">:</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">target_value</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">target_value</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># renewable_usage</span>
                        <span class="n">current_value</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">target_value</span><span class="p">)</span>

                    <span class="n">progress_percentage</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nb">int</span><span class="p">((</span><span class="n">current_value</span> <span class="o">/</span> <span class="n">target_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

                <span class="c1"># Determine status</span>
                <span class="k">if</span> <span class="n">end_date</span> <span class="o">&lt;</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">progress_percentage</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;failed&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="s2">&quot;paused&quot;</span><span class="p">])</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span> <span class="k">else</span> <span class="s2">&quot;active&quot;</span>

                <span class="n">goal</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;target_value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">target_value</span><span class="p">),</span>
                    <span class="s2">&quot;current_value&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">current_value</span><span class="p">),</span>
                    <span class="s2">&quot;progress_percentage&quot;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">progress_percentage</span><span class="p">),</span>
                    <span class="s2">&quot;timeframe&quot;</span><span class="p">:</span> <span class="n">timeframe</span><span class="p">,</span>
                    <span class="s2">&quot;start_date&quot;</span><span class="p">:</span> <span class="n">start_date</span><span class="p">,</span>
                    <span class="s2">&quot;end_date&quot;</span><span class="p">:</span> <span class="n">end_date</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;related_devices&quot;</span><span class="p">:</span> <span class="n">related_devices</span><span class="p">,</span>
                    <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">start_date</span> <span class="o">-</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">)),</span>
                    <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">random_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="kc">None</span>
                <span class="p">}</span>

                <span class="n">goals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>
                <span class="n">goal_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">goal</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">goals</span><span class="p">)</span><span class="si">}</span><span class="s2"> energy goals&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">goals</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_homes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_homes</span><span class="p">(</span><span class="n">users</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create homes for users (conceptual, not in database).</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_homes</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create homes for users (conceptual, not in database).&quot;&quot;&quot;</span>
    <span class="n">homes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="c1"># Each user has 1-3 homes</span>
        <span class="n">num_homes</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_homes</span><span class="p">):</span>
            <span class="n">home_name</span> <span class="o">=</span> <span class="s2">&quot;Main Home&quot;</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">home_name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;Vacation Home&quot;</span><span class="p">,</span> <span class="s2">&quot;Beach House&quot;</span><span class="p">,</span> <span class="s2">&quot;Cabin&quot;</span><span class="p">,</span> <span class="s2">&quot;Lake House&quot;</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">home_name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;Rental Property&quot;</span><span class="p">,</span> <span class="s2">&quot;Parents&#39; House&quot;</span><span class="p">,</span> <span class="s2">&quot;Office&quot;</span><span class="p">])</span>

            <span class="n">home</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">home_name</span><span class="p">,</span>
                <span class="s2">&quot;address&quot;</span><span class="p">:</span> <span class="n">fake</span><span class="o">.</span><span class="n">address</span><span class="p">(),</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">]</span>
            <span class="p">}</span>
            <span class="n">homes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">home</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">homes</span><span class="p">)</span><span class="si">}</span><span class="s2"> conceptual homes&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">homes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_notifications" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_notifications</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">automations</span><span class="p">,</span> <span class="n">rooms</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create notifications for users.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_notifications</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">automations</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">rooms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create notifications for users.&quot;&quot;&quot;</span>
    <span class="n">notifications</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Notification templates by type</span>
    <span class="n">notification_templates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;alert&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Motion Detected&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Motion was detected in </span><span class="si">{room}</span><span class="s2">&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Door Unlocked&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Your </span><span class="si">{device}</span><span class="s2"> was unlocked&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature Alert&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Temperature is too </span><span class="si">{high_low}</span><span class="s2"> in </span><span class="si">{room}</span><span class="s2">&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Battery Low&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> battery is running low&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Water Leak Detected&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Water leak detected by </span><span class="si">{device}</span><span class="s2">&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;info&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Offline&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> appears to be offline&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Update Available&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;A firmware update is available for </span><span class="si">{device}</span><span class="s2">&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Energy Report&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Your weekly energy report is ready&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;New Device Detected&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;A new device was detected on your network&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Automation Created&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Your new automation &#39;</span><span class="si">{automation}</span><span class="s2">&#39; has been created&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;warning&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Error&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> reported an error: </span><span class="si">{error_code}</span><span class="s2">&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;High Energy Usage&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Your energy usage is </span><span class="si">{percent}% hi</span><span class="s2">gher than usual&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed Authentication&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed login attempt detected&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection Issues&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> is having connectivity problems&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Hub Offline&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Your smart home hub is offline&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Automation Successful&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Automation &#39;</span><span class="si">{automation}</span><span class="s2">&#39; ran successfully&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Added&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> was successfully added to your home&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Update Completed&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> was successfully updated to version </span><span class="si">{version}</span><span class="s2">&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Energy Goal Met&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;Congratulations! You met your energy saving goal&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Device Paired&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2"> was successfully paired with your account&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="c1"># Determine number of notifications (5-30)</span>
        <span class="n">num_notifications</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

        <span class="c1"># Get user&#39;s devices</span>
        <span class="n">user_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Get user&#39;s automations</span>
        <span class="n">user_automations</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">automations</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_notifications</span><span class="p">):</span>
            <span class="c1"># Determine notification type</span>
            <span class="n">notification_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;alert&quot;</span><span class="p">,</span> <span class="s2">&quot;info&quot;</span><span class="p">,</span> <span class="s2">&quot;warning&quot;</span><span class="p">,</span> <span class="s2">&quot;success&quot;</span><span class="p">],</span>
                <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Determine priority</span>
            <span class="n">priority</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">,</span> <span class="s2">&quot;medium&quot;</span><span class="p">,</span> <span class="s2">&quot;high&quot;</span><span class="p">],</span>
                <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Determine source</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;device&quot;</span><span class="p">,</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;automation&quot;</span><span class="p">,</span> <span class="s2">&quot;goal&quot;</span><span class="p">,</span> <span class="s2">&quot;security&quot;</span><span class="p">],</span>
                <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">]</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Get template</span>
            <span class="n">template</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">notification_templates</span><span class="p">[</span><span class="n">notification_type</span><span class="p">])</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>

            <span class="c1"># Fill in placeholders</span>
            <span class="n">source_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{device}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">title</span><span class="p">:</span>
                <span class="n">device</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">)</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{device}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{device}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;device&quot;</span><span class="p">:</span>
                    <span class="n">source_id</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{room}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{room}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">title</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user_devices</span><span class="p">:</span>
                    <span class="n">device</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_devices</span><span class="p">)</span>
                    <span class="n">room_id</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;room_id&quot;</span><span class="p">]</span>
                    <span class="n">room</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">rooms</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">room_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">room</span><span class="p">:</span>
                        <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{room}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                        <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{room}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">room</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{automation}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{automation}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">title</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">user_automations</span><span class="p">:</span>
                    <span class="n">automation</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">user_automations</span><span class="p">)</span>
                    <span class="n">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{automation}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{automation}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s2">&quot;automation&quot;</span><span class="p">:</span>
                        <span class="n">source_id</span> <span class="o">=</span> <span class="n">automation</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{high_low}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{high_low}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">]))</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{percent}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{percent}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">50</span><span class="p">)))</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{error_code}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{error_code}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;E</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;</span><span class="si">{version}</span><span class="s2">&quot;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{version}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">9</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Determine timestamp</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">random_datetime</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

            <span class="c1"># Determine read status (older = more likely to be read)</span>
            <span class="n">days_old</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span> <span class="o">-</span> <span class="n">timestamp</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
            <span class="n">read_probability</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">days_old</span> <span class="o">/</span> <span class="mi">30</span><span class="p">)</span>  <span class="c1"># Older than 30 days = 90% read</span>
            <span class="n">read</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">read_probability</span>

            <span class="c1"># Create read timestamp if read</span>
            <span class="n">read_timestamp</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">read</span><span class="p">:</span>
                <span class="n">read_timestamp</span> <span class="o">=</span> <span class="n">timestamp</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1440</span><span class="p">))</span>  <span class="c1"># 1 min to 1 day later</span>

            <span class="n">notification</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span>
                <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">notification_type</span><span class="p">,</span>
                <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">priority</span><span class="p">,</span>
                <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">source</span><span class="p">,</span>
                <span class="s2">&quot;source_id&quot;</span><span class="p">:</span> <span class="n">source_id</span><span class="p">,</span>
                <span class="s2">&quot;read&quot;</span><span class="p">:</span> <span class="n">read</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s2">&quot;read_timestamp&quot;</span><span class="p">:</span> <span class="n">read_timestamp</span>
            <span class="p">}</span>

            <span class="n">notifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
            <span class="n">notification_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">notifications</span><span class="p">)</span><span class="si">}</span><span class="s2"> notifications&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">notifications</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_profiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_profiles</span><span class="p">(</span><span class="n">users</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create user profiles for existing users.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_profiles</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create user profiles for existing users.&quot;&quot;&quot;</span>
    <span class="n">profiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">temperature_units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
        <span class="n">last_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>

        <span class="c1"># 70% chance to use display name</span>
        <span class="n">display_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="n">display_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}{</span><span class="n">last_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> 
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span>
            <span class="n">display_name</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">display_names</span><span class="p">)</span>

        <span class="c1"># 60% chance to have avatar</span>
        <span class="n">avatar</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.4</span><span class="p">:</span>
            <span class="n">avatar</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://example.com/avatars/</span><span class="si">{</span><span class="n">user</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.jpg&quot;</span>

        <span class="c1"># 80% chance to have phone number</span>
        <span class="n">phone_number</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.2</span><span class="p">:</span>
            <span class="n">phone_number</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">phone_number</span><span class="p">()</span>

        <span class="c1"># Select timezone from common options</span>
        <span class="n">timezones</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;UTC&quot;</span><span class="p">,</span> <span class="s2">&quot;America/New_York&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Chicago&quot;</span><span class="p">,</span> <span class="s2">&quot;America/Denver&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/London&quot;</span><span class="p">,</span> <span class="s2">&quot;Europe/Paris&quot;</span><span class="p">,</span> <span class="s2">&quot;Asia/Tokyo&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Australia/Sydney&quot;</span><span class="p">,</span> <span class="s2">&quot;Pacific/Auckland&quot;</span>
        <span class="p">]</span>

        <span class="n">profile</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
            <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span>
            <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span>
            <span class="s2">&quot;display_name&quot;</span><span class="p">:</span> <span class="n">display_name</span><span class="p">,</span>
            <span class="s2">&quot;avatar&quot;</span><span class="p">:</span> <span class="n">avatar</span><span class="p">,</span>
            <span class="s2">&quot;phone_number&quot;</span><span class="p">:</span> <span class="n">phone_number</span><span class="p">,</span>
            <span class="s2">&quot;timezone&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">timezones</span><span class="p">),</span>
            <span class="s2">&quot;temperature_unit&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">temperature_units</span><span class="p">),</span>
            <span class="s2">&quot;dark_mode&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># 50% use dark mode</span>
            <span class="s2">&quot;favorite_devices&quot;</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># Will be populated later</span>
            <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
            <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="n">profiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>
        <span class="n">profile_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">profile</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span><span class="si">}</span><span class="s2"> profiles&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">profiles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_rooms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_rooms</span><span class="p">(</span><span class="n">homes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create rooms for each home.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_rooms</span><span class="p">(</span><span class="n">homes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create rooms for each home.&quot;&quot;&quot;</span>
    <span class="n">rooms</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">home</span> <span class="ow">in</span> <span class="n">homes</span><span class="p">:</span>
        <span class="c1"># Determine number of rooms based on home type</span>
        <span class="k">if</span> <span class="s2">&quot;Main&quot;</span> <span class="ow">in</span> <span class="n">home</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span>
            <span class="n">num_rooms</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">(</span><span class="n">keyword</span> <span class="ow">in</span> <span class="n">home</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">keyword</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Vacation&quot;</span><span class="p">,</span> <span class="s2">&quot;Beach&quot;</span><span class="p">,</span> <span class="s2">&quot;Cabin&quot;</span><span class="p">,</span> <span class="s2">&quot;Lake&quot;</span><span class="p">]):</span>
            <span class="n">num_rooms</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_rooms</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="c1"># Select random room types without duplicates</span>
        <span class="n">selected_room_types</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">ROOM_TYPES</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_rooms</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ROOM_TYPES</span><span class="p">)))</span>

        <span class="c1"># If we need more rooms than unique types, add some numbered bedrooms or generic rooms</span>
        <span class="k">if</span> <span class="n">num_rooms</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_room_types</span><span class="p">):</span>
            <span class="n">extra_rooms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Bedroom &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_rooms</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">selected_room_types</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)]</span>
            <span class="n">selected_room_types</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_rooms</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">room_type</span> <span class="ow">in</span> <span class="n">selected_room_types</span><span class="p">:</span>
            <span class="n">floor</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">room_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Basement&quot;</span><span class="p">,</span> <span class="s2">&quot;Garage&quot;</span><span class="p">]:</span>
                <span class="n">floor</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">room_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Attic&quot;</span><span class="p">,</span> <span class="s2">&quot;Guest Room&quot;</span><span class="p">,</span> <span class="s2">&quot;Bedroom 2&quot;</span><span class="p">,</span> <span class="s2">&quot;Bedroom 3&quot;</span><span class="p">]:</span>
                <span class="n">floor</span> <span class="o">=</span> <span class="mi">2</span>

            <span class="n">room</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">home</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;home_id&quot;</span><span class="p">:</span> <span class="n">home</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">room_type</span><span class="p">,</span>
                <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">room_type</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">home</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">room_type</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">),</span>
                <span class="s2">&quot;floor&quot;</span><span class="p">:</span> <span class="n">floor</span><span class="p">,</span>
                <span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="p">[],</span>  <span class="c1"># Will be populated later</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">home</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>

            <span class="c1"># Some rooms have been updated</span>
            <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
                <span class="n">room</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">home</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

            <span class="n">rooms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>
            <span class="n">room_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">room</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">rooms</span><span class="p">)</span><span class="si">}</span><span class="s2"> rooms&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rooms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_suggestions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_suggestions</span><span class="p">(</span><span class="n">users</span><span class="p">,</span> <span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create suggestions for users to improve their smart home.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_suggestions</span><span class="p">(</span><span class="n">users</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create suggestions for users to improve their smart home.&quot;&quot;&quot;</span>
    <span class="n">suggestions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Suggestion templates by type</span>
    <span class="n">suggestion_templates</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;energy_saving&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Optimize Thermostat Schedule&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Based on your usage patterns, adjusting your thermostat schedule could save up to 15</span><span class="si">% o</span><span class="s2">n heating and cooling costs. We suggest lowering temperatures at night and when you&#39;re away from home.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Replace High-Energy Light Bulbs&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Some of your lights are using older technology. Replacing them with LED bulbs could reduce lighting energy consumption by up to 80%.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Smart Power Strip for Entertainment Center&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Your entertainment devices are drawing standby power. Using a smart power strip could eliminate this vampire power and save up to $100 annually.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Install Motion Sensors for Lights&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;We&#39;ve noticed lights staying on in unoccupied rooms. Adding motion sensors could reduce wasted electricity by automatically turning off lights when rooms are empty.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Schedule Device Power Down&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Creating a nighttime automation to power down non-essential devices could reduce your overnight energy consumption by up to 12%.&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;security&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Add Entry Sensors to Windows&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Your home security could be improved by adding entry sensors to ground-floor windows. This would alert you immediately if a window is opened unexpectedly.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Improve Door Lock Security&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Your front door lock doesn&#39;t have auto-lock enabled. We recommend enabling this feature to ensure your door locks automatically after being unlocked.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Set Up Camera Motion Zones&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Your security cameras could be more effective by setting up specific motion zones to reduce false alerts and focus on important areas.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Lighting Schedules When Away&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Setting up randomized lighting schedules when you&#39;re away can deter potential intruders by simulating occupancy.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Enable Two-Factor Authentication&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;For improved account security, enable two-factor authentication for your smart home system access.&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;comfort&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Optimize Temperature for Better Sleep&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Research shows sleeping in slightly cooler temperatures improves sleep quality. We suggest setting your bedroom to 65-68°F (18-20°C) overnight.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Morning Routine Automation&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Start your day right with a morning routine that gradually turns on lights, adjusts the thermostat, and plays your favorite music at wake-up time.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Add Humidity Control to Bedrooms&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The humidity levels in your bedrooms fluctuate outside the ideal 40-60</span><span class="si">% r</span><span class="s2">ange. A smart humidifier could improve air quality and comfort.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Set Up Optimal Lighting Scenes&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Creating preset lighting scenes for different activities (reading, movie watching, dinner) can enhance mood and comfort in your living spaces.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Automate Blinds for Natural Light&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Adding smart blinds that automatically adjust based on time of day and sunlight can optimize natural light while maintaining privacy.&quot;</span><span class="p">}</span>
        <span class="p">],</span>
        <span class="s2">&quot;automation&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Create Arriving/Leaving Home Routines&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Set up geofencing to automatically adjust your home when you arrive or leave - turning on/off lights, adjusting temperature, and securing doors.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Link Weather to Home Behavior&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Connect your system to weather forecasts to automatically close blinds during hot days or adjust heating before cold fronts arrive.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Set Up Night Mode Routine&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Create a bedtime routine that secures your home, dims lights, and creates the optimal sleeping environment with a single command.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Voice Command Shortcuts&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;We&#39;ve identified common device combinations you use. Setting up custom voice commands could make controlling these groups more convenient.&quot;</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Automate Based on Occupancy&quot;</span><span class="p">,</span> 
             <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Using your motion sensors to automatically control lights and climate based on which rooms are occupied could improve convenience and efficiency.&quot;</span><span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="c1"># 70% chance user has suggestions</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>
            <span class="c1"># Get user&#39;s devices</span>
            <span class="n">user_devices</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span> <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Determine number of suggestions (2-10)</span>
            <span class="n">num_suggestions</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_suggestions</span><span class="p">):</span>
                <span class="c1"># Choose suggestion type</span>
                <span class="n">suggestion_type</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">suggestion_templates</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

                <span class="c1"># Choose template</span>
                <span class="n">template</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">suggestion_templates</span><span class="p">[</span><span class="n">suggestion_type</span><span class="p">])</span>

                <span class="c1"># Determine priority</span>
                <span class="n">priority</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

                <span class="c1"># Determine related devices</span>
                <span class="n">related_device_ids</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">:</span>  <span class="c1"># 70% have related devices</span>
                    <span class="n">num_related</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_devices</span><span class="p">)))</span>
                    <span class="n">related_device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">user_devices</span><span class="p">,</span> <span class="n">num_related</span><span class="p">)]</span>

                <span class="c1"># Determine status</span>
                <span class="n">status_weights</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>  <span class="c1"># pending, accepted, rejected, implemented</span>
                <span class="n">status</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="s2">&quot;pending&quot;</span><span class="p">,</span> <span class="s2">&quot;accepted&quot;</span><span class="p">,</span> <span class="s2">&quot;rejected&quot;</span><span class="p">,</span> <span class="s2">&quot;implemented&quot;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="n">status_weights</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Create timestamps</span>
                <span class="n">created</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
                <span class="n">updated</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">implemented_date</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">user_feedback</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="c1"># If not pending, add update info</span>
                <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="s2">&quot;pending&quot;</span><span class="p">:</span>
                    <span class="n">updated</span> <span class="o">=</span> <span class="n">created</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;implemented&quot;</span><span class="p">:</span>
                        <span class="n">implemented_date</span> <span class="o">=</span> <span class="n">updated</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

                    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># 50% chance of feedback</span>
                        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;accepted&quot;</span> <span class="ow">or</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;implemented&quot;</span><span class="p">:</span>
                            <span class="n">feedback_options</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="s2">&quot;Great suggestion, I&#39;ll try this.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;This is exactly what I needed.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Thanks for the recommendation!&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;I&#39;ve been looking for something like this.&quot;</span>
                            <span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>  <span class="c1"># rejected</span>
                            <span class="n">feedback_options</span> <span class="o">=</span> <span class="p">[</span>
                                <span class="s2">&quot;Not interested in this right now.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;I&#39;ve tried this before and it didn&#39;t work for me.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;Maybe later, but not a priority.&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;I prefer my current setup.&quot;</span>
                            <span class="p">]</span>
                        <span class="n">user_feedback</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">feedback_options</span><span class="p">)</span>

                <span class="n">suggestion</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                    <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">template</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">],</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">suggestion_type</span><span class="p">,</span>
                    <span class="s2">&quot;priority&quot;</span><span class="p">:</span> <span class="n">priority</span><span class="p">,</span>
                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span>
                    <span class="s2">&quot;related_device_ids&quot;</span><span class="p">:</span> <span class="n">related_device_ids</span><span class="p">,</span>
                    <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">created</span><span class="p">,</span>
                    <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">updated</span><span class="p">,</span>
                    <span class="s2">&quot;implemented_date&quot;</span><span class="p">:</span> <span class="n">implemented_date</span><span class="p">,</span>
                    <span class="s2">&quot;user_feedback&quot;</span><span class="p">:</span> <span class="n">user_feedback</span>
                <span class="p">}</span>

                <span class="n">suggestions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>
                <span class="n">suggestion_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">suggestion</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">suggestions</span><span class="p">)</span><span class="si">}</span><span class="s2"> suggestions&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">suggestions</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_usage_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_usage_data</span><span class="p">(</span><span class="n">devices</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create usage data for devices.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_usage_data</span><span class="p">(</span><span class="n">devices</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create usage data for devices.&quot;&quot;&quot;</span>
    <span class="n">usages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
        <span class="c1"># Skip offline devices</span>
        <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;offline&quot;</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Number of usage records based on device age (1-50 records)</span>
        <span class="n">days_since_creation</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span> <span class="o">-</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
        <span class="n">num_records</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">days_since_creation</span> <span class="o">/</span> <span class="mi">7</span><span class="p">)</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)))</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_records</span><span class="p">):</span>
            <span class="c1"># Generate timestamp within device&#39;s lifetime</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="n">random_datetime</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

            <span class="c1"># Generate metrics based on device type</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">energy_consumed</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;light&quot;</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">480</span><span class="p">)</span>  <span class="c1"># 5 mins to 8 hours</span>
                <span class="n">energy_consumed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mi">3</span><span class="p">)</span>  <span class="c1"># kWh</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;brightness&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="s2">&quot;on_time&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                    <span class="s2">&quot;state_changes&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;thermostat&quot;</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1440</span><span class="p">)</span>  <span class="c1"># 30 mins to 24 hours</span>
                <span class="n">energy_consumed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># kWh</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;ambient_temp&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span> <span class="mi">28</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;target_temp&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;heating_time&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="s2">&quot;cooling_time&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">duration</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;lock&quot;</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># 1-5 minutes</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;locked&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.3</span><span class="p">,</span>
                    <span class="s2">&quot;unlock_count&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="s2">&quot;lock_count&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
                    <span class="s2">&quot;auto_lock_triggered&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span>
                <span class="p">}</span>
            <span class="k">elif</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;outlet&quot;</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">1440</span><span class="p">)</span>  <span class="c1"># 30 mins to 24 hours</span>
                <span class="n">energy_consumed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># kWh</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;power_draw&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2000</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># watts</span>
                    <span class="s2">&quot;voltage&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">110</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="s2">&quot;current&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">240</span><span class="p">)</span>  <span class="c1"># 10 mins to 4 hours</span>
                <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>  <span class="c1"># 30% chance for energy data</span>
                    <span class="n">energy_consumed</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># kWh</span>
                <span class="n">metrics</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;usage_minutes&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                    <span class="s2">&quot;interactions&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
                <span class="p">}</span>

            <span class="n">usage</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">generate_uuid</span><span class="p">(),</span>
                <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                <span class="s2">&quot;metrics&quot;</span><span class="p">:</span> <span class="n">metrics</span><span class="p">,</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s2">&quot;duration&quot;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
                <span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="n">energy_consumed</span><span class="p">,</span>
                <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;active&quot;</span> <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span> <span class="k">else</span> <span class="s2">&quot;idle&quot;</span><span class="p">,</span>
                <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">timestamp</span><span class="p">,</span>
                <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span>
            <span class="p">}</span>

            <span class="n">usages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
            <span class="n">usage_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">usages</span><span class="p">)</span><span class="si">}</span><span class="s2"> usage records&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">usages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.create_users" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">create_users</span><span class="p">(</span><span class="n">count</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create realistic user data.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_users</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">25</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create realistic user data.&quot;&quot;&quot;</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">count</span><span class="p">):</span>
        <span class="n">first_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">first_name</span><span class="p">()</span>
        <span class="n">last_name</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">last_name</span><span class="p">()</span>
        <span class="n">username</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">first_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">last_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">999</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">email</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">@</span><span class="si">{</span><span class="n">fake</span><span class="o">.</span><span class="n">domain_name</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="c1"># Create a strong password that meets requirements</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">fake</span><span class="o">.</span><span class="n">password</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;A1!&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">generate_uuid</span><span class="p">()</span>
        <span class="n">user</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span>
            <span class="s2">&quot;hashed_password&quot;</span><span class="p">:</span> <span class="n">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">),</span>
            <span class="s2">&quot;active&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;verified&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># 90% are verified</span>
            <span class="s2">&quot;created&quot;</span><span class="p">:</span> <span class="n">random_date</span><span class="p">(</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2023</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)),</span>
            <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">([</span><span class="s2">&quot;admin&quot;</span><span class="p">,</span> <span class="s2">&quot;user&quot;</span><span class="p">],</span> <span class="n">weights</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Add random updated date for some users</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.7</span><span class="p">:</span>
            <span class="n">user</span><span class="p">[</span><span class="s2">&quot;updated&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random_date</span><span class="p">(</span><span class="n">user</span><span class="p">[</span><span class="s2">&quot;created&quot;</span><span class="p">],</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2024</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">21</span><span class="p">))</span>

        <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>
        <span class="n">user_collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">user</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span><span class="si">}</span><span class="s2"> users&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">users</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.generate_uuid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">generate_uuid</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a UUID string.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_uuid</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a UUID string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.hash_password" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create a hashed password.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">hash_password</span><span class="p">(</span><span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a hashed password.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.random_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">random_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a random date between start_date and end_date.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">random_date</span><span class="p">(</span><span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a random date between start_date and end_date.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start_date</span>  <span class="c1"># Return start_date if range is invalid</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span>
    <span class="n">random_days</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Add 1 to include end_date</span>
    <span class="k">return</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">random_days</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.seeds.seed_database.random_datetime" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">seeds</span><span class="o">.</span><span class="n">seed_database</span><span class="o">.</span><span class="n">random_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a random datetime between start_date and end_date.</p>

            <details class="quote">
              <summary>Source code in <code>app/seeds/seed_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">random_datetime</span><span class="p">(</span><span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a random datetime between start_date and end_date.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="o">&gt;=</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">start_date</span>  <span class="c1"># Return start_date if range is invalid</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">start_date</span>
    <span class="n">random_seconds</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randrange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Add 1 to include end_date</span>
    <span class="k">return</span> <span class="n">start_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">random_seconds</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.services.report_service" class="doc doc-heading">
            <code>app.services.report_service</code>


</h2>

    <div class="doc doc-contents first">

        <p>Service for energy report generation and management.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.services.report_service.ReportService" class="doc doc-heading">
            <code>app.services.report_service.ReportService</code>


</h3>


    <div class="doc doc-contents ">


        <p>Service for managing energy report generation and storage.</p>






              <details class="quote">
                <summary>Source code in <code>app/services/report_service.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ReportService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Service for managing energy report generation and storage.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">:</span> <span class="n">ReportDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a report record in the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_data: Report data to store</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: ID of the created report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report_dict</span> <span class="o">=</span> <span class="n">report_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">report_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">inserted_id</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve a report by ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_id: ID of the report to retrieve</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Dict]: Report data if found, None otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">report</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">report</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_user_reports</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve all reports for a user.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: ID of the user</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict]: List of report data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">reports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>  <span class="c1"># Convert cursor to list</span>
        <span class="k">return</span> <span class="n">reports</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">update_report_status</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">ReportStatus</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Update the status of a report.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_id: ID of the report to update</span>
<span class="sd">            status: New status</span>
<span class="sd">            **kwargs: Additional fields to update</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if update was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}</span>
        <span class="n">update_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
            <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_energy_data</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch energy usage data from the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: ID of the user</span>
<span class="sd">            start_date: Start date in YYYY-MM-DD format</span>
<span class="sd">            end_date: End date in YYYY-MM-DD format</span>
<span class="sd">            device_ids: List of device IDs to filter by</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict]: List of energy usage records</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert string dates to datetime objects if provided</span>
        <span class="n">start_datetime</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">end_datetime</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">start_date</span><span class="p">:</span>
            <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="c1"># Set end_datetime to the end of the day</span>
            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">end_datetime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>

        <span class="c1"># Build the query</span>
        <span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Get all devices owned by the user</span>
        <span class="k">if</span> <span class="n">device_ids</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no specific devices are requested, get all devices for the user</span>
            <span class="n">user_devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># User has no devices, return empty list</span>

            <span class="n">user_device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">user_device_ids</span><span class="p">:</span>
                <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">user_device_ids</span><span class="p">}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If user has no devices, return empty list</span>
                <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Add date range filter if provided</span>
        <span class="k">if</span> <span class="n">start_datetime</span> <span class="ow">or</span> <span class="n">end_datetime</span><span class="p">:</span>
            <span class="n">timestamp_query</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">start_datetime</span><span class="p">:</span>
                <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_datetime</span>
            <span class="k">if</span> <span class="n">end_datetime</span><span class="p">:</span>
                <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_datetime</span>

            <span class="k">if</span> <span class="n">timestamp_query</span><span class="p">:</span>
                <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp_query</span>

        <span class="c1"># Execute the query</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cursor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">usage_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>  <span class="c1"># Convert cursor to list</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usage data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">, length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Enhance usage data with device information</span>
        <span class="n">enhanced_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">usage_data</span><span class="p">:</span>
            <span class="c1"># Get device info</span>
            <span class="n">device_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
            <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

            <span class="c1"># Create enhanced record with location</span>
            <span class="n">enhanced_record</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span>
                <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
                <span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;room_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
            <span class="p">}</span>

            <span class="n">enhanced_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enhanced_record</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">enhanced_data</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fetch_user_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch user data for report personalization.</span>

<span class="sd">        Args:</span>
<span class="sd">            user_id: ID of the user</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict: User data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a report based on its ID.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_id: ID of the report to generate</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[bool, Optional[str], Optional[str]]: </span>
<span class="sd">                - Success flag</span>
<span class="sd">                - File path if successful</span>
<span class="sd">                - Error message if failed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get report data</span>
        <span class="n">report_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">report_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Report not found&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Update status to generating</span>
            <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
                <span class="n">report_id</span><span class="p">,</span> 
                <span class="n">ReportStatus</span><span class="o">.</span><span class="n">GENERATING</span>
            <span class="p">)</span>

            <span class="c1"># Fetch energy data</span>
            <span class="n">energy_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_energy_data</span><span class="p">(</span>
                <span class="n">user_id</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
                <span class="n">device_ids</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">energy_data</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;No energy data found for the specified criteria&quot;</span>
                <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
                    <span class="n">report_id</span><span class="p">,</span> 
                    <span class="n">ReportStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
                    <span class="n">error_message</span><span class="o">=</span><span class="n">error_msg</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span>

            <span class="c1"># Fetch user data for personalization</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_user_data</span><span class="p">(</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>

            <span class="c1"># Generate the report</span>
            <span class="n">report_path</span> <span class="o">=</span> <span class="n">generate_energy_report</span><span class="p">(</span>
                <span class="n">energy_data</span><span class="o">=</span><span class="n">energy_data</span><span class="p">,</span>
                <span class="n">user_data</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
                <span class="nb">format</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
                <span class="n">start_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
                <span class="n">end_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="c1"># Calculate some basic stats for metadata</span>
            <span class="n">total_energy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">energy_data</span><span class="p">)</span>
            <span class="n">device_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">energy_data</span><span class="p">))</span>

            <span class="c1"># Update the report record with success status</span>
            <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
                <span class="n">report_id</span><span class="p">,</span>
                <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
                <span class="n">file_path</span><span class="o">=</span><span class="n">report_path</span><span class="p">,</span>
                <span class="n">completed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
                <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                    <span class="s2">&quot;total_energy&quot;</span><span class="p">:</span> <span class="n">total_energy</span><span class="p">,</span>
                    <span class="s2">&quot;record_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy_data</span><span class="p">),</span>
                    <span class="s2">&quot;device_count&quot;</span><span class="p">:</span> <span class="n">device_count</span><span class="p">,</span>
                    <span class="s2">&quot;file_size&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">report_path</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Update the report record with failure status</span>
            <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
                <span class="n">report_id</span><span class="p">,</span>
                <span class="n">ReportStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="n">error_message</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_message</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">delete_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a report record from the database.</span>

<span class="sd">        Args:</span>
<span class="sd">            report_id: ID of the report to delete</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if deletion was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">})</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.create_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">create_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Create a report record in the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>report_data</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportDB" href="#app.models.report.ReportDB">ReportDB</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report data to store</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the created report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_report</span><span class="p">(</span><span class="n">report_data</span><span class="p">:</span> <span class="n">ReportDB</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a report record in the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        report_data: Report data to store</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: ID of the created report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report_dict</span> <span class="o">=</span> <span class="n">report_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">report_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">inserted_id</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.delete_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">delete_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Delete a report record from the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>report_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the report to delete</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if deletion was successful, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">delete_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete a report record from the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        report_id: ID of the report to delete</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if deletion was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">delete_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">deleted_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.fetch_energy_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_energy_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">device_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Fetch energy usage data from the database.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date in YYYY-MM-DD format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date in YYYY-MM-DD format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>device_ids</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs to filter by</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict]: List of energy usage records</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_energy_data</span><span class="p">(</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">device_ids</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch energy usage data from the database.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: ID of the user</span>
<span class="sd">        start_date: Start date in YYYY-MM-DD format</span>
<span class="sd">        end_date: End date in YYYY-MM-DD format</span>
<span class="sd">        device_ids: List of device IDs to filter by</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict]: List of energy usage records</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert string dates to datetime objects if provided</span>
    <span class="n">start_datetime</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">end_datetime</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">start_date</span><span class="p">:</span>
        <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="c1"># Set end_datetime to the end of the day</span>
        <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">end_datetime</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">23</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">59</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">59</span><span class="p">)</span>

    <span class="c1"># Build the query</span>
    <span class="n">query</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Get all devices owned by the user</span>
    <span class="k">if</span> <span class="n">device_ids</span><span class="p">:</span>
        <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">device_ids</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># If no specific devices are requested, get all devices for the user</span>
        <span class="n">user_devices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">}))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user_devices</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>  <span class="c1"># User has no devices, return empty list</span>

        <span class="n">user_device_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">user_devices</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">user_device_ids</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;device_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;$in&quot;</span><span class="p">:</span> <span class="n">user_device_ids</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If user has no devices, return empty list</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="c1"># Add date range filter if provided</span>
    <span class="k">if</span> <span class="n">start_datetime</span> <span class="ow">or</span> <span class="n">end_datetime</span><span class="p">:</span>
        <span class="n">timestamp_query</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">start_datetime</span><span class="p">:</span>
            <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$gte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_datetime</span>
        <span class="k">if</span> <span class="n">end_datetime</span><span class="p">:</span>
            <span class="n">timestamp_query</span><span class="p">[</span><span class="s2">&quot;$lte&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">end_datetime</span>

        <span class="k">if</span> <span class="n">timestamp_query</span><span class="p">:</span>
            <span class="n">query</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">timestamp_query</span>

    <span class="c1"># Execute the query</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Query: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">us_c</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cursor type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">usage_data</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>  <span class="c1"># Convert cursor to list</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usage data type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">, length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">usage_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Enhance usage data with device information</span>
    <span class="n">enhanced_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">usage_data</span><span class="p">:</span>
        <span class="c1"># Get device info</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span>
        <span class="n">device</span> <span class="o">=</span> <span class="n">d_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">})</span>

        <span class="c1"># Create enhanced record with location</span>
        <span class="n">enhanced_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span> <span class="n">datetime</span><span class="p">)</span> <span class="k">else</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">),</span>
            <span class="s2">&quot;device_id&quot;</span><span class="p">:</span> <span class="n">device_id</span><span class="p">,</span>
            <span class="s2">&quot;energy_consumed&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="s2">&quot;location&quot;</span><span class="p">:</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;room_id&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">device</span> <span class="k">else</span> <span class="s2">&quot;Unknown&quot;</span>
        <span class="p">}</span>

        <span class="n">enhanced_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">enhanced_record</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">enhanced_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.fetch_user_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_user_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Fetch user data for report personalization.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Dict</code></td>            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fetch_user_data</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetch user data for report personalization.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: ID of the user</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict: User data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">u_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">),</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;username&quot;</span><span class="p">)</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.generate_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Generate a report based on its ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>report_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the report to generate</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="bool">bool</span>, <span title="typing.Optional">Optional</span>[<span title="str">str</span>], <span title="typing.Optional">Optional</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[bool, Optional[str], Optional[str]]: 
- Success flag
- File path if successful
- Error message if failed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a report based on its ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        report_id: ID of the report to generate</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[bool, Optional[str], Optional[str]]: </span>
<span class="sd">            - Success flag</span>
<span class="sd">            - File path if successful</span>
<span class="sd">            - Error message if failed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get report data</span>
    <span class="n">report_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">report_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Report not found&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Update status to generating</span>
        <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
            <span class="n">report_id</span><span class="p">,</span> 
            <span class="n">ReportStatus</span><span class="o">.</span><span class="n">GENERATING</span>
        <span class="p">)</span>

        <span class="c1"># Fetch energy data</span>
        <span class="n">energy_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_energy_data</span><span class="p">(</span>
            <span class="n">user_id</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">],</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">),</span>
            <span class="n">device_ids</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_ids&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">energy_data</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="s2">&quot;No energy data found for the specified criteria&quot;</span>
            <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
                <span class="n">report_id</span><span class="p">,</span> 
                <span class="n">ReportStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="n">error_msg</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_msg</span>

        <span class="c1"># Fetch user data for personalization</span>
        <span class="n">user_data</span> <span class="o">=</span> <span class="n">ReportService</span><span class="o">.</span><span class="n">fetch_user_data</span><span class="p">(</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;user_id&quot;</span><span class="p">])</span>

        <span class="c1"># Generate the report</span>
        <span class="n">report_path</span> <span class="o">=</span> <span class="n">generate_energy_report</span><span class="p">(</span>
            <span class="n">energy_data</span><span class="o">=</span><span class="n">energy_data</span><span class="p">,</span>
            <span class="n">user_data</span><span class="o">=</span><span class="n">user_data</span><span class="p">,</span>
            <span class="nb">format</span><span class="o">=</span><span class="n">report_data</span><span class="p">[</span><span class="s2">&quot;format&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="n">start_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_date&quot;</span><span class="p">),</span>
            <span class="n">end_date</span><span class="o">=</span><span class="n">report_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_date&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Calculate some basic stats for metadata</span>
        <span class="n">total_energy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;energy_consumed&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">energy_data</span><span class="p">)</span>
        <span class="n">device_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_id&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">energy_data</span><span class="p">))</span>

        <span class="c1"># Update the report record with success status</span>
        <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
            <span class="n">report_id</span><span class="p">,</span>
            <span class="n">ReportStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span>
            <span class="n">file_path</span><span class="o">=</span><span class="n">report_path</span><span class="p">,</span>
            <span class="n">completed</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">(),</span>
            <span class="n">metadata</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;total_energy&quot;</span><span class="p">:</span> <span class="n">total_energy</span><span class="p">,</span>
                <span class="s2">&quot;record_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">energy_data</span><span class="p">),</span>
                <span class="s2">&quot;device_count&quot;</span><span class="p">:</span> <span class="n">device_count</span><span class="p">,</span>
                <span class="s2">&quot;file_size&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">report_path</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="n">report_path</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="c1"># Update the report record with failure status</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span>
            <span class="n">report_id</span><span class="p">,</span>
            <span class="n">ReportStatus</span><span class="o">.</span><span class="n">FAILED</span><span class="p">,</span>
            <span class="n">error_message</span><span class="o">=</span><span class="n">error_message</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">error_message</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.get_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Retrieve a report by ID.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>report_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the report to retrieve</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional[Dict]: Report data if found, None otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_report</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a report by ID.</span>

<span class="sd">    Args:</span>
<span class="sd">        report_id: ID of the report to retrieve</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[Dict]: Report data if found, None otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">report</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">report</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.get_user_reports" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">get_user_reports</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Retrieve all reports for a user.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the user</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict]: List of report data</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">get_user_reports</span><span class="p">(</span><span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve all reports for a user.</span>

<span class="sd">    Args:</span>
<span class="sd">        user_id: ID of the user</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict]: List of report data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">})</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="s2">&quot;created&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">reports</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cursor</span><span class="p">)</span>  <span class="c1"># Convert cursor to list</span>
    <span class="k">return</span> <span class="n">reports</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.services.report_service.ReportService.update_report_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">report_service</span><span class="o">.</span><span class="n">ReportService</span><span class="o">.</span><span class="n">update_report_status</span><span class="p">(</span><span class="n">report_id</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h4>


    <div class="doc doc-contents ">

        <p>Update the status of a report.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>report_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>ID of the report to update</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>status</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="app.models.report.ReportStatus" href="#app.models.report.ReportStatus">ReportStatus</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New status</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional fields to update</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if update was successful, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/services/report_service.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update_report_status</span><span class="p">(</span><span class="n">report_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">ReportStatus</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Update the status of a report.</span>

<span class="sd">    Args:</span>
<span class="sd">        report_id: ID of the report to update</span>
<span class="sd">        status: New status</span>
<span class="sd">        **kwargs: Additional fields to update</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if update was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">update_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="n">status</span><span class="p">,</span> <span class="s2">&quot;updated&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()}</span>
    <span class="n">update_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">r_c</span><span class="o">.</span><span class="n">update_one</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">report_id</span><span class="p">},</span>
        <span class="p">{</span><span class="s2">&quot;$set&quot;</span><span class="p">:</span> <span class="n">update_data</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">modified_count</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.utils.report.anomaly_detector" class="doc doc-heading">
            <code>app.utils.report.anomaly_detector</code>


</h2>

    <div class="doc doc-contents first">

        <p>This module provides functionality in detecting usage anomalies.</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.utils.report.anomaly_detector.EnergyAnomalyDetector" class="doc doc-heading">
            <code>app.utils.report.anomaly_detector.EnergyAnomalyDetector</code>


</h3>


    <div class="doc doc-contents ">


        <p>Utility for detecting anomalies in energy consumption data in real-time</p>






              <details class="quote">
                <summary>Source code in <code>app/utils/report/anomaly_detector.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyAnomalyDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Utility for detecting anomalies in energy consumption data in real-time</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">contamination</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the anomaly detector</span>

<span class="sd">        Args:</span>
<span class="sd">            history_days (int): Number of days of historical data to use</span>
<span class="sd">            contamination (float): Expected proportion of anomalies (0.01 to 0.1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">history_days</span> <span class="o">=</span> <span class="n">history_days</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contamination</span> <span class="o">=</span> <span class="n">contamination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">historical_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Train the anomaly detection model using historical data</span>

<span class="sd">        Args:</span>
<span class="sd">            historical_data (List[Dict]): Historical energy consumption records</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if training was successful, False otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">historical_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Convert to DataFrame</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span>

            <span class="c1"># Ensure timestamp is a datetime</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Group by day and device to reduce noise</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
            <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;device_id&#39;</span><span class="p">])[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># Prepare features for anomaly detection</span>
            <span class="c1"># For each device, calculate:</span>
            <span class="c1"># 1. Daily consumption</span>
            <span class="c1"># 2. 7-day rolling average</span>
            <span class="c1"># 3. Day of week (to account for weekly patterns)</span>

            <span class="n">devices</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="n">device_data</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">device</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># Need enough data for rolling average</span>
                    <span class="k">continue</span>

                <span class="c1"># FIX:</span>
                <span class="n">device_data</span> <span class="o">=</span> <span class="n">device_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
                <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
                <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="c1"># Skip the first 7 days (they won&#39;t have a complete 7-day average)</span>
                <span class="n">device_data</span> <span class="o">=</span> <span class="n">device_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">processed_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Combine all devices</span>
            <span class="n">full_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span>

            <span class="c1"># Features for anomaly detection</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">]]</span>

            <span class="c1"># Standardize the features</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
            <span class="n">scaled_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

            <span class="c1"># Train the Isolation Forest model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span>
                <span class="c1"># FIX:</span>
                <span class="n">contamination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contamination</span><span class="p">,</span>
                <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error training anomaly detection model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect anomalies in new energy consumption data</span>

<span class="sd">        Args:</span>
<span class="sd">            new_data (List[Dict]): New energy consumption records to analyze</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[Dict]: Records flagged as anomalies with additional metadata</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Convert to DataFrame</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

            <span class="c1"># Ensure timestamp is a datetime</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Group by day and device to match training data format</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
            <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;device_id&#39;</span><span class="p">])[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="c1"># Prepare features for each device</span>
            <span class="n">devices</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
            <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
                <span class="n">device_data</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># Add day of week</span>
                <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

                <span class="c1"># We need historical data to compute rolling average</span>
                <span class="c1"># For real-time detection, you would need to retrieve this from the database</span>
                <span class="c1"># Here we&#39;ll use a placeholder value based on the average energy consumption</span>
                <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

                <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">processed_data</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="c1"># Combine all devices</span>
            <span class="n">full_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span>

            <span class="c1"># Original data for reference</span>
            <span class="n">original_data</span> <span class="o">=</span> <span class="n">full_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Features for anomaly detection</span>
            <span class="n">features</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">]]</span>

            <span class="c1"># Standardize the features</span>
            <span class="n">scaled_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

            <span class="c1"># Predict anomalies</span>
            <span class="c1"># FIX:</span>
            <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>
            <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>

            <span class="c1"># Add predictions and scores back to the original data</span>
            <span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
            <span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span>

            <span class="c1"># Filter to only anomalies (prediction of -1 means anomaly)</span>
            <span class="n">anomalies</span> <span class="o">=</span> <span class="n">original_data</span><span class="p">[</span><span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Convert back to dictionary format</span>
            <span class="n">anomaly_records</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">anomaly_records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;device_id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">],</span>
                    <span class="c1"># FIX:</span>
                    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="s1">&#39;energy_consumed&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;anomaly_score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]),</span>
                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span> <span class="k">else</span> <span class="s1">&#39;medium&#39;</span>
                <span class="p">})</span>

            <span class="k">return</span> <span class="n">anomaly_records</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting anomalies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_anomaly_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anomaly</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a human-readable description of an anomaly</span>

<span class="sd">        Args:</span>
<span class="sd">            anomaly (Dict): An anomaly record</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Human-readable description</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">device_id</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown device&#39;</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown date&#39;</span><span class="p">)</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">severity</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Unusually high energy consumption detected for </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">. &quot;</span> \
                   <span class="sa">f</span><span class="s2">&quot;Consumption of </span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh is significantly above normal levels.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Abnormal energy consumption detected for </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">. &quot;</span> \
                   <span class="sa">f</span><span class="s2">&quot;Consumption of </span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh deviates from expected patterns.&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.utils.report.anomaly_detector.EnergyAnomalyDetector.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">anomaly_detector</span><span class="o">.</span><span class="n">EnergyAnomalyDetector</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">history_days</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">contamination</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize the anomaly detector</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history_days</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of days of historical data to use</p>
              </div>
            </td>
            <td>
                  <code>30</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>contamination</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Expected proportion of anomalies (0.01 to 0.1)</p>
              </div>
            </td>
            <td>
                  <code>0.05</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/anomaly_detector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">history_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">contamination</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the anomaly detector</span>

<span class="sd">    Args:</span>
<span class="sd">        history_days (int): Number of days of historical data to use</span>
<span class="sd">        contamination (float): Expected proportion of anomalies (0.01 to 0.1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">history_days</span> <span class="o">=</span> <span class="n">history_days</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">contamination</span> <span class="o">=</span> <span class="n">contamination</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.anomaly_detector.EnergyAnomalyDetector.detect_anomalies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">anomaly_detector</span><span class="o">.</span><span class="n">EnergyAnomalyDetector</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Detect anomalies in new energy consumption data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>new_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>New energy consumption records to analyze</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict]: Records flagged as anomalies with additional metadata</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/anomaly_detector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect anomalies in new energy consumption data</span>

<span class="sd">    Args:</span>
<span class="sd">        new_data (List[Dict]): New energy consumption records to analyze</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict]: Records flagged as anomalies with additional metadata</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">new_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert to DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>

        <span class="c1"># Ensure timestamp is a datetime</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Group by day and device to match training data format</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;device_id&#39;</span><span class="p">])[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Prepare features for each device</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">device_data</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Add day of week</span>
            <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>

            <span class="c1"># We need historical data to compute rolling average</span>
            <span class="c1"># For real-time detection, you would need to retrieve this from the database</span>
            <span class="c1"># Here we&#39;ll use a placeholder value based on the average energy consumption</span>
            <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">processed_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="c1"># Combine all devices</span>
        <span class="n">full_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span>

        <span class="c1"># Original data for reference</span>
        <span class="n">original_data</span> <span class="o">=</span> <span class="n">full_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Features for anomaly detection</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">]]</span>

        <span class="c1"># Standardize the features</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="c1"># Predict anomalies</span>
        <span class="c1"># FIX:</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">decision_function</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>

        <span class="c1"># Add predictions and scores back to the original data</span>
        <span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">predictions</span>
        <span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scores</span>

        <span class="c1"># Filter to only anomalies (prediction of -1 means anomaly)</span>
        <span class="n">anomalies</span> <span class="o">=</span> <span class="n">original_data</span><span class="p">[</span><span class="n">original_data</span><span class="p">[</span><span class="s1">&#39;anomaly&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Convert back to dictionary format</span>
        <span class="n">anomaly_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">anomalies</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">anomaly_records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;device_id&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">],</span>
                <span class="c1"># FIX:</span>
                <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="s1">&#39;energy_consumed&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;anomaly_score&#39;</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]),</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span> <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span> <span class="k">else</span> <span class="s1">&#39;medium&#39;</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">anomaly_records</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error detecting anomalies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.anomaly_detector.EnergyAnomalyDetector.get_anomaly_description" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">anomaly_detector</span><span class="o">.</span><span class="n">EnergyAnomalyDetector</span><span class="o">.</span><span class="n">get_anomaly_description</span><span class="p">(</span><span class="n">anomaly</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate a human-readable description of an anomaly</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>anomaly</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An anomaly record</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Human-readable description</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/anomaly_detector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_anomaly_description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anomaly</span><span class="p">:</span> <span class="n">Dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a human-readable description of an anomaly</span>

<span class="sd">    Args:</span>
<span class="sd">        anomaly (Dict): An anomaly record</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Human-readable description</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">device_id</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown device&#39;</span><span class="p">)</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;Unknown date&#39;</span><span class="p">)</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">severity</span> <span class="o">=</span> <span class="n">anomaly</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;severity&#39;</span><span class="p">,</span> <span class="s1">&#39;medium&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">severity</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Unusually high energy consumption detected for </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">. &quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;Consumption of </span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh is significantly above normal levels.&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Abnormal energy consumption detected for </span><span class="si">{</span><span class="n">device_id</span><span class="si">}</span><span class="s2"> on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">. &quot;</span> \
               <span class="sa">f</span><span class="s2">&quot;Consumption of </span><span class="si">{</span><span class="n">energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh deviates from expected patterns.&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.anomaly_detector.EnergyAnomalyDetector.train" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">anomaly_detector</span><span class="o">.</span><span class="n">EnergyAnomalyDetector</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Train the anomaly detection model using historical data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>historical_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Historical energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if training was successful, False otherwise</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/anomaly_detector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">historical_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train the anomaly detection model using historical data</span>

<span class="sd">    Args:</span>
<span class="sd">        historical_data (List[Dict]): Historical energy consumption records</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if training was successful, False otherwise</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">historical_data</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Convert to DataFrame</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">historical_data</span><span class="p">)</span>

        <span class="c1"># Ensure timestamp is a datetime</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Group by day and device to reduce noise</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;device_id&#39;</span><span class="p">])[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Prepare features for anomaly detection</span>
        <span class="c1"># For each device, calculate:</span>
        <span class="c1"># 1. Daily consumption</span>
        <span class="c1"># 2. 7-day rolling average</span>
        <span class="c1"># 3. Day of week (to account for weekly patterns)</span>

        <span class="n">devices</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
        <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">:</span>
            <span class="n">device_data</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">device</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="p">:</span>  <span class="c1"># Need enough data for rolling average</span>
                <span class="k">continue</span>

            <span class="c1"># FIX:</span>
            <span class="n">device_data</span> <span class="o">=</span> <span class="n">device_data</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;date&#39;</span><span class="p">)</span>
            <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
            <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

            <span class="c1"># Skip the first 7 days (they won&#39;t have a complete 7-day average)</span>
            <span class="n">device_data</span> <span class="o">=</span> <span class="n">device_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

            <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">processed_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Combine all devices</span>
        <span class="n">full_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">processed_data</span><span class="p">)</span>

        <span class="c1"># Features for anomaly detection</span>
        <span class="n">features</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="s1">&#39;rolling_avg_7d&#39;</span><span class="p">,</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">]]</span>

        <span class="c1"># Standardize the features</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">scaled_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">features</span><span class="p">)</span>

        <span class="c1"># Train the Isolation Forest model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span>
            <span class="c1"># FIX:</span>
            <span class="n">contamination</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">contamination</span><span class="p">,</span>
            <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
            <span class="n">n_estimators</span><span class="o">=</span><span class="mi">100</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_features</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">training_complete</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error training anomaly detection model: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.utils.report.report_generator" class="doc doc-heading">
            <code>app.utils.report.report_generator</code>


</h2>

    <div class="doc doc-contents first">

        <p>This module provides report generation feature &amp; functionality</p>








  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="app.utils.report.report_generator.EnergyReportGenerator" class="doc doc-heading">
            <code>app.utils.report.report_generator.EnergyReportGenerator</code>


</h3>


    <div class="doc doc-contents ">


        <p>Enhanced energy report generator with advanced analytics and visualizations</p>






              <details class="quote">
                <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">EnergyReportGenerator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Enhanced energy report generator with advanced analytics and visualizations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the report generator with energy consumption data</span>

<span class="sd">        Args:</span>
<span class="sd">            energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">            user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Convert data to pandas DataFrame for easier analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span>

        <span class="c1"># Ensure timestamp is datetime</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_device_names</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_device_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Map device IDs to more readable names</span>
<span class="sd">        This would ideally pull from a devices collection</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, str]: Mapping of device_id to readable name</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># This is a placeholder - in production, you would query the database</span>
        <span class="c1"># to get actual device names based on the device_ids in the energy data</span>

        <span class="n">device_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="p">[]</span>

        <span class="c1"># Create a mapping of device_id to readable names</span>
        <span class="c1"># In production, this would come from the devices collection</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">device_id</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Device </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_total_energy_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the total energy consumption in kWh</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Total energy consumption</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
        <span class="k">return</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_total_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost_per_kwh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ENERGY_COST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the total cost based on energy consumption</span>

<span class="sd">        Args:</span>
<span class="sd">            cost_per_kwh (float): Cost per kWh in local currency</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Total estimated cost</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">total_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">total_energy</span> <span class="o">*</span> <span class="n">cost_per_kwh</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze energy consumption trends over time</span>

<span class="sd">        Args:</span>
<span class="sd">            interval (str): Time grouping interval (&#39;hour&#39;, &#39;day&#39;, &#39;week&#39;, &#39;month&#39;)</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Aggregated energy consumption by time period</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Group by the specified time interval</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;hour&#39;</span><span class="p">:</span>
            <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span>
            <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;week&#39;</span><span class="p">:</span>
            <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span>
            <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>  <span class="c1"># Default to daily</span>

        <span class="c1"># Aggregate by the interval</span>
        <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">trends</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span>

        <span class="c1"># Calculate the percentage change between consecutive periods</span>
        <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>

        <span class="k">return</span> <span class="n">trends</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_by_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze energy consumption by device</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Energy consumption aggregated by device</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Group by device_id</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Add readable device names</span>
        <span class="c1"># FIX:</span>
        <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_names</span><span class="p">)</span>

        <span class="c1"># Calculate percentage of total</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">device_usage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_by_location</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Analyze energy consumption by location</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Energy consumption aggregated by location</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Fill missing locations</span>
        <span class="n">location_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">location_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>

        <span class="c1"># Group by location</span>
        <span class="n">location_usage</span> <span class="o">=</span> <span class="n">location_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Calculate percentage of total</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">location_usage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">identify_peak_usage_times</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Identify peak energy usage times</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Hours of the day ranked by energy consumption</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Extract hour from timestamp</span>
        <span class="n">hour_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">hour_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

        <span class="c1"># Group by hour</span>
        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">hour_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="c1"># Sort by energy consumption (descending)</span>
        <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">hourly_usage</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detect anomalies in energy consumption using Isolation Forest</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[pd.DataFrame, float]: DataFrame with anomaly scores and anomaly threshold</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="mf">0.0</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare data for anomaly detection</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Standardize the data</span>
            <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
            <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="c1"># Use Isolation Forest for anomaly detection</span>
            <span class="c1"># FIX:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">contamination</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>

            <span class="c1"># Convert to anomaly score (higher is more anomalous)</span>
            <span class="c1"># FIX:</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

            <span class="c1"># Add timestamp</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>

            <span class="c1"># Get the anomaly threshold (for plotting)</span>
            <span class="n">anomaly_threshold</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

            <span class="c1"># FIX:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">anomaly_threshold</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in anomaly detection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="mf">0.0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">forecast_future_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days_ahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Forecast future energy consumption using ARIMA</span>

<span class="sd">        Args:</span>
<span class="sd">            days_ahead (int): Number of days to forecast</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Forecasted energy consumption</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">14</span> <span class="ow">or</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prepare data for forecasting</span>
            <span class="c1"># Group by day to reduce noise</span>
            <span class="n">daily_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

            <span class="c1"># Ensure we have enough data points</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">daily_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

            <span class="c1"># Fit ARIMA model</span>
            <span class="c1"># Using a simple model for demonstration; would need tuning in production</span>
            <span class="c1"># FIX:</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">daily_data</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

            <span class="c1"># Generate forecast</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">days_ahead</span><span class="p">)</span>

            <span class="c1"># Create forecasted dates</span>
            <span class="n">last_date</span> <span class="o">=</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># FIX:</span>
            <span class="n">forecast_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days_ahead</span><span class="p">)]</span>

            <span class="c1"># Create result DataFrame</span>
            <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">forecast_dates</span><span class="p">,</span>
                <span class="s1">&#39;forecasted_energy&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;forecast&#39;</span>
            <span class="p">})</span>

            <span class="c1"># Add the historical data</span>
            <span class="n">historical_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
                <span class="s1">&#39;forecasted_energy&#39;</span><span class="p">:</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;historical&#39;</span>
            <span class="p">})</span>

            <span class="c1"># Combine historical and forecast</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">historical_df</span><span class="p">,</span> <span class="n">forecast_df</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in forecasting: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_energy_saving_tips</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate personalized energy-saving tips based on usage patterns</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: Energy-saving recommendations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tips</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Consider using smart power strips to eliminate phantom energy use from devices on standby.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Replace high-energy appliances with energy-efficient models (look for ENERGY STAR ratings).&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Install a programmable thermostat to optimize heating and cooling.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Use natural light when possible and replace incandescent bulbs with LEDs.&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Ensure proper insulation in your home to reduce heating and cooling costs.&quot;</span>
        <span class="p">]</span>

        <span class="c1"># Add personalized tips based on patterns in the data</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Identify the device with highest energy consumption</span>
            <span class="n">top_device</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> consumes </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of your energy. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Consider upgrading to a more efficient model or adjusting usage patterns.&quot;</span><span class="p">)</span>

        <span class="c1"># Add tips based on peak hours</span>
        <span class="n">peak_hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_hours</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">peak_hours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">top_hour</span> <span class="o">=</span> <span class="n">peak_hours</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span>
            <span class="n">tips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs around </span><span class="si">{</span><span class="n">top_hour</span><span class="si">}</span><span class="s2">:00. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Consider shifting energy-intensive activities to off-peak hours.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">tips</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_pdf_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a comprehensive PDF report with visualizations</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Path to the generated PDF report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate report filename</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.pdf&quot;</span>

        <span class="c1"># Create the PDF document</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">SimpleDocTemplate</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="n">A4</span><span class="p">)</span>
        <span class="n">styles</span> <span class="o">=</span> <span class="n">getSampleStyleSheet</span><span class="p">()</span>

        <span class="c1"># Create a title style</span>
        <span class="n">title_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
            <span class="s1">&#39;Title&#39;</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading1&#39;</span><span class="p">],</span>
            <span class="n">fontSize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
            <span class="n">alignment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Center alignment</span>
            <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">12</span>
        <span class="p">)</span>

        <span class="c1"># Create a subtitle style</span>
        <span class="n">subtitle_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
            <span class="s1">&#39;Subtitle&#39;</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2&#39;</span><span class="p">],</span>
            <span class="n">fontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
            <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">10</span>
        <span class="p">)</span>

        <span class="c1"># Create normal text style</span>
        <span class="n">normal_style</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]</span>

        <span class="c1"># Start building the document</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Title and introduction</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Report&quot;</span><span class="p">,</span> <span class="n">title_style</span><span class="p">))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="n">report_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated on </span><span class="si">{</span><span class="n">report_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Summary section</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Summary&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">total_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span>
        <span class="n">total_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_cost</span><span class="p">()</span>

        <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s2">&quot;Total Energy Consumption&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh&quot;</span><span class="p">],</span>
            <span class="p">[</span><span class="s2">&quot;Estimated Cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> AED&quot;</span><span class="p">],</span>
        <span class="p">]</span>

        <span class="c1"># Add date range if available</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Date Range&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

        <span class="n">summary_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">summary_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
        <span class="n">summary_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
        <span class="p">]))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_table</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add trend analysis</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Trends&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trends</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Create trend visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trends</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Daily Energy Consumption&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add trend insights</span>
            <span class="n">avg_change</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
            <span class="n">last_change</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">avg_change</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">last_change</span><span class="p">):</span>
                <span class="n">trend_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Your average daily change in energy consumption is </span><span class="si">{</span><span class="n">avg_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%. &quot;</span>
                <span class="n">trend_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Your most recent change was </span><span class="si">{</span><span class="n">last_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%.&quot;</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">trend_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze trends.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Device breakdown</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption by Device&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Create device visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

            <span class="c1"># Sort by energy consumed</span>
            <span class="n">device_usage</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Use device names for better readability</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">sizes</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

            <span class="c1"># Create pie chart</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Device&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add table with detailed breakdown</span>
            <span class="n">device_table_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">,</span> <span class="s2">&quot;Cost ($)&quot;</span><span class="p">]]</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">device_table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                    <span class="c1"># FIX:</span>
                    <span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">],</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DEFAULT_ENERGY_COST</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">])</span>

            <span class="n">device_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">device_table_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
            <span class="n">device_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
                <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
                <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
            <span class="p">]))</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_table</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze device usage.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add usage patterns</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Usage Patterns&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Create hourly pattern visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

            <span class="c1"># Sort by hour for better visualization</span>
            <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Hour of Day&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Show every 2 hours</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add peak usage insight</span>
            <span class="n">top_hours</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">peak_hours_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">top_hours</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]])</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs at: </span><span class="si">{</span><span class="n">peak_hours_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze usage patterns.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PageBreak</span><span class="p">())</span>

        <span class="c1"># Anomaly detection</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Anomaly Detection&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">anomaly_data</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;anomaly_score&#39;</span> <span class="ow">in</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># Create anomaly visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

            <span class="c1"># Plot normal points</span>
            <span class="n">normal</span> <span class="o">=</span> <span class="n">anomaly_data</span><span class="p">[</span><span class="n">anomaly_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> 
                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="c1"># Plot anomalies</span>
            <span class="n">anomalies</span> <span class="o">=</span> <span class="n">anomaly_data</span><span class="p">[</span><span class="n">anomaly_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> 
                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Anomaly&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Anomaly Detection in Energy Consumption&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add anomaly insights</span>
            <span class="n">anomaly_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">anomalies</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">anomaly_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># FIX:</span>
                <span class="n">anomaly_dates</span> <span class="o">=</span> <span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">anomaly_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;We detected </span><span class="si">{</span><span class="n">anomaly_count</span><span class="si">}</span><span class="s2"> anomalies in your energy consumption. &quot;</span>
                <span class="k">if</span> <span class="n">anomaly_count</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">anomaly_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Unusual consumption occurred on: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">anomaly_dates</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">anomaly_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;No anomalies detected in your energy consumption pattern.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to perform anomaly detection.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Forecasting</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Forecast&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">forecast_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_future_usage</span><span class="p">(</span><span class="n">days_ahead</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Create forecast visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

            <span class="c1"># Plot historical data</span>
            <span class="n">historical</span> <span class="o">=</span> <span class="n">forecast_data</span><span class="p">[</span><span class="n">forecast_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;historical&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">historical</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">historical</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Historical&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

            <span class="c1"># Plot forecasted data</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">forecast_data</span><span class="p">[</span><span class="n">forecast_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;forecast&#39;</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">],</span> 
                    <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;7-Day Energy Consumption Forecast&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add forecast insights</span>
            <span class="n">forecasted_total</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="n">forecasted_cost</span> <span class="o">=</span> <span class="n">forecasted_total</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
            <span class="n">forecast_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Forecasted energy consumption for the next 7 days: </span><span class="si">{</span><span class="n">forecasted_total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh. &quot;</span>
            <span class="n">forecast_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Estimated cost: $</span><span class="si">{</span><span class="n">forecasted_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">forecast_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to generate forecast.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Energy saving recommendations</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Saving Recommendations&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_energy_saving_tips</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">tip</span> <span class="ow">in</span> <span class="n">tips</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">tip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Build the PDF</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filename</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a comprehensive CSV report with multiple sheets</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Path to the generated CSV (Excel) report</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Generate report filename</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>

        <span class="c1"># Create Excel writer</span>
        <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
            <span class="c1"># Summary sheet</span>
            <span class="n">summary_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;Metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Total Energy Consumption (kWh)&#39;</span><span class="p">,</span> <span class="s1">&#39;Estimated Cost ($)&#39;</span><span class="p">],</span>
                <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_cost</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">]</span>
            <span class="p">}</span>

            <span class="c1"># Add date range if available</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">summary_data</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Date Range&#39;</span><span class="p">)</span>
                <span class="n">summary_data</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>
            <span class="n">summary_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Summary&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Trend analysis</span>
            <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">trends</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">trends</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Daily Trends&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Device breakdown</span>
            <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Add cost column</span>
                <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;estimated_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
                <span class="n">device_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Device Breakdown&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Location breakdown</span>
            <span class="n">location_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_location</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Add cost column</span>
                <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;estimated_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
                <span class="n">location_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Location Breakdown&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Hourly patterns</span>
            <span class="n">hourly_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">hourly_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Hourly Patterns&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Anomalies</span>
            <span class="n">anomaly_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;anomaly_score&#39;</span> <span class="ow">in</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">anomaly_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Anomalies&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Forecast</span>
            <span class="n">forecast_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_future_usage</span><span class="p">(</span><span class="n">days_ahead</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">forecast_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Energy saving tips</span>
            <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_energy_saving_tips</span><span class="p">()</span>
            <span class="n">tips_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Energy Saving Tips&#39;</span><span class="p">:</span> <span class="n">tips</span><span class="p">})</span>
            <span class="n">tips_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Recommendations&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Raw data</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="c1"># Format the timestamp for readability</span>
                <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                    <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
                <span class="n">raw_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Raw Data&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Initialize the report generator with energy consumption data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User information for personalization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize the report generator with energy consumption data</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">        user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert data to pandas DataFrame for easier analysis</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span>

    <span class="c1"># Ensure timestamp is datetime</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="n">user_data</span> <span class="ow">or</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">device_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_device_names</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator._get_device_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">_get_device_names</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Map device IDs to more readable names
This would ideally pull from a devices collection</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, str]: Mapping of device_id to readable name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_get_device_names</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Map device IDs to more readable names</span>
<span class="sd">    This would ideally pull from a devices collection</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, str]: Mapping of device_id to readable name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># This is a placeholder - in production, you would query the database</span>
    <span class="c1"># to get actual device names based on the device_ids in the energy data</span>

    <span class="n">device_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="p">[]</span>

    <span class="c1"># Create a mapping of device_id to readable names</span>
    <span class="c1"># In production, this would come from the devices collection</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">device_id</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Device </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.analyze_by_device" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Analyze energy consumption by device</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Energy consumption aggregated by device</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_by_device</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze energy consumption by device</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Energy consumption aggregated by device</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Group by device_id</span>
    <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Add readable device names</span>
    <span class="c1"># FIX:</span>
    <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device_names</span><span class="p">)</span>

    <span class="c1"># Calculate percentage of total</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">device_usage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.analyze_by_location" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">analyze_by_location</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Analyze energy consumption by location</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Energy consumption aggregated by location</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_by_location</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze energy consumption by location</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Energy consumption aggregated by location</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Fill missing locations</span>
    <span class="n">location_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">location_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_df</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>

    <span class="c1"># Group by location</span>
    <span class="n">location_usage</span> <span class="o">=</span> <span class="n">location_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Calculate percentage of total</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">location_usage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.analyze_trends" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Analyze energy consumption trends over time</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time grouping interval ('hour', 'day', 'week', 'month')</p>
              </div>
            </td>
            <td>
                  <code>&#39;day&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Aggregated energy consumption by time period</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">analyze_trends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interval</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Analyze energy consumption trends over time</span>

<span class="sd">    Args:</span>
<span class="sd">        interval (str): Time grouping interval (&#39;hour&#39;, &#39;day&#39;, &#39;week&#39;, &#39;month&#39;)</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Aggregated energy consumption by time period</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Group by the specified time interval</span>
    <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;hour&#39;</span><span class="p">:</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;week&#39;</span><span class="p">:</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">interval</span> <span class="o">==</span> <span class="s1">&#39;month&#39;</span><span class="p">:</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;M&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">grouper</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>  <span class="c1"># Default to daily</span>

    <span class="c1"># Aggregate by the interval</span>
    <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">grouper</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">trends</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span>

    <span class="c1"># Calculate the percentage change between consecutive periods</span>
    <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="k">return</span> <span class="n">trends</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.calculate_total_cost" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">calculate_total_cost</span><span class="p">(</span><span class="n">cost_per_kwh</span><span class="o">=</span><span class="n">DEFAULT_ENERGY_COST</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate the total cost based on energy consumption</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cost_per_kwh</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cost per kWh in local currency</p>
              </div>
            </td>
            <td>
                  <code><span title="app.utils.report.report_generator.DEFAULT_ENERGY_COST">DEFAULT_ENERGY_COST</span></code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total estimated cost</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_total_cost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cost_per_kwh</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_ENERGY_COST</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the total cost based on energy consumption</span>

<span class="sd">    Args:</span>
<span class="sd">        cost_per_kwh (float): Cost per kWh in local currency</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total estimated cost</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">total_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">total_energy</span> <span class="o">*</span> <span class="n">cost_per_kwh</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.calculate_total_energy_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Calculate the total energy consumption in kWh</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total energy consumption</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_total_energy_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the total energy consumption in kWh</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Total energy consumption</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
    <span class="k">return</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.create_csv_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">create_csv_report</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate a comprehensive CSV report with multiple sheets</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated CSV (Excel) report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_csv_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a comprehensive CSV report with multiple sheets</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated CSV (Excel) report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate report filename</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.xlsx&quot;</span>

    <span class="c1"># Create Excel writer</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">ExcelWriter</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;xlsxwriter&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">writer</span><span class="p">:</span>
        <span class="c1"># Summary sheet</span>
        <span class="n">summary_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Metric&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Total Energy Consumption (kWh)&#39;</span><span class="p">,</span> <span class="s1">&#39;Estimated Cost ($)&#39;</span><span class="p">],</span>
            <span class="s1">&#39;Value&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_cost</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Add date range if available</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">summary_data</span><span class="p">[</span><span class="s1">&#39;Metric&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Date Range&#39;</span><span class="p">)</span>
            <span class="n">summary_data</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">summary_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">summary_data</span><span class="p">)</span>
        <span class="n">summary_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Summary&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Trend analysis</span>
        <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trends</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">trends</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Daily Trends&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Device breakdown</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Add cost column</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;estimated_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
            <span class="n">device_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Device Breakdown&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Location breakdown</span>
        <span class="n">location_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_location</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Add cost column</span>
            <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;estimated_cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
            <span class="n">location_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Location Breakdown&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Hourly patterns</span>
        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">hourly_usage</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Hourly Patterns&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Anomalies</span>
        <span class="n">anomaly_data</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;anomaly_score&#39;</span> <span class="ow">in</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">anomaly_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Anomalies&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Forecast</span>
        <span class="n">forecast_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_future_usage</span><span class="p">(</span><span class="n">days_ahead</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">forecast_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Energy saving tips</span>
        <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_energy_saving_tips</span><span class="p">()</span>
        <span class="n">tips_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Energy Saving Tips&#39;</span><span class="p">:</span> <span class="n">tips</span><span class="p">})</span>
        <span class="n">tips_df</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Recommendations&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Raw data</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Format the timestamp for readability</span>
            <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>
            <span class="n">raw_data</span><span class="o">.</span><span class="n">to_excel</span><span class="p">(</span><span class="n">writer</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s1">&#39;Raw Data&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.create_pdf_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">create_pdf_report</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate a comprehensive PDF report with visualizations</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated PDF report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_pdf_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a comprehensive PDF report with visualizations</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated PDF report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate report filename</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.pdf&quot;</span>

    <span class="c1"># Create the PDF document</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">SimpleDocTemplate</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="n">A4</span><span class="p">)</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="n">getSampleStyleSheet</span><span class="p">()</span>

    <span class="c1"># Create a title style</span>
    <span class="n">title_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
        <span class="s1">&#39;Title&#39;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading1&#39;</span><span class="p">],</span>
        <span class="n">fontSize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
        <span class="n">alignment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Center alignment</span>
        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">12</span>
    <span class="p">)</span>

    <span class="c1"># Create a subtitle style</span>
    <span class="n">subtitle_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
        <span class="s1">&#39;Subtitle&#39;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2&#39;</span><span class="p">],</span>
        <span class="n">fontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>

    <span class="c1"># Create normal text style</span>
    <span class="n">normal_style</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]</span>

    <span class="c1"># Start building the document</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Title and introduction</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Report&quot;</span><span class="p">,</span> <span class="n">title_style</span><span class="p">))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="n">report_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated on </span><span class="si">{</span><span class="n">report_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Summary section</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Summary&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">total_energy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_energy_usage</span><span class="p">()</span>
    <span class="n">total_cost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_total_cost</span><span class="p">()</span>

    <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;Total Energy Consumption&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Estimated Cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> AED&quot;</span><span class="p">],</span>
    <span class="p">]</span>

    <span class="c1"># Add date range if available</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">start_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">end_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Date Range&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

    <span class="n">summary_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">summary_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
    <span class="n">summary_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
    <span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_table</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Add trend analysis</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Trends&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">trends</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_trends</span><span class="p">(</span><span class="n">interval</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">trends</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Create trend visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trends</span><span class="p">[</span><span class="s1">&#39;period&#39;</span><span class="p">],</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Daily Energy Consumption&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the plot to a BytesIO object</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Add the image to the PDF</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add trend insights</span>
        <span class="n">avg_change</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">last_change</span> <span class="o">=</span> <span class="n">trends</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trends</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">avg_change</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">last_change</span><span class="p">):</span>
            <span class="n">trend_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Your average daily change in energy consumption is </span><span class="si">{</span><span class="n">avg_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%. &quot;</span>
            <span class="n">trend_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Your most recent change was </span><span class="si">{</span><span class="n">last_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%.&quot;</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">trend_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze trends.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Device breakdown</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption by Device&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># Create device visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Sort by energy consumed</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Use device names for better readability</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">sizes</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Create pie chart</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Device&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the plot to a BytesIO object</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Add the image to the PDF</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add table with detailed breakdown</span>
        <span class="n">device_table_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">,</span> <span class="s2">&quot;Cost ($)&quot;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">device_table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="c1"># FIX:</span>
                <span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">],</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;$</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DEFAULT_ENERGY_COST</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">])</span>

        <span class="n">device_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">device_table_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
        <span class="n">device_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
            <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
        <span class="p">]))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_table</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze device usage.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Add usage patterns</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Usage Patterns&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">hourly_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># Create hourly pattern visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Sort by hour for better visualization</span>
        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Hour of Day&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># Show every 2 hours</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the plot to a BytesIO object</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Add the image to the PDF</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add peak usage insight</span>
        <span class="n">top_hours</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">peak_hours_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">top_hours</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]])</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs at: </span><span class="si">{</span><span class="n">peak_hours_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze usage patterns.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PageBreak</span><span class="p">())</span>

    <span class="c1"># Anomaly detection</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Anomaly Detection&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">anomaly_data</span><span class="p">,</span> <span class="n">threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="s1">&#39;anomaly_score&#39;</span> <span class="ow">in</span> <span class="n">anomaly_data</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Create anomaly visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Plot normal points</span>
        <span class="n">normal</span> <span class="o">=</span> <span class="n">anomaly_data</span><span class="p">[</span><span class="n">anomaly_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">normal</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> 
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># Plot anomalies</span>
        <span class="n">anomalies</span> <span class="o">=</span> <span class="n">anomaly_data</span><span class="p">[</span><span class="n">anomaly_data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> 
                   <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Anomaly&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Anomaly Detection in Energy Consumption&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the plot to a BytesIO object</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Add the image to the PDF</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add anomaly insights</span>
        <span class="n">anomaly_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">anomalies</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">anomaly_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># FIX:</span>
            <span class="n">anomaly_dates</span> <span class="o">=</span> <span class="n">anomalies</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">anomaly_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;We detected </span><span class="si">{</span><span class="n">anomaly_count</span><span class="si">}</span><span class="s2"> anomalies in your energy consumption. &quot;</span>
            <span class="k">if</span> <span class="n">anomaly_count</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">anomaly_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Unusual consumption occurred on: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">anomaly_dates</span><span class="p">)</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">anomaly_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;No anomalies detected in your energy consumption pattern.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to perform anomaly detection.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Forecasting</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Forecast&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">forecast_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forecast_future_usage</span><span class="p">(</span><span class="n">days_ahead</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">forecast_data</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># Create forecast visualization</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Plot historical data</span>
        <span class="n">historical</span> <span class="o">=</span> <span class="n">forecast_data</span><span class="p">[</span><span class="n">forecast_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;historical&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">historical</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">historical</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">],</span> 
                <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Historical&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="c1"># Plot forecasted data</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">forecast_data</span><span class="p">[</span><span class="n">forecast_data</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;forecast&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">],</span> 
                <span class="s1">&#39;r--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;7-Day Energy Consumption Forecast&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="c1"># Save the plot to a BytesIO object</span>
        <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
        <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1"># Add the image to the PDF</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

        <span class="c1"># Add forecast insights</span>
        <span class="n">forecasted_total</span> <span class="o">=</span> <span class="n">forecast</span><span class="p">[</span><span class="s1">&#39;forecasted_energy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">forecasted_cost</span> <span class="o">=</span> <span class="n">forecasted_total</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>
        <span class="n">forecast_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Forecasted energy consumption for the next 7 days: </span><span class="si">{</span><span class="n">forecasted_total</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh. &quot;</span>
        <span class="n">forecast_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;Estimated cost: $</span><span class="si">{</span><span class="n">forecasted_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">forecast_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to generate forecast.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Energy saving recommendations</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Saving Recommendations&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="n">tips</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_energy_saving_tips</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">tip</span> <span class="ow">in</span> <span class="n">tips</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;• </span><span class="si">{</span><span class="n">tip</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Build the PDF</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.detect_anomalies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">detect_anomalies</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Detect anomalies in energy consumption using Isolation Forest</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[pd.DataFrame, float]: DataFrame with anomaly scores and anomaly threshold</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">detect_anomalies</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detect anomalies in energy consumption using Isolation Forest</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[pd.DataFrame, float]: DataFrame with anomaly scores and anomaly threshold</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="mf">0.0</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Prepare data for anomaly detection</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1"># Standardize the data</span>
        <span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
        <span class="n">scaled_data</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="c1"># Use Isolation Forest for anomaly detection</span>
        <span class="c1"># FIX:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">(</span><span class="n">contamination</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>

        <span class="c1"># Convert to anomaly score (higher is more anomalous)</span>
        <span class="c1"># FIX:</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

        <span class="c1"># Add timestamp</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span>

        <span class="c1"># Get the anomaly threshold (for plotting)</span>
        <span class="n">anomaly_threshold</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;anomaly_score&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">][</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="c1"># FIX:</span>
        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="n">anomaly_threshold</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in anomaly detection: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(),</span> <span class="mf">0.0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.forecast_future_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">forecast_future_usage</span><span class="p">(</span><span class="n">days_ahead</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Forecast future energy consumption using ARIMA</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>days_ahead</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of days to forecast</p>
              </div>
            </td>
            <td>
                  <code>7</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Forecasted energy consumption</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">forecast_future_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days_ahead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Forecast future energy consumption using ARIMA</span>

<span class="sd">    Args:</span>
<span class="sd">        days_ahead (int): Number of days to forecast</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Forecasted energy consumption</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">14</span> <span class="ow">or</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Prepare data for forecasting</span>
        <span class="c1"># Group by day to reduce noise</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1"># Ensure we have enough data points</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">daily_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

        <span class="c1"># Fit ARIMA model</span>
        <span class="c1"># Using a simple model for demonstration; would need tuning in production</span>
        <span class="c1"># FIX:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">daily_data</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">model_fit</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

        <span class="c1"># Generate forecast</span>
        <span class="n">forecast</span> <span class="o">=</span> <span class="n">model_fit</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">days_ahead</span><span class="p">)</span>

        <span class="c1"># Create forecasted dates</span>
        <span class="n">last_date</span> <span class="o">=</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># FIX:</span>
        <span class="n">forecast_dates</span> <span class="o">=</span> <span class="p">[</span><span class="n">last_date</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">days_ahead</span><span class="p">)]</span>

        <span class="c1"># Create result DataFrame</span>
        <span class="n">forecast_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">forecast_dates</span><span class="p">,</span>
            <span class="s1">&#39;forecasted_energy&#39;</span><span class="p">:</span> <span class="n">forecast</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;forecast&#39;</span>
        <span class="p">})</span>

        <span class="c1"># Add the historical data</span>
        <span class="n">historical_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
            <span class="s1">&#39;forecasted_energy&#39;</span><span class="p">:</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;historical&#39;</span>
        <span class="p">})</span>

        <span class="c1"># Combine historical and forecast</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">historical_df</span><span class="p">,</span> <span class="n">forecast_df</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error in forecasting: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.generate_energy_saving_tips" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">generate_energy_saving_tips</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Generate personalized energy-saving tips based on usage patterns</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[str]: Energy-saving recommendations</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_energy_saving_tips</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate personalized energy-saving tips based on usage patterns</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: Energy-saving recommendations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Consider using smart power strips to eliminate phantom energy use from devices on standby.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Replace high-energy appliances with energy-efficient models (look for ENERGY STAR ratings).&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Install a programmable thermostat to optimize heating and cooling.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Use natural light when possible and replace incandescent bulbs with LEDs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Ensure proper insulation in your home to reduce heating and cooling costs.&quot;</span>
    <span class="p">]</span>

    <span class="c1"># Add personalized tips based on patterns in the data</span>
    <span class="n">device_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">analyze_by_device</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="c1"># Identify the device with highest energy consumption</span>
        <span class="n">top_device</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">tips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> consumes </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of your energy. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Consider upgrading to a more efficient model or adjusting usage patterns.&quot;</span><span class="p">)</span>

    <span class="c1"># Add tips based on peak hours</span>
    <span class="n">peak_hours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">peak_hours</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">peak_hours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">top_hour</span> <span class="o">=</span> <span class="n">peak_hours</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span>
        <span class="n">tips</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs around </span><span class="si">{</span><span class="n">top_hour</span><span class="si">}</span><span class="s2">:00. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Consider shifting energy-intensive activities to off-peak hours.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tips</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="app.utils.report.report_generator.EnergyReportGenerator.identify_peak_usage_times" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">EnergyReportGenerator</span><span class="o">.</span><span class="n">identify_peak_usage_times</span><span class="p">()</span></code>

</h4>


    <div class="doc doc-contents ">

        <p>Identify peak energy usage times</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: Hours of the day ranked by energy consumption</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">identify_peak_usage_times</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Identify peak energy usage times</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Hours of the day ranked by energy consumption</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Extract hour from timestamp</span>
    <span class="n">hour_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">hour_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hour_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

    <span class="c1"># Group by hour</span>
    <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">hour_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

    <span class="c1"># Sort by energy consumption (descending)</span>
    <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">hourly_usage</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_generator.generate_energy_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_generator</span><span class="o">.</span><span class="n">generate_energy_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a comprehensive energy consumption report</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User information for personalization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report format ('pdf' or 'csv')</p>
              </div>
            </td>
            <td>
                  <code>&#39;pdf&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date filter in YYYY-MM-DD format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date filter in YYYY-MM-DD format</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated report file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_energy_report</span><span class="p">(</span>
    <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> 
    <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a comprehensive energy consumption report</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">        user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">        format (str): Report format (&#39;pdf&#39; or &#39;csv&#39;)</span>
<span class="sd">        start_date (Optional[str]): Start date filter in YYYY-MM-DD format</span>
<span class="sd">        end_date (Optional[str]): End date filter in YYYY-MM-DD format</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated report file</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Filter data by date range if provided</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">and</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">start_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">end_date</span><span class="p">,</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">filtered_data</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">record</span> <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">energy_data</span> 
                <span class="k">if</span> <span class="n">start_dt</span> <span class="o">&lt;=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]))</span> <span class="o">&lt;=</span> <span class="n">end_dt</span>
            <span class="p">]</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="c1"># If there&#39;s an error in filtering, use all data</span>
            <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">energy_data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">filtered_data</span> <span class="o">=</span> <span class="n">energy_data</span>

    <span class="c1"># Create report generator</span>
    <span class="n">report_generator</span> <span class="o">=</span> <span class="n">EnergyReportGenerator</span><span class="p">(</span><span class="n">filtered_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">)</span>

    <span class="c1"># Generate report based on format</span>
    <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">report_generator</span><span class="o">.</span><span class="n">create_csv_report</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">report_generator</span><span class="o">.</span><span class="n">create_pdf_report</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="app.utils.report.report_utils" class="doc doc-heading">
            <code>app.utils.report.report_utils</code>


</h2>

    <div class="doc doc-contents first">

        <p>Utilities for generating enhanced energy reports with visualizations and analytics</p>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_utils.calculate_tiered_cost" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_utils</span><span class="o">.</span><span class="n">calculate_tiered_cost</span><span class="p">(</span><span class="n">energy_consumption</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Calculate energy cost using UAE's tiered pricing structure</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_consumption</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Total energy consumption in kWh</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>float</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimated cost in AED</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_tiered_cost</span><span class="p">(</span><span class="n">energy_consumption</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate energy cost using UAE&#39;s tiered pricing structure</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_consumption (float): Total energy consumption in kWh</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: Estimated cost in AED</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert kWh tiers to actual kWh values</span>
    <span class="c1"># These are rough estimates and should be adjusted based on actual utility rates</span>
    <span class="n">tier1_limit</span> <span class="o">=</span> <span class="mi">2000</span> <span class="o">/</span> <span class="mf">0.23</span>  <span class="c1"># ~8696 kWh</span>
    <span class="n">tier2_limit</span> <span class="o">=</span> <span class="mi">4000</span> <span class="o">/</span> <span class="mf">0.28</span>  <span class="c1"># ~14286 kWh</span>
    <span class="n">tier3_limit</span> <span class="o">=</span> <span class="mi">6000</span> <span class="o">/</span> <span class="mf">0.32</span>  <span class="c1"># ~18750 kWh</span>

    <span class="k">if</span> <span class="n">energy_consumption</span> <span class="o">&lt;=</span> <span class="n">tier1_limit</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">energy_consumption</span> <span class="o">*</span> <span class="mf">0.23</span>
    <span class="k">elif</span> <span class="n">energy_consumption</span> <span class="o">&lt;=</span> <span class="n">tier2_limit</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tier1_limit</span> <span class="o">*</span> <span class="mf">0.23</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">energy_consumption</span> <span class="o">-</span> <span class="n">tier1_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.28</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">energy_consumption</span> <span class="o">&lt;=</span> <span class="n">tier3_limit</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tier1_limit</span> <span class="o">*</span> <span class="mf">0.23</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tier2_limit</span> <span class="o">-</span> <span class="n">tier1_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.28</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">energy_consumption</span> <span class="o">-</span> <span class="n">tier2_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.32</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">tier1_limit</span> <span class="o">*</span> <span class="mf">0.23</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tier2_limit</span> <span class="o">-</span> <span class="n">tier1_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.28</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">tier3_limit</span> <span class="o">-</span> <span class="n">tier2_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.32</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">energy_consumption</span> <span class="o">-</span> <span class="n">tier3_limit</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.36</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_utils.generate_enhanced_csv_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_utils</span><span class="o">.</span><span class="n">generate_enhanced_csv_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a comprehensive CSV report with multiple tables</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User information for personalization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated CSV report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_enhanced_csv_report</span><span class="p">(</span>
    <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> 
    <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a comprehensive CSV report with multiple tables</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">        user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">        start_date (Optional[str]): Start date for filtering data</span>
<span class="sd">        end_date (Optional[str]): End date for filtering data</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated CSV report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate report filename</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.csv&quot;</span>

    <span class="c1"># Convert to DataFrame for analysis</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span>

    <span class="c1"># Ensure timestamp is datetime</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create a CSV with multiple sections</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Section 1: Summary</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ENERGY CONSUMPTION SUMMARY</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated on,</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">user_data</span> <span class="ow">and</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User,</span><span class="si">{</span><span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">total_energy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">total_cost</span> <span class="o">=</span> <span class="n">calculate_tiered_cost</span><span class="p">(</span><span class="n">total_energy</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total Energy Consumption (kWh),</span><span class="si">{</span><span class="n">total_energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estimated Cost (AED),</span><span class="si">{</span><span class="n">total_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Date Range,</span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Section 2: Daily Consumption</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DAILY ENERGY CONSUMPTION</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">daily_data</span> <span class="o">=</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Date,Energy (kWh),Day-over-Day Change (%),Estimated Cost (AED)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;change_pct&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">DEFAULT_ENERGY_COST</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No daily consumption data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Section 3: Device Breakdown</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DEVICE ENERGY CONSUMPTION</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">device_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
            <span class="n">device_names</span> <span class="o">=</span> <span class="n">get_device_names</span><span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">device_names</span><span class="p">)</span>

            <span class="c1"># Calculate percentage and cost</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>

                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Device,Energy (kWh),Percentage (%),Estimated Cost (AED)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No device consumption data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No device information available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Section 4: Hourly Patterns</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;HOURLY ENERGY CONSUMPTION PATTERNS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
            <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Hour,Energy (kWh),Percentage of Total (%)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">:00,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No hourly pattern data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No timestamp information available for hourly analysis.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Section 5: Location Analysis (if available)</span>
        <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;LOCATION ENERGY CONSUMPTION</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">df_loc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">df_loc</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_loc</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>
            <span class="n">location_usage</span> <span class="o">=</span> <span class="n">df_loc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="n">total</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                    <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>

                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Location,Energy (kWh),Percentage (%),Estimated Cost (AED)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No location consumption data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No location data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Section 6: Raw Data</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;RAW ENERGY CONSUMPTION DATA</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Create a copy of the DataFrame for output</span>
            <span class="n">output_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="c1"># Format timestamp for readability if it exists</span>
            <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">output_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">)</span>

            <span class="c1"># Write header</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">headers</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># Write data rows</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">output_df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">values</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;No raw data available.</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_utils.generate_enhanced_pdf_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_utils</span><span class="o">.</span><span class="n">generate_enhanced_pdf_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate a comprehensive PDF report with visualizations</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User information for personalization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated PDF report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_enhanced_pdf_report</span><span class="p">(</span>
    <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> 
    <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a comprehensive PDF report with visualizations</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">        user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">        start_date (Optional[str]): Start date for filtering data</span>
<span class="sd">        end_date (Optional[str]): End date for filtering data</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated PDF report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Generate report filename</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">REPORTS_DIR</span><span class="si">}</span><span class="s2">/energy_report_</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">.pdf&quot;</span>

    <span class="c1"># Convert to DataFrame for analysis</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">energy_data</span><span class="p">)</span>

    <span class="c1"># Ensure timestamp is datetime</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
        <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Create the PDF document</span>
    <span class="n">doc</span> <span class="o">=</span> <span class="n">SimpleDocTemplate</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">pagesize</span><span class="o">=</span><span class="n">A4</span><span class="p">)</span>
    <span class="n">styles</span> <span class="o">=</span> <span class="n">getSampleStyleSheet</span><span class="p">()</span>

    <span class="c1"># Create a title style</span>
    <span class="n">title_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
        <span class="s1">&#39;Title&#39;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading1&#39;</span><span class="p">],</span>
        <span class="n">fontSize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span>
        <span class="n">alignment</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Center alignment</span>
        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">12</span>
    <span class="p">)</span>

    <span class="c1"># Create a subtitle style</span>
    <span class="n">subtitle_style</span> <span class="o">=</span> <span class="n">ParagraphStyle</span><span class="p">(</span>
        <span class="s1">&#39;Subtitle&#39;</span><span class="p">,</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Heading2&#39;</span><span class="p">],</span>
        <span class="n">fontSize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span>
        <span class="n">spaceAfter</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>

    <span class="c1"># Create normal text style</span>
    <span class="n">normal_style</span> <span class="o">=</span> <span class="n">styles</span><span class="p">[</span><span class="s1">&#39;Normal&#39;</span><span class="p">]</span>

    <span class="c1"># Start building the document</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Title and introduction</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Smart Home Energy Consumption Report&quot;</span><span class="p">,</span> <span class="n">title_style</span><span class="p">))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="n">report_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%B </span><span class="si">%d</span><span class="s2">, %Y&quot;</span><span class="p">)</span>

    <span class="c1"># Add user info if available</span>
    <span class="k">if</span> <span class="n">user_data</span> <span class="ow">and</span> <span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">):</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Report for: </span><span class="si">{</span><span class="n">user_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Generated on: </span><span class="si">{</span><span class="n">report_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Summary section</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Summary&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="c1"># Calculate total energy and cost</span>
    <span class="n">total_energy</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">total_cost</span> <span class="o">=</span> <span class="n">calculate_tiered_cost</span><span class="p">(</span><span class="n">total_energy</span><span class="p">)</span>

    <span class="n">summary_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="s2">&quot;Total Energy Consumption&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_energy</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;Estimated Cost&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">total_cost</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> AED&quot;</span><span class="p">],</span>
    <span class="p">]</span>

    <span class="c1"># Add date range if available</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">start_date_str</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">end_date_str</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">summary_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s2">&quot;Date Range&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date_str</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end_date_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>

    <span class="n">summary_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">summary_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">2.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
    <span class="n">summary_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
        <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
    <span class="p">]))</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">summary_table</span><span class="p">)</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Add trend analysis</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption Trends&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Group by day</span>
        <span class="n">daily_data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Grouper</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">))[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">daily_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Create trend visualization</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Daily Energy Consumption&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Add trend insights</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">daily_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">avg_change</span> <span class="o">=</span> <span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;change&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">avg_change</span><span class="p">):</span>
                    <span class="n">trend_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Your average daily change in energy consumption is </span><span class="si">{</span><span class="n">avg_change</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%.&quot;</span>
                    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="n">trend_text</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

                <span class="c1"># Identify highest and lowest consumption days</span>
                <span class="n">max_day</span> <span class="o">=</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span>
                <span class="n">min_day</span> <span class="o">=</span> <span class="n">daily_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">daily_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()]</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highest usage: </span><span class="si">{</span><span class="n">max_day</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh on </span><span class="si">{</span><span class="n">max_day</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Lowest usage: </span><span class="si">{</span><span class="n">min_day</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> kWh on </span><span class="si">{</span><span class="n">min_day</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze trends. At least two days of data are required.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze trends.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Device breakdown</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption by Device&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Get device names</span>
            <span class="n">device_names</span> <span class="o">=</span> <span class="n">get_device_names</span><span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">device_names</span><span class="p">)</span>

            <span class="c1"># Sort by energy consumed (descending)</span>
            <span class="n">device_usage</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Calculate percentage of total</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
                <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span>

                <span class="c1"># Create pie chart for top devices</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">device_usage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                    <span class="c1"># Show top 5 + &quot;Others&quot;</span>
                    <span class="n">top_devices</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
                    <span class="n">others_energy</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">5</span><span class="p">:][</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

                    <span class="c1"># Create a new DataFrame with Others row</span>
                    <span class="n">pie_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
                        <span class="n">top_devices</span><span class="p">,</span>
                        <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                            <span class="s1">&#39;device_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;others&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;energy_consumed&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">others_energy</span><span class="p">],</span>
                            <span class="s1">&#39;device_name&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Others&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;percentage&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="n">others_energy</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">],</span>
                            <span class="s1">&#39;cost&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">others_energy</span> <span class="o">*</span> <span class="n">DEFAULT_ENERGY_COST</span><span class="p">]</span>
                        <span class="p">})</span>
                    <span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pie_data</span> <span class="o">=</span> <span class="n">device_usage</span>

                <span class="c1"># Create pie chart</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

                <span class="c1"># Use device names for better readability</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">pie_data</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">sizes</span> <span class="o">=</span> <span class="n">pie_data</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="n">explode</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))]</span>  <span class="c1"># Explode the largest slice</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span><span class="n">sizes</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">explode</span><span class="o">=</span><span class="n">explode</span><span class="p">,</span> <span class="n">autopct</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%1.1f%%</span><span class="s1">&#39;</span><span class="p">,</span> 
                        <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">startangle</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Device&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

                <span class="c1"># Save the plot to a BytesIO object</span>
                <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
                <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># Add the image to the PDF</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">4</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

                <span class="c1"># Add table with detailed breakdown</span>
                <span class="n">device_table_data</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;Device&quot;</span><span class="p">,</span> <span class="s2">&quot;Energy (kWh)&quot;</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">,</span> <span class="s2">&quot;Cost (AED)&quot;</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">device_table_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                        <span class="n">row</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">],</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">])</span>

                <span class="n">device_table</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span><span class="n">device_table_data</span><span class="p">,</span> <span class="n">colWidths</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="mf">1.5</span><span class="o">*</span><span class="n">inch</span><span class="p">])</span>
                <span class="n">device_table</span><span class="o">.</span><span class="n">setStyle</span><span class="p">(</span><span class="n">TableStyle</span><span class="p">([</span>
                    <span class="p">(</span><span class="s1">&#39;BACKGROUND&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colors</span><span class="o">.</span><span class="n">lightgrey</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;GRID&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">colors</span><span class="o">.</span><span class="n">black</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;ALIGN&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;CENTER&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;Helvetica-Bold&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;FONTNAME&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="s1">&#39;Helvetica&#39;</span><span class="p">),</span>
                    <span class="p">(</span><span class="s1">&#39;PADDING&#39;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">6</span><span class="p">),</span>
                <span class="p">]))</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_table</span><span class="p">)</span>

                <span class="c1"># Add insights</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>
                <span class="n">top_device</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is using </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of your total energy. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;This costs approximately </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;cost&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> AED during this period.&quot;</span><span class="p">,</span> 
                    <span class="n">normal_style</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;No energy consumption recorded for any device.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;No device data available.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Device information not available in the data.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Usage patterns by time of day</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Usage Patterns by Hour of Day&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="c1"># Extract hour from timestamp</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>

        <span class="c1"># Group by hour</span>
        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="c1"># Sort by hour for visualization</span>
            <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>

            <span class="c1"># Create bar chart</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Hour of Day&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy Consumption (kWh)&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Hour of Day&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

            <span class="c1"># Save the plot to a BytesIO object</span>
            <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
            <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Add the image to the PDF</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

            <span class="c1"># Identify peak usage hours</span>
            <span class="n">sorted_hours</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">peak_hours</span> <span class="o">=</span> <span class="n">sorted_hours</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

            <span class="c1"># Format peak hours for display (e.g., &quot;18:00&quot; instead of just &quot;18&quot;)</span>
            <span class="n">peak_hours_str</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">hour</span><span class="p">)</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="n">peak_hours</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]])</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs at: </span><span class="si">{</span><span class="n">peak_hours_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

            <span class="c1"># Add recommendations based on peak hours</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">h</span> <span class="ow">in</span> <span class="n">peak_hours</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">20</span><span class="p">]):</span>  <span class="c1"># Evening peak hours</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span>
                    <span class="s2">&quot;You have high energy usage during evening peak hours. Consider shifting some activities to off-peak times to reduce energy costs.&quot;</span><span class="p">,</span>
                    <span class="n">normal_style</span>
                <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient data to analyze hourly usage patterns.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Timestamp information not available for hourly analysis.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PageBreak</span><span class="p">())</span>

    <span class="c1"># Location-based analysis (if available)</span>
    <span class="k">if</span> <span class="s1">&#39;location&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Consumption by Location&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

        <span class="c1"># Fill missing locations</span>
        <span class="n">df_loc</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">df_loc</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_loc</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;Unknown&#39;</span><span class="p">)</span>

        <span class="c1"># Group by location</span>
        <span class="n">location_usage</span> <span class="o">=</span> <span class="n">df_loc</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;location&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">location_usage</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Only show if multiple locations</span>
            <span class="c1"># Sort by energy consumed (descending)</span>
            <span class="n">location_usage</span> <span class="o">=</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Calculate percentage</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">total</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">total</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>

                <span class="c1"># Create bar chart</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
                <span class="n">bars</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">],</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Location&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Energy Consumption (kWh)&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Energy Consumption by Location&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

                <span class="c1"># Add percentage labels on bars</span>
                <span class="k">for</span> <span class="n">bar</span><span class="p">,</span> <span class="n">percentage</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bars</span><span class="p">,</span> <span class="n">location_usage</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]):</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">bar</span><span class="o">.</span><span class="n">get_x</span><span class="p">()</span> <span class="o">+</span> <span class="n">bar</span><span class="o">.</span><span class="n">get_width</span><span class="p">()</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>
                        <span class="n">bar</span><span class="o">.</span><span class="n">get_height</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">percentage</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">,</span>
                        <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span>
                    <span class="p">)</span>

                <span class="c1"># Save the plot to a BytesIO object</span>
                <span class="n">img_data</span> <span class="o">=</span> <span class="n">BytesIO</span><span class="p">()</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>
                <span class="n">img_data</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

                <span class="c1"># Add the image to the PDF</span>
                <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">6</span><span class="o">*</span><span class="n">inch</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">3</span><span class="o">*</span><span class="n">inch</span><span class="p">)</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.2</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

                <span class="c1"># Add insights</span>
                <span class="n">top_location</span> <span class="o">=</span> <span class="n">location_usage</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your highest energy consumption is in the </span><span class="si">{</span><span class="n">top_location</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> area, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;accounting for </span><span class="si">{</span><span class="n">top_location</span><span class="p">[</span><span class="s1">&#39;percentage&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">% of your total energy use.&quot;</span><span class="p">,</span>
                    <span class="n">normal_style</span>
                <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;No energy consumption recorded for any location.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Insufficient location data for analysis.&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>

        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.3</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Energy-saving recommendations</span>
    <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="s2">&quot;Energy Saving Recommendations&quot;</span><span class="p">,</span> <span class="n">subtitle_style</span><span class="p">))</span>

    <span class="c1"># Generate general recommendations</span>
    <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;Install LED bulbs which use up to 80</span><span class="si">% le</span><span class="s2">ss energy than traditional incandescent bulbs.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Use smart power strips to eliminate phantom energy use from devices on standby.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Set your air conditioner to 24°C or higher during summer to optimize energy efficiency.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Clean or replace AC filters regularly to maintain efficiency and reduce energy consumption.&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Use natural light when possible and turn off lights when leaving a room.&quot;</span>
    <span class="p">]</span>

    <span class="c1"># Add personalized recommendations based on data analysis</span>
    <span class="k">if</span> <span class="s1">&#39;device_id&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">device_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;device_id&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">device_names</span> <span class="o">=</span> <span class="n">get_device_names</span><span class="p">(</span><span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
            <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">device_usage</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">device_names</span><span class="p">)</span>
            <span class="n">top_device</span> <span class="o">=</span> <span class="n">device_usage</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Add device-specific recommendation</span>
            <span class="k">if</span> <span class="s2">&quot;ac&quot;</span> <span class="ow">in</span> <span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;air&quot;</span> <span class="ow">in</span> <span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is your highest energy consumer. Consider setting the temperature &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;1-2 degrees higher to save up to 10% on cooling costs.&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;refrigerator&quot;</span> <span class="ow">in</span> <span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;fridge&quot;</span> <span class="ow">in</span> <span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is using a significant amount of energy. Ensure the door seals are tight, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;and the temperature is set to the manufacturer&#39;s recommended level (usually 3-4°C for the fridge and -18°C for the freezer).&quot;</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="s2">&quot;water&quot;</span> <span class="ow">in</span> <span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
                <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is a major energy consumer. Consider lowering the temperature setting &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;or installing a timer to heat water only when needed.&quot;</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Your </span><span class="si">{</span><span class="n">top_device</span><span class="p">[</span><span class="s1">&#39;device_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> is your highest energy consumer. Consider upgrading to a more &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;energy-efficient model or adjusting usage patterns.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Add time-based recommendation based on hourly analysis</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
        <span class="n">hourly_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;hour&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">peak_hour</span> <span class="o">=</span> <span class="n">hourly_usage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hourly_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">&#39;hour&#39;</span><span class="p">]</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Your peak energy usage occurs around </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">peak_hour</span><span class="p">)</span><span class="si">}</span><span class="s2">:00. Try to shift energy-intensive &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;activities to off-peak hours to reduce demand charges and overall energy costs.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Add weekly pattern recommendation</span>
    <span class="k">if</span> <span class="s1">&#39;timestamp&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">and</span> <span class="s1">&#39;energy_consumed&#39;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>  <span class="c1"># 0=Monday, 6=Sunday</span>
        <span class="n">daily_usage</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;day_of_week&#39;</span><span class="p">)[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">daily_usage</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">peak_day_num</span> <span class="o">=</span> <span class="n">daily_usage</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">daily_usage</span><span class="p">[</span><span class="s1">&#39;energy_consumed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="s1">&#39;day_of_week&#39;</span><span class="p">]</span>
            <span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="s1">&#39;Sunday&#39;</span><span class="p">]</span>
            <span class="n">peak_day</span> <span class="o">=</span> <span class="n">days</span><span class="p">[</span><span class="n">peak_day_num</span><span class="p">]</span>

            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Your highest energy consumption is on </span><span class="si">{</span><span class="n">peak_day</span><span class="si">}</span><span class="s2">. Consider rescheduling energy-intensive &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;activities to distribute energy usage more evenly throughout the week.&quot;</span>
            <span class="p">)</span>

    <span class="c1"># Add the recommendations to the PDF</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">recommendation</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Paragraph</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">recommendation</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">normal_style</span><span class="p">))</span>
        <span class="n">elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Spacer</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">inch</span><span class="p">))</span>

    <span class="c1"># Build the PDF</span>
    <span class="n">doc</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">filename</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_utils.generate_enhanced_report" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_utils</span><span class="o">.</span><span class="n">generate_enhanced_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">,</span> <span class="n">user_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate an enhanced energy report in the specified format</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>energy_data</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Energy consumption records</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>format</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Report format ('pdf' or 'csv')</p>
              </div>
            </td>
            <td>
                  <code>&#39;pdf&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_data</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>User information for personalization</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>start_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>end_date</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for filtering data</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generated report</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_enhanced_report</span><span class="p">(</span>
    <span class="n">energy_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> 
    <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;pdf&#39;</span><span class="p">,</span>
    <span class="n">user_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate an enhanced energy report in the specified format</span>

<span class="sd">    Args:</span>
<span class="sd">        energy_data (List[Dict]): Energy consumption records</span>
<span class="sd">        format (str): Report format (&#39;pdf&#39; or &#39;csv&#39;)</span>
<span class="sd">        user_data (Optional[Dict]): User information for personalization</span>
<span class="sd">        start_date (Optional[str]): Start date for filtering data</span>
<span class="sd">        end_date (Optional[str]): End date for filtering data</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: Path to the generated report</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">format</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">generate_enhanced_csv_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">generate_enhanced_pdf_report</span><span class="p">(</span><span class="n">energy_data</span><span class="p">,</span> <span class="n">user_data</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="app.utils.report.report_utils.get_device_names" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">app</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">report</span><span class="o">.</span><span class="n">report_utils</span><span class="o">.</span><span class="n">get_device_names</span><span class="p">(</span><span class="n">device_ids</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Generate readable device names from device IDs
This is a placeholder - in a real implementation, you would query the devices collection</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>device_ids</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of device IDs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, str]: Mapping of device_id to readable name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>app/utils/report/report_utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_device_names</span><span class="p">(</span><span class="n">device_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate readable device names from device IDs</span>
<span class="sd">    This is a placeholder - in a real implementation, you would query the devices collection</span>

<span class="sd">    Args:</span>
<span class="sd">        device_ids (List[str]): List of device IDs</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, str]: Mapping of device_id to readable name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># In production, this would query your devices collection</span>
    <span class="c1"># For now, generate readable names based on ID</span>
    <span class="n">device_names</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">device_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">device_ids</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;light&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Light </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;therm&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Thermostat </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;fridge&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;refrig&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Refrigerator </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;tv&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;television&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Television </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;ac&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;air&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Air Conditioner </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;wash&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Washing Machine </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;dryer&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dryer </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;oven&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;stove&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Oven/Stove </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;dishwash&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Dishwasher </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">elif</span> <span class="s2">&quot;water&quot;</span> <span class="ow">in</span> <span class="n">device_id</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Water Heater </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">device_names</span><span class="p">[</span><span class="n">device_id</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Device </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">device_names</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>